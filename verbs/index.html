<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Shirley's Grammar | Verbs Masterclass</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;0,700;1,500&family=Inter:wght@400;500;600&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      /* --- æ ¸å¿ƒé…è‰² --- */
      --primary-tone: #3a5a40; /* æ£®æ—æ·±ç¶  */
      --secondary-tone: #c9a972; /* å¾©å¤é‡‘ */
      --text-main: #333333;
      --bg-cream: #faf8f2;
      --highlight-bg: #f0eadd;
      
      /* --- å°ºå¯¸è®Šæ•¸ --- */
      --node-size: 115px; 
      --center-size: 200px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      background-color: var(--bg-cream);
      color: var(--text-main);
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      position: relative;
    }

    /* === 1. èƒŒæ™¯æ¼‚æµ®å‹•è© === */
    .floating-objects {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 0; overflow: hidden;
    }
    .float-item {
      position: absolute; opacity: 0.08;
      font-family: 'Playfair Display', serif; font-weight: 700;
      color: var(--primary-tone);
      animation: floatUp 28s infinite linear;
      white-space: nowrap;
    }
    @keyframes floatUp {
      0% { transform: translateY(110vh) rotate(0deg); }
      100% { transform: translateY(-20vh) rotate(360deg); }
    }

    /* === 2. Mind Map èˆå° === */
    .mindmap-stage {
      position: relative; width: 100%; height: 100%;
      display: flex; justify-content: center; align-items: center;
      z-index: 10;
    }
    .connections {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 1;
    }
    .connection-line {
      stroke: var(--secondary-tone); stroke-width: 2;
      stroke-dasharray: 6, 6; opacity: 0.4;
    }

    /* æ ¸å¿ƒ Core */
    .core-node {
      width: var(--center-size); height: var(--center-size);
      background: var(--primary-tone); color: white;
      border-radius: 50%;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      text-align: center; z-index: 5;
      box-shadow: 0 0 0 12px rgba(58, 90, 64, 0.08), 0 25px 50px rgba(0,0,0,0.25);
      animation: corePulse 5s infinite ease-in-out; cursor: default;
    }
    .core-title { font-family: 'Playfair Display', serif; font-size: 2.2rem; font-weight: 700; line-height: 1; }
    .core-sub { font-size: 0.75rem; letter-spacing: 3px; text-transform: uppercase; margin-top: 10px; color: var(--secondary-tone); }

    @keyframes corePulse {
      0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); }
    }

    /* å­ç¯€é» Satellite */
    .satellite {
      position: absolute; width: var(--node-size); height: var(--node-size);
      border-radius: 50%; background: white;
      border: 2px solid var(--primary-tone);
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      text-align: center; cursor: pointer; z-index: 5;
      box-shadow: 0 10px 25px rgba(58, 90, 64, 0.1);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-family: 'Playfair Display', serif; font-weight: 600;
      font-size: 0.85rem; color: var(--primary-tone); padding: 5px;
    }
    .satellite:hover {
      transform: scale(1.15); background: var(--primary-tone);
      color: white; border-color: var(--secondary-tone);
      box-shadow: 0 15px 35px rgba(58, 90, 64, 0.3); z-index: 10;
    }

    .step-badge {
      position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
      background: var(--secondary-tone); color: white;
      font-family: 'Inter', sans-serif; font-size: 0.8rem; font-weight: 700;
      width: 24px; height: 24px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    /* ç‰¹æ®Šç¯€é»æ¨£å¼ */
    .satellite.quiz-node { border-color: var(--secondary-tone); background: #fffcf5; }
    .satellite.quiz-node .step-badge { background: #d32f2f; }
    
    .satellite.visual-node { border-color: #1976d2; color: #1565c0; }
    .satellite.visual-node .step-badge { background: #1976d2; }
    .satellite.visual-node:hover { background: #1976d2; color: white; }

    .satellite.special-node { border-color: #d32f2f; color: #c62828; }
    .satellite.special-node .step-badge { background: #d32f2f; }
    .satellite.special-node:hover { background: #d32f2f; color: white; }

    /* === 3. Modal å…§å®¹å€ === */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(250, 248, 242, 0.95); backdrop-filter: blur(5px);
      z-index: 100; opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
      display: flex; justify-content: center; align-items: center;
    }
    .modal-overlay.active { opacity: 1; pointer-events: auto; }

    .modal-content {
      width: 90%; max-width: 950px; max-height: 85vh;
      background: white; border-radius: 16px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.2);
      border-top: 6px solid var(--primary-tone);
      overflow-y: auto; padding: 40px;
      display: none; animation: slideUp 0.4s ease-out;
    }
    @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .close-btn {
      position: absolute; top: 20px; right: 20px;
      width: 40px; height: 40px; border-radius: 50%; border: none;
      background: #f4f4f4; color: var(--text-main); font-size: 1.5rem;
      cursor: pointer; transition: all 0.2s;
    }
    .close-btn:hover { background: var(--secondary-tone); color: white; }

    /* å…§å®¹æ’ç‰ˆ */
    h2 { font-family: 'Playfair Display', serif; font-size: 2rem; color: var(--primary-tone); margin-bottom: 20px; border-bottom: 2px solid var(--secondary-tone); padding-bottom: 10px; }
    h3 { font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--primary-tone); margin: 30px 0 15px; border-left: 4px solid var(--secondary-tone); padding-left: 12px; }
    
    /* è¡¨æ ¼å„ªåŒ– */
    .table-responsive { overflow-x: auto; margin: 20px 0; border: 1px solid #e8e4d9; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; min-width: 600px; }
    th { background: #f4f1ea; color: var(--primary-tone); padding: 15px; text-align: left; font-family: 'Playfair Display', serif; border-bottom: 2px solid #e8e4d9; white-space: nowrap; }
    td { padding: 14px; border-bottom: 1px solid #eee; }
    tr:nth-child(even) { background-color: #fcfcfc; }
    
    .bilingual-box { display: flex; gap: 20px; background: #fbfbf9; padding: 25px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 20px; }
    .highlight { background: var(--highlight-bg); padding: 2px 6px; border-radius: 4px; color: var(--primary-tone); font-weight: 600; }
    .note-box { padding: 20px; margin: 20px 0; border-radius: 0 8px 8px 0; line-height: 1.6; }
    .note-tip { background: #f1f8f1; border-left: 4px solid #3a5a40; color: #2d4632; }
    
    .btn-cta { background: var(--secondary-tone); color: white; padding: 12px 30px; border-radius: 50px; border: none; font-size: 1rem; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; transition: 0.3s; font-weight: 600; margin-top: 15px; }
    .btn-cta:hover { background: var(--primary-tone); transform: translateY(-2px); }

    /* Timeline Preview Style */
    .timeline-preview {
      display: flex; align-items: center; justify-content: space-between;
      margin: 40px 0; position: relative; padding: 40px 20px;
      background: #fcfcfc; border-radius: 12px; border: 1px solid #eee; min-height: 150px;
    }
    .timeline-line {
      position: absolute; top: 50%; left: 40px; right: 40px; height: 4px; background: #e0e0e0; z-index: 0;
    }
    .timeline-point {
      position: relative; z-index: 1; width: 16px; height: 16px;
      background: var(--secondary-tone); border-radius: 50%;
      box-shadow: 0 0 0 5px white;
    }
    .timeline-label {
      position: absolute; top: -35px; left: 50%; transform: translateX(-50%);
      font-weight: bold; color: var(--primary-tone); white-space: nowrap;
    }
    .timeline-sub {
      position: absolute; bottom: -35px; left: 50%; transform: translateX(-50%);
      font-size: 0.85rem; color: #666; width: 120px; text-align: center;
    }

    /* Quiz Styling */
    .quiz-question-box { background: #fff; padding: 25px; border-radius: 12px; border: 1px solid #eee; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
    .quiz-q-text { font-size: 1.2rem; font-weight: 600; color: var(--primary-tone); margin-bottom: 20px; }
    .quiz-opt { display: block; width: 100%; padding: 15px 20px; margin-bottom: 10px; border: 2px solid #f0f0f0; border-radius: 8px; background: white; text-align: left; cursor: pointer; transition: all 0.2s; font-size: 1rem; }
    .quiz-opt:hover:not(:disabled) { border-color: var(--secondary-tone); background: #fffbf5; }
    .quiz-opt.correct { background: #e8f5e9; border-color: #4caf50; color: #2e7d32; }
    .quiz-opt.incorrect { background: #ffebee; border-color: #ef5350; color: #c62828; }
    
    .explanation { margin-top: 20px; padding: 15px; background: #faf8f2; border-left: 4px solid var(--secondary-tone); display: none; }
    .explanation.show { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
    
    .result-card { text-align: center; padding: 40px; display: none; }
    .result-score { font-size: 4rem; font-family: 'Playfair Display', serif; color: var(--primary-tone); font-weight: 700; }

    /* RWD */
    @media (max-width: 768px) {
      body { overflow-y: auto; height: auto; }
      .floating-objects { height: 100vh; position: fixed; }
      .mindmap-stage { flex-direction: column; height: auto; padding: 50px 20px; }
      .connections { display: none; }
      .core-node { margin-bottom: 40px; width: 160px; height: 160px; }
      .satellite { 
        position: relative; top: auto !important; left: auto !important; transform: none !important;
        width: 100%; min-height: 70px; margin-bottom: 12px; flex-direction: row; 
        justify-content: flex-start; text-align: left; gap: 20px; padding: 15px 25px;
      }
      .satellite:hover { transform: translateY(-3px) !important; }
      .step-badge { position: static; transform: none; margin-right: 0; min-width: 24px; }
      .modal-content { padding: 25px; width: 95%; max-height: 90vh; }
      .bilingual-box { flex-direction: column; }
      .timeline-preview { flex-direction: column; height: 350px; gap: 40px; align-items: center; justify-content: center; }
      .timeline-line { width: 4px; height: 80%; top: 50%; bottom: auto; left: 50%; right: auto; transform: translate(-50%, -50%); }
      .timeline-point { margin: 30px 0; }
      .timeline-label { top: 50%; left: -80px; transform: translateY(-50%); text-align: right; width: 70px; }
      .timeline-sub { bottom: auto; top: 50%; left: 30px; transform: translateY(-50%); text-align: left; width: 100px; }
    }
  </style>
</head>
<body>

  <div class="floating-objects" id="floatingBg"></div>

  <div class="mindmap-stage" id="stage">
    <svg class="connections" id="svgLines"></svg>

    <div class="core-node">
      <div class="core-title">Shirley's<br>Verbs</div>
      <div class="core-sub">Complete Guide</div>
    </div>

    <div class="satellite" data-target="type-basic-modal">
      <div class="step-badge">1</div>
      <div>Verb Types<br>åŸºæœ¬ç¨®é¡</div>
    </div>
    
    <div class="satellite" data-target="type-helper-modal">
      <div class="step-badge">2</div>
      <div>Modals<br>æƒ…æ…‹åŠ©å‹•è©</div>
    </div>
    
    <div class="satellite" data-target="tense-simple-modal">
      <div class="step-badge">3</div>
      <div>Simple Tense<br>ç°¡å–®/é€²è¡Œå¼</div>
    </div>
    
    <div class="satellite" data-target="tense-perfect-modal">
      <div class="step-badge">4</div>
      <div>Perfect Tense<br>å®Œæˆæ™‚æ…‹</div>
    </div>

    <div class="satellite visual-node" data-target="visual-modal">
      <div class="step-badge">5</div>
      <div>Timeline<br>æ™‚æ…‹å¯è¦–åŒ–</div>
    </div>

    <div class="satellite special-node" onclick="window.open('https://ducj-creator.github.io/Shirley-Grammar/irregular/verbs/', '_blank')">
      <div class="step-badge">6</div>
      <div>Irregular<br>ä¸è¦å‰‡å‹•è© (Tool)</div>
    </div>

    <div class="satellite" data-target="voice-modal">
      <div class="step-badge">7</div>
      <div>Voices<br>è¢«å‹•èªæ…‹</div>
    </div>
    
    <div class="satellite" data-target="keypoint-modal">
      <div class="step-badge">8</div>
      <div>Key Points<br>é‡é»æé†’</div>
    </div>
    
    <div class="satellite quiz-node" data-target="quiz-modal">
      <div class="step-badge">9</div>
      <div>Quiz<br>30é¡ŒæŒ‘æˆ°</div>
    </div>
  </div>

  <div class="modal-overlay" id="modalOverlay">
    <button class="close-btn" onclick="closeModal()">âœ•</button>

    <div id="type-basic-modal" class="modal-content">
      <h2>1. Basic Verb Types å‹•è©ç¨®é¡</h2>
      <div class="bilingual-box">
        <p>å‹•è©æ˜¯å¥å­çš„å¿ƒè‡Ÿï¼Œæè¿°å‹•ä½œ (Action) æˆ–ç‹€æ…‹ (State)ã€‚</p>
      </div>
      
      <h3>Linking Verbs é€£ç¶´å‹•è©</h3>
      <p>ä¸è¡¨ç¤ºå‹•ä½œï¼Œè€Œæ˜¯é€£æ¥ä¸»èªå’Œæè¿°è©ã€‚</p>
      <div class="table-responsive">
        <table>
          <tr><th>Word</th><th>Example</th></tr>
          <tr><td><strong>be</strong> (is, am, are)</td><td>She <span class="highlight">is</span> a teacher.</td></tr>
          <tr><td><strong>feel</strong> (æ„Ÿè¦º)</td><td>I <span class="highlight">feel</span> tired.</td></tr>
          <tr><td><strong>become</strong> (è®Šå¾—)</td><td>He <span class="highlight">became</span> angry.</td></tr>
        </table>
      </div>

      <h3>Transitive vs Intransitive åŠç‰©/ä¸åŠç‰©</h3>
      <div class="table-responsive">
        <table>
          <tr><th>Type</th><th>Need Object?</th><th>Example</th></tr>
          <tr><td><strong>Transitive (åŠç‰©)</strong></td><td>Yes (éœ€è¦å—è©)</td><td>She <span class="highlight">reads</span> a book.</td></tr>
          <tr><td><strong>Intransitive (ä¸åŠç‰©)</strong></td><td>No (ä¸éœ€è¦)</td><td>The baby <span class="highlight">sleeps</span>.</td></tr>
        </table>
      </div>
    </div>

    <div id="type-helper-modal" class="modal-content">
      <h2>2. Modals & Auxiliary Verbs</h2>
      <p>é€™æ˜¯è‹±èªä¸­æœ€é—œéµçš„è¼”åŠ©ç³»çµ±ã€‚è«‹ä»”ç´°å€åˆ†ã€Œæƒ…æ…‹åŠ©å‹•è©ã€èˆ‡ã€Œä¸€èˆ¬åŠ©å‹•è©ã€ã€‚</p>

      <h3>A. Modal Verbs æƒ…æ…‹åŠ©å‹•è©</h3>
      <div class="note-box note-tip">
        <strong>ç‰¹å¾µï¼š</strong> å¾Œé¢å¿…é ˆæ¥<strong>åŸå½¢å‹•è© (VR)</strong>ï¼Œæ²’æœ‰äººç¨±è®ŠåŒ– (ä¸åŠ  s)ã€‚
      </div>
      <div class="table-responsive">
        <table>
          <tr><th>Modal</th><th>Function (åŠŸèƒ½)</th><th>Example</th></tr>
          <tr><td><strong>can</strong></td><td>èƒ½åŠ› / è¨±å¯</td><td>I can swim.</td></tr>
          <tr><td><strong>could</strong></td><td>éå»èƒ½åŠ› / å§”å©‰è«‹æ±‚</td><td>Could you help me?</td></tr>
          <tr><td><strong>may</strong></td><td>å¯èƒ½ / è¨±å¯ (æ­£å¼)</td><td>It may rain tomorrow.</td></tr>
          <tr><td><strong>might</strong></td><td>å¯èƒ½ (æ©Ÿç‡è¼ƒä½)</td><td>He might come later.</td></tr>
          <tr><td><strong>must</strong></td><td>å¿…é ˆ (å¼·çƒˆ) / æ¨æ¸¬</td><td>You must wear a mask.</td></tr>
          <tr><td><strong>should</strong></td><td>æ‡‰è©² (å»ºè­° / ç¾©å‹™)</td><td>You should sleep early.</td></tr>
          <tr><td><strong>will</strong></td><td>æœªä¾† / æ„é¡˜</td><td>I will call you.</td></tr>
          <tr><td><strong>would</strong></td><td>éå»æœªä¾† / å§”å©‰ / ç¿’æ…£</td><td>I would like some tea.</td></tr>
        </table>
      </div>

      <h3>B. Auxiliary Verbs ä¸€èˆ¬åŠ©å‹•è©</h3>
      <div class="table-responsive">
        <table>
          <tr><th>Verb</th><th>Usage</th><th>Example</th></tr>
          <tr><td><strong>be</strong> (is/am/are)</td><td>é€²è¡Œå¼ / è¢«å‹•èªæ…‹</td><td>She <strong>is</strong> working.</td></tr>
          <tr><td><strong>do</strong> (do/does/did)</td><td>ç–‘å•å¥ / å¦å®šå¥ / å¼·èª¿</td><td><strong>Do</strong> you like it?</td></tr>
          <tr><td><strong>have</strong> (have/has/had)</td><td>å®Œæˆå¼</td><td>I <strong>have</strong> finished.</td></tr>
        </table>
      </div>
    </div>

    <div id="tense-simple-modal" class="modal-content">
      <h2>3. Simple & Continuous Tenses</h2>
      
      <h3>Simple Tenses ç°¡å–®å¼</h3>
      <div class="table-responsive">
        <table>
          <tr><th>Tense</th><th>Usage</th><th>Structure</th></tr>
          <tr><td>Present Simple</td><td>ç¿’æ…£ã€äº‹å¯¦</td><td>S + V(s/es)</td></tr>
          <tr><td>Past Simple</td><td>éå»ç™¼ç”Ÿçš„å‹•ä½œ</td><td>S + V-ed / V2</td></tr>
          <tr><td>Future Simple</td><td>æœªä¾†å‹•ä½œ</td><td>S + will + V</td></tr>
        </table>
      </div>

      <h3>Continuous Tenses é€²è¡Œå¼</h3>
      <div class="table-responsive">
        <table>
          <tr><th>Tense</th><th>Usage</th><th>Structure</th></tr>
          <tr><td>Present Cont.</td><td>ç¾åœ¨æ­£åœ¨é€²è¡Œ</td><td>am/is/are + V-ing</td></tr>
          <tr><td>Past Cont.</td><td>éå»æŸæ™‚æ­£åœ¨åš</td><td>was/were + V-ing</td></tr>
        </table>
      </div>
    </div>

    <div id="tense-perfect-modal" class="modal-content">
      <h2>4. Perfect Tenses å®Œæˆæ™‚æ…‹</h2>
      <div class="note-box note-tip">
        <strong>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µï¼š</strong> å®Œæˆå¼è¡¨ç¤ºã€Œç™¼ç”Ÿåœ¨éå»ï¼Œä½†èˆ‡ç¾åœ¨(æˆ–æŸå€‹æ™‚é–“é»)æœ‰é—œè¯ã€ã€‚
      </div>

      <div class="table-responsive">
        <table>
          <tr><th>Tense</th><th>Structure</th><th>Context</th></tr>
          <tr><td>Present Perfect</td><td>have/has + p.p.</td><td>éå»ç™¼ç”Ÿï¼Œå½±éŸ¿ç¾åœ¨ (I have lost my key.)</td></tr>
          <tr><td>Past Perfect</td><td>had + p.p.</td><td>éå»çš„éå» (She had left before I came.)</td></tr>
          <tr><td>Future Perfect</td><td>will have + p.p.</td><td>æœªä¾†æŸæ™‚ä¹‹å‰å°‡å®Œæˆ</td></tr>
        </table>
      </div>
    </div>

    <div id="visual-modal" class="modal-content">
      <h2>5. Tense Visualization æ™‚æ…‹å¯è¦–åŒ–</h2>
      <p>äº†è§£æ™‚é–“è»¸æ˜¯æŒæ¡æ™‚æ…‹çš„é—œéµã€‚ä»¥ä¸‹æ˜¯ä¸€å€‹ç°¡æ˜“çš„æ™‚æ…‹æ¦‚å¿µåœ–ã€‚</p>
      
      <div class="timeline-preview">
        <div class="timeline-line"></div>
        
        <div class="timeline-point" style="left: 20%;">
          <div class="timeline-label">Past</div>
          <div class="timeline-sub">V-ed / was / did</div>
        </div>
        
        <div class="timeline-point" style="left: 50%; transform: scale(1.3); background: var(--primary-tone);">
          <div class="timeline-label">NOW</div>
          <div class="timeline-sub">Present</div>
        </div>
        
        <div class="timeline-point" style="left: 80%;">
          <div class="timeline-label">Future</div>
          <div class="timeline-sub">will / be going to</div>
        </div>
      </div>

      <div style="text-align:center; margin-top:30px;">
        <p>æƒ³è¦æŸ¥çœ‹åŒ…å«å®Œæˆå¼ã€é€²è¡Œå¼çš„å®Œæ•´äº’å‹•åœ–è¡¨å—ï¼Ÿ</p>
        <a href="https://ducj-creator.github.io/Shirley-Grammar/verbs/tensevisual.html" target="_blank" class="btn-cta" style="font-size:1.1rem; padding:15px 40px;">
          <i class="fas fa-chart-line"></i> é–‹å•Ÿå®Œæ•´æ™‚æ…‹åœ–è¡¨å·¥å…· (Interactive Chart)
        </a>
      </div>
    </div>

    <div id="voice-modal" class="modal-content">
      <h2>7. Passive Voice è¢«å‹•èªæ…‹</h2>
      <p>ç•¶ã€Œå‹•ä½œæ¥å—è€…ã€æ¯”ã€ŒåŸ·è¡Œè€…ã€é‡è¦æ™‚ä½¿ç”¨ã€‚</p>
      <div class="note-box note-tip">
        <strong>å…¬å¼ï¼š</strong> Beå‹•è© + éå»åˆ†è© (p.p.)
      </div>

      <div class="table-responsive">
        <table>
          <tr><th>Tense</th><th>Passive Structure</th><th>Example</th></tr>
          <tr><td>Present</td><td>am/is/are + p.p.</td><td>The door is locked.</td></tr>
          <tr><td>Past</td><td>was/were + p.p.</td><td>My bike was stolen.</td></tr>
          <tr><td>Future</td><td>will be + p.p.</td><td>It will be done.</td></tr>
          <tr><td>Perfect</td><td>have been + p.p.</td><td>It has been fixed.</td></tr>
        </table>
      </div>
    </div>

    <div id="keypoint-modal" class="modal-content">
      <h2>8. Key Points & Reminders</h2>
      <div class="bilingual-box">
        <div style="flex:1">
          <h3>Phrasal Verbs å‹•è©ç‰‡èª</h3>
          <p>å‹•è© + ä»‹ç³»è© = æ–°æ„ç¾©ã€‚</p>
          <ul>
            <li><strong>give up</strong> (æ”¾æ£„)</li>
            <li><strong>look after</strong> (ç…§é¡§)</li>
          </ul>
          <a href="https://ducj-creator.github.io/Shirley-Grammar/phrases" target="_blank" style="color:var(--primary-tone); font-weight:bold;">â†’ å­¸ç¿’æ›´å¤šç‰‡èª</a>
        </div>
        <div style="flex:1">
          <h3>Common Mistakes</h3>
          <ul>
            <li><span style="color:#c62828">X</span> She like pizza.</li>
            <li><span style="color:#2e7d32">O</span> She like<strong>s</strong> pizza. (3rd Person)</li>
            <li><span style="color:#c62828">X</span> I must to go.</li>
            <li><span style="color:#2e7d32">O</span> I must go. (Modal + VR)</li>
          </ul>
        </div>
      </div>
    </div>

    <div id="quiz-modal" class="modal-content">
      <h2>9. Verb Challenge (30 Qs) ğŸ†</h2>
      <p style="margin-bottom:20px; color:#666;">Test your mastery of English Verbs!</p>
      <div id="quiz-container"></div>
      <div id="result-area" class="result-card">
        <div class="result-score" id="score-display">0 / 30</div>
        <h3>Quiz Completed!</h3>
        <p id="result-msg"></p>
        <button onclick="startQuiz()" class="btn-cta">â†º Restart Quiz</button>
      </div>
    </div>

  </div>

  <script>
    // === 1. Floating Background ===
    const floatWords = ['Run', 'Swim', 'Eat', 'Go', 'Do', 'Have', 'Be', 'Can', 'Will', 'Must', 'Play', 'Sleep', 'Read', 'Write'];
    const floatContainer = document.getElementById('floatingBg');

    function createFloatingIcons() {
      for(let i=0; i<20; i++) {
        const el = document.createElement('div');
        el.classList.add('float-item');
        el.innerText = floatWords[Math.floor(Math.random() * floatWords.length)];
        el.style.left = Math.random() * 100 + 'vw';
        el.style.animationDuration = (22 + Math.random() * 10) + 's';
        el.style.animationDelay = (Math.random() * 5) + 's';
        el.style.fontSize = (1.5 + Math.random() * 2) + 'rem';
        floatContainer.appendChild(el);
      }
    }
    createFloatingIcons();

    // === 2. Mind Map Layout ===
    function updateLayout() {
      const satellites = document.querySelectorAll('.satellite');
      const stage = document.getElementById('stage');
      const svg = document.getElementById('svgLines');
      const isMobile = window.innerWidth <= 768;

      while(svg.firstChild) svg.removeChild(svg.firstChild);

      if(isMobile) return; 

      const centerX = stage.offsetWidth / 2;
      const centerY = stage.offsetHeight / 2;
      const radius = 290;
      const total = satellites.length;

      satellites.forEach((node, index) => {
        const angle = (index / total) * 2 * Math.PI - (Math.PI / 2);
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);

        node.style.left = x + 'px';
        node.style.top = y + 'px';
        node.style.transform = 'translate(-50%, -50%)';

        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', centerX);
        line.setAttribute('y1', centerY);
        line.setAttribute('x2', x);
        line.setAttribute('y2', y);
        line.classList.add('connection-line');
        svg.appendChild(line);
      });
    }
    window.addEventListener('resize', updateLayout);
    window.addEventListener('load', updateLayout);

    // === 3. Modal Logic ===
    const overlay = document.getElementById('modalOverlay');
    document.querySelectorAll('.satellite').forEach(btn => {
      btn.addEventListener('click', () => {
        if(btn.classList.contains('special-node') && !btn.hasAttribute('data-target')) return;
        const targetId = btn.getAttribute('data-target');
        if(!targetId) return;

        document.querySelectorAll('.modal-content').forEach(c => c.style.display = 'none');
        document.getElementById(targetId).style.display = 'block';
        overlay.classList.add('active');
        if(targetId === 'quiz-modal') startQuiz();
      });
    });
    function closeModal() { overlay.classList.remove('active'); }
    overlay.addEventListener('click', (e) => { if(e.target === overlay) closeModal(); });

    // === 4. Quiz Logic (30 Questions) ===
    const quizQuestions = [
        { q: "1. She _____ tired after the long run.", options: ["looks", "look", "is looking", "looked at"], correct: 0, expl: "Looks is a linking verb connecting She to tired." },
        { q: "2. The soup _____ delicious.", options: ["tastes", "tasting", "taste", "is tasted"], correct: 0, expl: "Tastes describes the state of the soup (singular)." },
        { q: "3. Please _____ the book on the table.", options: ["lie", "lay", "rise", "sat"], correct: 1, expl: "Lay is transitive (needs object the book)." },
        { q: "4. When I was five, I _____ swim very well.", options: ["can", "could", "should", "will"], correct: 1, expl: "Could expresses ability in the past." },
        { q: "5. You _____ wear a seatbelt when driving. It's the law.", options: ["must", "might", "could", "may"], correct: 0, expl: "Must is used for strong obligations or laws." },
        { q: "6. You look sick. You _____ go to the doctor.", options: ["should", "can", "will", "might"], correct: 0, expl: "Should is used to give advice." },
        { q: "7. _____ you like pizza?", options: ["Are", "Do", "Have", "Can"], correct: 1, expl: "Use Do for Present Simple questions with main verbs." },
        { q: "8. _____ you finished your homework yet?", options: ["Did", "Have", "Are", "Do"], correct: 1, expl: "Use Have for Present Perfect (Have + V3)." },
        { q: "9. My brother _____ to school every morning.", options: ["walk", "walks", "is walking", "walked"], correct: 1, expl: "Present Simple for habits. Singular subject." },
        { q: "10. We _____ to London last summer.", options: ["go", "gone", "went", "have gone"], correct: 2, expl: "Past Simple (went) for specific past time." },
        { q: "11. Don't worry, I _____ help you.", options: ["am going to", "will", "am", "shall"], correct: 1, expl: "Will for offers/decisions at the moment." },
        { q: "12. Listen! The baby _____.", options: ["cries", "is crying", "cried", "has cried"], correct: 1, expl: "Present Continuous for actions happening now." },
        { q: "13. I _____ TV when the phone rang.", options: ["watched", "am watching", "was watching", "have watched"], correct: 2, expl: "Past Continuous interrupted by a short action." },
        { q: "14. I _____ my keys. I can't find them anywhere.", options: ["lose", "lost", "have lost", "am losing"], correct: 2, expl: "Present Perfect (result in present)." },
        { q: "15. She has lived here _____ ten years.", options: ["since", "for", "in", "during"], correct: 1, expl: "For + duration of time." },
        { q: "16. The train _____ already left when we arrived.", options: ["has", "had", "was", "did"], correct: 1, expl: "Past Perfect (had left) happened before another past action." },
        { q: "17. By next year, I _____ from university.", options: ["will graduate", "graduate", "will have graduated", "graduated"], correct: 2, expl: "Future Perfect (completed by a future time)." },
        { q: "18. It _____ raining all day.", options: ["is", "has been", "was", "did"], correct: 1, expl: "Present Perfect Continuous emphasizing duration." },
        { q: "19. The letter _____ by Mark yesterday.", options: ["wrote", "was written", "is written", "writes"], correct: 1, expl: "Past Passive: was + written." },
        { q: "20. English _____ spoken in many countries.", options: ["is", "are", "has", "does"], correct: 0, expl: "Present Passive: is + spoken." },
        { q: "21. The work _____ be finished tomorrow.", options: ["will", "is", "has", "did"], correct: 0, expl: "Future Passive: will + be + finished." },
        { q: "22. I enjoy _____ movies on weekends.", options: ["watch", "to watch", "watching", "watched"], correct: 2, expl: "Enjoy + V-ing (Gerund)." },
        { q: "23. She decided _____ to Paris.", options: ["go", "going", "to go", "went"], correct: 2, expl: "Decide + to V (Infinitive)." },
        { q: "24. He stopped _____ because it was bad for his health.", options: ["smoking", "to smoke", "smoke", "smoked"], correct: 0, expl: "Stop + V-ing means to quit." },
        { q: "25. If it rains, I _____ stay at home.", options: ["would", "will", "am", "stayed"], correct: 1, expl: "First Conditional: If + Present, ... will." },
        { q: "26. If I _____ a bird, I would fly to you.", options: ["was", "am", "were", "be"], correct: 2, expl: "Second Conditional uses 'were' for all subjects." },
        { q: "27. Please turn _____ the lights when you leave.", options: ["on", "in", "off", "up"], correct: 2, expl: "Turn off = stop the light." },
        { q: "28. Everyone _____ happy about the news.", options: ["are", "is", "were", "have"], correct: 1, expl: "Everyone is singular." },
        { q: "29. I _____ you are right.", options: ["am believing", "believe", "believed", "was believing"], correct: 1, expl: "Believe is a stative verb (no continuous)." },
        { q: "30. The teacher made the student _____ his homework.", options: ["rewrite", "to rewrite", "rewriting", "rewritten"], correct: 0, expl: "Make someone do (base form)." }
    ];

    let currentQ = 0;
    let score = 0;

    function startQuiz() {
      currentQ = 0;
      score = 0;
      document.getElementById('quiz-container').style.display = 'block';
      document.getElementById('result-area').style.display = 'none';
      renderQuestion();
    }

    function renderQuestion() {
      if(currentQ >= quizQuestions.length) {
        showResult();
        return;
      }
      const q = quizQuestions[currentQ];
      const container = document.getElementById('quiz-container');
      
      let html = `
        <div class="quiz-progress">Question ${currentQ + 1} / ${quizQuestions.length}</div>
        <div class="quiz-question-box">
          <div class="quiz-q-text">${q.q.replace('_____', '<span style="border-bottom:2px solid var(--secondary-tone); color:var(--secondary-tone);">?</span>')}</div>
          <div class="quiz-options-grid">
            ${q.options.map((opt, idx) => `
              <button class="quiz-opt" onclick="checkAns(this, ${idx})">${opt}</button>
            `).join('')}
          </div>
          <div class="explanation" id="expl-${currentQ}">${q.expl}</div>
          <div class="quiz-nav" id="nav-${currentQ}">
            <button class="btn-cta" onclick="nextQ()">Next â†’</button>
          </div>
        </div>
      `;
      container.innerHTML = html;
    }

    function checkAns(btn, idx) {
      const q = quizQuestions[currentQ];
      const parent = btn.parentElement;
      const allBtns = parent.querySelectorAll('.quiz-opt');
      
      allBtns.forEach(b => b.disabled = true);
      
      if(idx === q.correct) {
        btn.classList.add('correct');
        score++;
      } else {
        btn.classList.add('incorrect');
        allBtns[q.correct].classList.add('correct');
      }
      
      document.getElementById(`expl-${currentQ}`).classList.add('show');
      document.getElementById(`nav-${currentQ}`).classList.add('show');
    }

    function nextQ() {
      currentQ++;
      renderQuestion();
    }

    function showResult() {
      document.getElementById('quiz-container').style.display = 'none';
      document.getElementById('result-area').style.display = 'block';
      document.getElementById('score-display').innerText = `${score} / 30`;
      
      let msg = "";
      if(score === 30) msg = "Perfect! You are a Verb Master! ğŸ†";
      else if(score >= 24) msg = "Excellent work! Keep it up! ğŸŒŸ";
      else if(score >= 18) msg = "Good job! Review the tricky parts. ğŸ’ª";
      else msg = "Keep practicing! You can do it! ğŸ“š";
      
      document.getElementById('result-msg').innerText = msg;
    }
  </script>
</body>
</html>
