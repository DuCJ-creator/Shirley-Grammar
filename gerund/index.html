<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Shirley's Grammar | Gerunds</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;0,700;1,500&family=Inter:wght@400;500;600&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      /* --- å‹•åè©å°ˆå±¬é…è‰² (Purple & Teal) --- */
      --primary-tone: #4a148c; /* çš‡å®¶æ·±ç´« */
      --secondary-tone: #00b894; /* æ´»åŠ›é’/ç¶ æ¾çŸ³ */
      --text-main: #2d3436;
      --bg-cool: #f3e5f5; /* æ·¡ç´«æ°›åœèƒŒæ™¯ */
      --highlight-bg: #e0f2f1; /* é’è‰²è¢å…‰ç­†åº• */
      
      /* --- å°ºå¯¸è®Šæ•¸ --- */
      --node-size: 115px; 
      --center-size: 200px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      background-color: var(--bg-cool);
      color: var(--text-main);
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      position: relative;
    }

    /* === 1. èƒŒæ™¯æ¼‚æµ®å–®å­— (Floating Gerunds) === */
    .floating-objects {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 0; overflow: hidden;
    }
    .float-item {
      position: absolute; opacity: 0.08;
      font-family: 'Playfair Display', serif; font-weight: 700;
      color: var(--primary-tone);
      animation: floatUp 30s infinite linear;
      white-space: nowrap;
    }
    @keyframes floatUp {
      0% { transform: translateY(110vh) rotate(0deg); }
      100% { transform: translateY(-20vh) rotate(360deg); }
    }

    /* === 2. Mind Map èˆå° === */
    .mindmap-stage {
      position: relative; width: 100%; height: 100%;
      display: flex; justify-content: center; align-items: center;
      z-index: 10;
    }
    .connections {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 1;
    }
    .connection-line {
      stroke: var(--secondary-tone); stroke-width: 2;
      stroke-dasharray: 6, 6; opacity: 0.5;
    }

    /* æ ¸å¿ƒ Core */
    .core-node {
      width: var(--center-size); height: var(--center-size);
      background: var(--primary-tone); color: white;
      border-radius: 50%;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      text-align: center; z-index: 5;
      box-shadow: 0 0 0 12px rgba(74, 20, 140, 0.08), 0 25px 50px rgba(0,0,0,0.25);
      animation: corePulse 5s infinite ease-in-out; cursor: default;
    }
    .core-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 700; line-height: 1.1; }
    .core-sub { font-size: 0.75rem; letter-spacing: 2px; text-transform: uppercase; margin-top: 8px; color: var(--secondary-tone); }

    @keyframes corePulse {
      0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); }
    }

    /* å­ç¯€é» Satellite */
    .satellite {
      position: absolute; width: var(--node-size); height: var(--node-size);
      border-radius: 50%; background: white;
      border: 2px solid var(--primary-tone);
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      text-align: center; cursor: pointer; z-index: 5;
      box-shadow: 0 10px 25px rgba(74, 20, 140, 0.1);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-family: 'Playfair Display', serif; font-weight: 600;
      font-size: 0.85rem; color: var(--primary-tone); padding: 5px;
    }
    .satellite:hover {
      transform: scale(1.15); background: var(--primary-tone);
      color: white; border-color: var(--secondary-tone);
      box-shadow: 0 15px 35px rgba(74, 20, 140, 0.3); z-index: 10;
    }

    .step-badge {
      position: absolute; top: -5px; left: 50%; transform: translateX(-50%);
      background: var(--secondary-tone); color: white;
      font-family: 'Inter', sans-serif; font-size: 0.8rem; font-weight: 700;
      width: 24px; height: 24px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .satellite.quiz-node { border-color: var(--secondary-tone); background: #e0f2f1; }
    .satellite.quiz-node .step-badge { background: #d32f2f; }

    /* === 3. Modal å…§å®¹å€ === */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(243, 229, 245, 0.95); backdrop-filter: blur(5px);
      z-index: 100; opacity: 0; pointer-events: none;
      transition: opacity 0.3s ease;
      display: flex; justify-content: center; align-items: center;
    }
    .modal-overlay.active { opacity: 1; pointer-events: auto; }

    .modal-content {
      width: 90%; max-width: 950px; max-height: 85vh;
      background: white; border-radius: 16px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.2);
      border-top: 6px solid var(--primary-tone);
      overflow-y: auto; padding: 40px;
      display: none; animation: slideUp 0.4s ease-out;
    }
    @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .close-btn {
      position: absolute; top: 20px; right: 20px;
      width: 40px; height: 40px; border-radius: 50%; border: none;
      background: #f4f4f4; color: var(--text-main); font-size: 1.5rem;
      cursor: pointer; transition: all 0.2s; z-index: 20;
    }
    .close-btn:hover { background: var(--secondary-tone); color: white; }

    /* å…§å®¹æ’ç‰ˆ */
    h2 { font-family: 'Playfair Display', serif; font-size: 2rem; color: var(--primary-tone); margin-bottom: 20px; border-bottom: 2px solid var(--secondary-tone); padding-bottom: 10px; }
    h3 { font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--primary-tone); margin: 30px 0 15px; border-left: 4px solid var(--secondary-tone); padding-left: 12px; }
    
    .bilingual-box { display: flex; gap: 20px; background: #fafafa; padding: 25px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 20px; }
    .highlight { background: var(--highlight-bg); padding: 2px 6px; border-radius: 4px; color: var(--primary-tone); font-weight: 600; }
    
    /* Table */
    .table-responsive { overflow-x: auto; margin: 20px 0; border: 1px solid #e0e0e0; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; min-width: 600px; }
    th { background: #e0f2f1; color: var(--primary-tone); padding: 15px; text-align: left; font-family: 'Playfair Display', serif; border-bottom: 2px solid #b2dfdb; white-space: nowrap; }
    td { padding: 14px; border-bottom: 1px solid #eee; }
    tr:nth-child(even) { background-color: #fbfbfb; }

    /* Note Box */
    .note-box { padding: 20px; margin: 20px 0; border-radius: 0 8px 8px 0; line-height: 1.6; }
    .note-tip { background: #f3e5f5; border-left: 4px solid var(--primary-tone); color: #4a148c; }
    .note-warn { background: #fff5f5; border-left: 4px solid #c53030; color: #742a2a; }

    /* Audio Button */
    .audio-btn { background: var(--secondary-tone); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; margin-left: 10px; transition: 0.2s; font-size: 0.8rem; }
    .audio-btn:hover { background: var(--primary-tone); transform: scale(1.1); }

    /* Flip Cards (Interactive) */
    .flip-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; margin: 20px 0; }
    .flip-card { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; text-align: center; cursor: pointer; transition: 0.3s; position: relative; height: 100px; display: flex; align-items: center; justify-content: center; perspective: 1000px; }
    .flip-card:hover { border-color: var(--secondary-tone); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    .flip-text { font-weight: bold; color: var(--primary-tone); font-size: 1.1rem; }
    .flip-sub { font-size: 0.85rem; color: #666; margin-top: 5px; }

    /* Quiz Styling */
    .quiz-progress { text-align: right; color: var(--secondary-tone); font-weight: 700; margin-bottom: 15px; }
    .quiz-question-box { background: #fff; padding: 25px; border-radius: 12px; border: 1px solid #eee; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
    .quiz-q-text { font-size: 1.2rem; font-weight: 600; color: var(--primary-tone); margin-bottom: 20px; }
    .quiz-opt { display: block; width: 100%; padding: 15px 20px; margin-bottom: 10px; border: 2px solid #f0f0f0; border-radius: 8px; background: white; text-align: left; cursor: pointer; transition: all 0.2s; font-size: 1rem; }
    .quiz-opt:hover:not(:disabled) { border-color: var(--secondary-tone); background: #e0f2f1; }
    .quiz-opt.correct { background: #e8f5e9; border-color: #4caf50; color: #2e7d32; }
    .quiz-opt.incorrect { background: #ffebee; border-color: #ef5350; color: #c62828; }
    
    .explanation { margin-top: 20px; padding: 15px; background: #faf8f2; border-left: 4px solid var(--secondary-tone); display: none; }
    .explanation.show { display: block; animation: fadeIn 0.3s; }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
    
    .result-card { text-align: center; padding: 40px; display: none; }
    .result-score { font-size: 4rem; font-family: 'Playfair Display', serif; color: var(--primary-tone); font-weight: 700; }
    
    .btn-cta { background: var(--secondary-tone); color: white; padding: 12px 30px; border-radius: 50px; border: none; font-size: 1rem; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; transition: 0.3s; font-weight: 600; margin-top: 15px; }
    .btn-cta:hover { background: var(--primary-tone); transform: translateY(-2px); }

    /* RWD */
    @media (max-width: 768px) {
      body { overflow-y: auto; height: auto; }
      .floating-objects { height: 100vh; position: fixed; }
      .mindmap-stage { flex-direction: column; height: auto; padding: 50px 20px; }
      .connections { display: none; }
      .core-node { margin-bottom: 40px; width: 160px; height: 160px; }
      .satellite { 
        position: relative; top: auto !important; left: auto !important; transform: none !important;
        width: 100%; min-height: 70px; margin-bottom: 12px; flex-direction: row; 
        justify-content: flex-start; text-align: left; gap: 20px; padding: 15px 25px;
      }
      .satellite:hover { transform: translateY(-3px) !important; }
      .step-badge { position: static; transform: none; margin-right: 0; min-width: 24px; }
      .modal-content { padding: 25px; width: 95%; max-height: 90vh; }
      .bilingual-box { flex-direction: column; }
    }
  </style>
</head>
<body>

  <div class="floating-objects" id="floatingBg"></div>

  <div class="mindmap-stage" id="stage">
    <svg class="connections" id="svgLines"></svg>

    <div class="core-node">
      <div class="core-title">Shirley's<br>Gerunds</div>
      <div class="core-sub">Non-finite Series 2</div>
    </div>

    <div class="satellite" data-target="def-modal">
      <div class="step-badge">1</div>
      <div>Definition<br>å®šç¾©èˆ‡å½¢å¼</div>
    </div>
    
    <div class="satellite" data-target="roles-modal">
      <div class="step-badge">2</div>
      <div>Roles<br>å¥ä¸­è§’è‰²</div>
    </div>
    
    <div class="satellite" data-target="prep-modal">
      <div class="step-badge">3</div>
      <div>Preposition<br>ä»‹ä¿‚è©å¾Œ</div>
    </div>
    
    <div class="satellite" data-target="verbs-modal">
      <div class="step-badge">4</div>
      <div>Key Verbs<br>å¿…æ¥å‹•åè©</div>
    </div>

    <div class="satellite" data-target="change-modal">
      <div class="step-badge">5</div>
      <div>Change<br>æ„æ€æ”¹è®Š</div>
    </div>

    <div class="satellite" data-target="activities-modal">
      <div class="step-badge">6</div>
      <div>Activities<br>ä¼‘é–’æ´»å‹•</div>
    </div>

    <div class="satellite" data-target="idiom-modal">
      <div class="step-badge">7</div>
      <div>Idioms<br>æ…£ç”¨èª</div>
    </div>
    
    <div class="satellite quiz-node" data-target="quiz-modal">
      <div class="step-badge">8</div>
      <div>Quiz<br>20é¡ŒæŒ‘æˆ°</div>
    </div>
  </div>

  <div class="modal-overlay" id="modalOverlay">
    <button class="close-btn" onclick="closeModal()">âœ•</button>

    <div id="def-modal" class="modal-content">
      <h2>1. Definition å®šç¾©èˆ‡å½¢å¼</h2>
      <div class="bilingual-box">
        <div style="flex:1">
          <p>å‹•åè© (Gerund) æ˜¯ç”±å‹•è©åŠ ä¸Š <strong>-ing</strong> å½¢æˆã€‚</p>
          <h3 style="text-align:center; color:var(--primary-tone); margin:20px 0;">Verb + ing = Noun</h3>
          <p>å®ƒçš„æ€§è³ªæ˜¯åè©ï¼Œè¡¨ç¤ºã€Œå·²çŸ¥çš„äº‹å¯¦ã€ã€ã€Œç¶“é©—ã€æˆ–ã€Œæ´»å‹•ã€ã€‚</p>
        </div>
      </div>
      <div class="note-box note-tip">
        <strong>æ¯”è¼ƒï¼š</strong> ä¸å®šè© (to V) å¸¸ç”¨æ–¼æœªä¾†/ç›®çš„ï¼›å‹•åè© (V-ing) å¸¸ç”¨æ–¼ç¶“é©—/äº‹å¯¦ã€‚
      </div>
    </div>

    <div id="roles-modal" class="modal-content">
      <h2>2. Roles å¥ä¸­è§’è‰²</h2>
      <p>å‹•åè©å°±åƒæ™®é€šåè©ä¸€æ¨£ï¼Œå¯ä»¥åœ¨å¥ä¸­æ“”ä»»å„ç¨®è§’è‰²ã€‚</p>
      
      <div class="table-responsive">
        <table>
          <tr><th>Role</th><th>Example</th><th>Translation</th></tr>
          <tr>
            <td><strong>Subject (ä¸»è©)</strong></td>
            <td><span class="highlight">Swimming</span> is fun.<button class="audio-btn" onclick="speak('Swimming is fun.')">ğŸ”Š</button></td>
            <td>æ¸¸æ³³å¾ˆå¥½ç© (è¦–ç‚ºå–®æ•¸)</td>
          </tr>
          <tr>
            <td><strong>Object (å—è©)</strong></td>
            <td>I enjoy <span class="highlight">reading</span>.<button class="audio-btn" onclick="speak('I enjoy reading.')">ğŸ”Š</button></td>
            <td>æˆ‘äº«å—é–±è®€</td>
          </tr>
          <tr>
            <td><strong>Complement (è£œèª)</strong></td>
            <td>My hobby is <span class="highlight">cooking</span>.<button class="audio-btn" onclick="speak('My hobby is cooking.')">ğŸ”Š</button></td>
            <td>æˆ‘çš„å—œå¥½æ˜¯çƒ¹é£ª</td>
          </tr>
        </table>
      </div>
    </div>

    <div id="prep-modal" class="modal-content">
      <h2>3. After Prepositions ä»‹ä¿‚è©å¾Œ</h2>
      <div class="note-box note-warn">
        <strong>âš ï¸ é»ƒé‡‘æ³•å‰‡ï¼š</strong> ä»‹ä¿‚è© (in, on, at, for, of, about, with...) å¾Œé¢å¦‚æœé‡åˆ°å‹•è©ï¼Œ<strong>ä¸€å®šè¦ç”¨ V-ing</strong>ã€‚
      </div>

      <div class="table-responsive">
        <table>
          <tr><th>Phrase</th><th>Example</th></tr>
          <tr><td>good <strong>at</strong></td><td>He is good at <span class="highlight">drawing</span>.</td></tr>
          <tr><td>interested <strong>in</strong></td><td>I am interested in <span class="highlight">learning</span> art.</td></tr>
          <tr><td>thank you <strong>for</strong></td><td>Thank you for <span class="highlight">coming</span>.</td></tr>
          <tr><td>afraid <strong>of</strong></td><td>She is afraid of <span class="highlight">flying</span>.</td></tr>
        </table>
      </div>

      <h3>ğŸ’¡ Tricky Preposition: "To"</h3>
      <p>æœ‰æ™‚å€™ "to" æ˜¯ä»‹ä¿‚è©ï¼Œä¸æ˜¯ä¸å®šè©çš„ä¸€éƒ¨åˆ†ï¼Œé€™æ™‚å¾Œé¢è¦æ¥ V-ingï¼</p>
      <ul>
        <li><strong>look forward to</strong> (æœŸå¾…) + <span class="highlight">seeing</span> you.</li>
        <li><strong>used to</strong> (ç¿’æ…£æ–¼) + <span class="highlight">living</span> here. (be used to)</li>
      </ul>
    </div>

    <div id="verbs-modal" class="modal-content">
      <h2>4. Key Verbs å¿…æ¥å‹•åè©</h2>
      <p>é€™äº›å‹•è©å¾Œé¢åªèƒ½æ¥ V-ingï¼Œä¸èƒ½æ¥ to Vã€‚</p>
      
      <div class="flip-grid">
        <div class="flip-card">
          <div><div class="flip-text">enjoy</div><div class="flip-sub">äº«å—</div></div>
        </div>
        <div class="flip-card">
          <div><div class="flip-text">finish</div><div class="flip-sub">å®Œæˆ</div></div>
        </div>
        <div class="flip-card">
          <div><div class="flip-text">avoid</div><div class="flip-sub">é¿å…</div></div>
        </div>
        <div class="flip-card">
          <div><div class="flip-text">mind</div><div class="flip-sub">ä»‹æ„</div></div>
        </div>
        <div class="flip-card">
          <div><div class="flip-text">practice</div><div class="flip-sub">ç·´ç¿’</div></div>
        </div>
        <div class="flip-card">
          <div><div class="flip-text">keep</div><div class="flip-sub">ä¿æŒ/ç¹¼çºŒ</div></div>
        </div>
        <div class="flip-card">
          <div><div class="flip-text">quit</div><div class="flip-sub">æˆ’é™¤/æ”¾æ£„</div></div>
        </div>
        <div class="flip-card">
          <div><div class="flip-text">suggest</div><div class="flip-sub">å»ºè­°</div></div>
        </div>
      </div>
      <p style="text-align:center; color:#666; font-size:0.9rem;">(æ»‘é¼ æ‡¸åœæˆ–é»æ“Šå¡ç‰‡å¯å¼·åŒ–è¨˜æ†¶)</p>
    </div>

    <div id="change-modal" class="modal-content">
      <h2>5. Change in Meaning æ„æ€æ”¹è®Š</h2>
      <p>æœ‰äº›å‹•è©æ¥ to V æˆ– V-ing æ„æ€å®Œå…¨ä¸åŒã€‚</p>
      
      <div class="table-responsive">
        <table>
          <tr><th>Verb</th><th>+ V-ing (Gerund)</th><th>+ to V (Infinitive)</th></tr>
          <tr>
            <td><strong>Stop</strong></td>
            <td>åœæ­¢æ­£åœ¨åšçš„äº‹<br><em>Stop <span class="highlight">smoking</span></em> (æˆ’è¸)</td>
            <td>åœä¸‹ä¾†å»åšå¦ä¸€ä»¶äº‹<br><em>Stop <span class="highlight">to smoke</span></em> (åœä¸‹ä¾†å»æŠ½è¸)</td>
          </tr>
          <tr>
            <td><strong>Remember</strong></td>
            <td>è¨˜å¾—åšéçš„äº‹ (å›æ†¶)<br><em>I remember <span class="highlight">locking</span> the door.</em></td>
            <td>è¨˜å¾—è¦å»åšçš„äº‹ (æé†’)<br><em>Remember <span class="highlight">to lock</span> the door.</em></td>
          </tr>
          <tr>
            <td><strong>Forget</strong></td>
            <td>å¿˜è¨˜åšéçš„äº‹<br><em>I forgot <span class="highlight">meeting</span> him.</em></td>
            <td>å¿˜è¨˜è¦å»åšçš„äº‹<br><em>Don't forget <span class="highlight">to meet</span> him.</em></td>
          </tr>
          <tr>
            <td><strong>Try</strong></td>
            <td>è©¦è©¦çœ‹ (æ–¹æ³•)<br><em>Try <span class="highlight">eating</span> less.</em></td>
            <td>åŠªåŠ›/ä¼åœ– (ç›®çš„)<br><em>Try <span class="highlight">to move</span> the rock.</em></td>
          </tr>
        </table>
      </div>
    </div>

    <div id="activities-modal" class="modal-content">
      <h2>6. Go + V-ing ä¼‘é–’æ´»å‹•</h2>
      <p>è‹±èªä¸­è¨±å¤šæˆ¶å¤–æ´»å‹•æˆ–ä¼‘é–’å¨›æ¨‚ï¼Œç¿’æ…£ç”¨ <strong>Go + V-ing</strong> è¡¨ç¤ºã€‚</p>
      
      <div class="flip-grid">
        <div class="flip-card">Go <strong>shopping</strong></div>
        <div class="flip-card">Go <strong>swimming</strong></div>
        <div class="flip-card">Go <strong>fishing</strong></div>
        <div class="flip-card">Go <strong>camping</strong></div>
        <div class="flip-card">Go <strong>hiking</strong></div>
        <div class="flip-card">Go <strong>jogging</strong></div>
      </div>
    </div>

    <div id="idiom-modal" class="modal-content">
      <h2>7. Common Idioms æ…£ç”¨èª</h2>
      <div class="bilingual-box">
        <ul>
          <li>It is no use <span class="highlight">crying</span> over spilt milk. (åš...æ²’ç”¨)</li>
          <li>The book is worth <span class="highlight">reading</span>. (å€¼å¾—åš...)</li>
          <li>I am busy <span class="highlight">studying</span>. (å¿™æ–¼åš...)</li>
          <li>Can't help <span class="highlight">laughing</span>. (å¿ä¸ä½...)</li>
          <li>Spend time/money <span class="highlight">playing</span> games. (èŠ±è²»...)</li>
        </ul>
      </div>
    </div>

    <div id="quiz-modal" class="modal-content">
      <h2>8. Gerund Challenge (20 Qs) ğŸ†</h2>
      <p style="margin-bottom:20px; color:#666;">Test your knowledge of Gerunds!</p>
      <div id="quiz-container"></div>
      <div id="result-area" class="result-card">
        <div class="result-score" id="score-display">0 / 20</div>
        <h3>Quiz Completed!</h3>
        <p id="result-msg"></p>
        <button onclick="startQuiz()" class="btn-cta">â†º Restart Quiz</button>
      </div>
    </div>

  </div>

  <script>
    // === 1. Floating Background ===
    const floatWords = ['Swimming', 'Reading', 'Eating', 'Going', 'Playing', 'Sleeping', 'Running', 'Cooking', 'Dancing', 'Learning'];
    const floatContainer = document.getElementById('floatingBg');

    function createFloatingIcons() {
      for(let i=0; i<15; i++) {
        const el = document.createElement('div');
        el.classList.add('float-item');
        el.innerText = floatWords[Math.floor(Math.random() * floatWords.length)];
        el.style.left = Math.random() * 100 + 'vw';
        el.style.animationDuration = (25 + Math.random() * 10) + 's';
        el.style.animationDelay = (Math.random() * 5) + 's';
        el.style.fontSize = (1.5 + Math.random() * 2) + 'rem';
        floatContainer.appendChild(el);
      }
    }
    createFloatingIcons();

    // === 2. Mind Map Layout ===
    function updateLayout() {
      const satellites = document.querySelectorAll('.satellite');
      const stage = document.getElementById('stage');
      const svg = document.getElementById('svgLines');
      const isMobile = window.innerWidth <= 768;

      while(svg.firstChild) svg.removeChild(svg.firstChild);

      if(isMobile) return; 

      const centerX = stage.offsetWidth / 2;
      const centerY = stage.offsetHeight / 2;
      const radius = 280;
      const total = satellites.length;

      satellites.forEach((node, index) => {
        const angle = (index / total) * 2 * Math.PI - (Math.PI / 2);
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);

        node.style.left = x + 'px';
        node.style.top = y + 'px';
        node.style.transform = 'translate(-50%, -50%)';

        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', centerX);
        line.setAttribute('y1', centerY);
        line.setAttribute('x2', x);
        line.setAttribute('y2', y);
        line.classList.add('connection-line');
        svg.appendChild(line);
      });
    }
    window.addEventListener('resize', updateLayout);
    window.addEventListener('load', updateLayout);

    // === 3. Modal Logic ===
    const overlay = document.getElementById('modalOverlay');
    document.querySelectorAll('.satellite').forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.getAttribute('data-target');
        if(!targetId) return;

        document.querySelectorAll('.modal-content').forEach(c => c.style.display = 'none');
        document.getElementById(targetId).style.display = 'block';
        overlay.classList.add('active');
        if(targetId === 'quiz-modal') startQuiz();
      });
    });
    function closeModal() { overlay.classList.remove('active'); }
    overlay.addEventListener('click', (e) => { if(e.target === overlay) closeModal(); });

    function speak(text) {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        speechSynthesis.speak(utterance);
      }
    }

    // === 4. Quiz Logic (20 Qs) ===
    const quizQuestions = [
      { q: "I enjoy _____ movies.", options: ["watch", "watching", "to watch", "watched"], correct: 1, expl: "Enjoy + V-ing (Gerund)." },
      { q: "She is good at _____.", options: ["cook", "to cook", "cooking", "cooked"], correct: 2, expl: "Preposition (at) + V-ing." },
      { q: "Would you mind _____ the window?", options: ["open", "to open", "opening", "opened"], correct: 2, expl: "Mind + V-ing." },
      { q: "He stopped _____ because it was bad for his health.", options: ["smoking", "to smoke", "smoke", "smoked"], correct: 0, expl: "Stop + V-ing (quit an action)." },
      { q: "We look forward to _____ you.", options: ["see", "seeing", "saw", "seen"], correct: 1, expl: "Look forward to + V-ing ('to' is a preposition here)." },
      { q: "_____ is my favorite hobby.", options: ["Read", "Reading", "Reads", "To read"], correct: 1, expl: "Gerund as Subject (more common for hobbies)." },
      { q: "I avoided _____ to him.", options: ["talk", "to talk", "talking", "talked"], correct: 2, expl: "Avoid + V-ing." },
      { q: "Please keep _____.", options: ["try", "trying", "to try", "tried"], correct: 1, expl: "Keep + V-ing." },
      { q: "It is no use _____ about it.", options: ["worry", "to worry", "worrying", "worried"], correct: 2, expl: "It is no use + V-ing." },
      { q: "He quit _____ last year.", options: ["work", "working", "to work", "worked"], correct: 1, expl: "Quit + V-ing." },
      { q: "I am interested in _____ English.", options: ["learn", "learning", "to learn", "learned"], correct: 1, expl: "Preposition (in) + V-ing." },
      { q: "Thank you for _____ me.", options: ["help", "helping", "to help", "helped"], correct: 1, expl: "Preposition (for) + V-ing." },
      { q: "She suggested _____ to the beach.", options: ["go", "going", "to go", "went"], correct: 1, expl: "Suggest + V-ing." },
      { q: "I remember _____ the door. I have the key.", options: ["lock", "to lock", "locking", "locked"], correct: 2, expl: "Remember doing (memory of past action)." },
      { q: "Please remember _____ the door when you leave.", options: ["lock", "to lock", "locking", "locked"], correct: 1, expl: "Remember to do (future task)." },
      { q: "Let's go _____.", options: ["shop", "shopping", "to shop", "shopped"], correct: 1, expl: "Go + V-ing (Activity)." },
      { q: "The movie is worth _____.", options: ["watch", "watching", "to watch", "watched"], correct: 1, expl: "Worth + V-ing." },
      { q: "He finished _____ his homework.", options: ["do", "to do", "doing", "done"], correct: 2, expl: "Finish + V-ing." },
      { q: "I practice _____ the piano every day.", options: ["play", "playing", "to play", "played"], correct: 1, expl: "Practice + V-ing." },
      { q: "Don't give up _____.", options: ["try", "trying", "to try", "tried"], correct: 1, expl: "Give up (preposition 'up') + V-ing." }
    ];

    let currentQ = 0;
    let score = 0;

    function startQuiz() {
      currentQ = 0;
      score = 0;
      document.getElementById('quiz-container').style.display = 'block';
      document.getElementById('result-area').style.display = 'none';
      renderQuestion();
    }

    function renderQuestion() {
      if(currentQ >= quizQuestions.length) {
        showResult();
        return;
      }
      const q = quizQuestions[currentQ];
      const container = document.getElementById('quiz-container');
      
      let html = `
        <div class="quiz-progress">Question ${currentQ + 1} / ${quizQuestions.length}</div>
        <div class="quiz-question-box">
          <div class="quiz-q-text">${q.q.replace('_____', '<span style="border-bottom:2px solid var(--secondary-tone); color:var(--secondary-tone);">?</span>')}</div>
          <div style="display:grid; gap:10px;">
            ${q.options.map((opt, idx) => `
              <button class="quiz-opt" onclick="checkAns(this, ${idx})">${opt}</button>
            `).join('')}
          </div>
          <div class="explanation" id="expl-${currentQ}">${q.expl}</div>
          <div style="text-align:right; margin-top:15px; display:none;" id="nav-${currentQ}">
            <button class="btn-cta" onclick="nextQ()">Next â†’</button>
          </div>
        </div>
      `;
      container.innerHTML = html;
    }

    function checkAns(btn, idx) {
      const q = quizQuestions[currentQ];
      const parent = btn.parentElement;
      const allBtns = parent.querySelectorAll('.quiz-opt');
      allBtns.forEach(b => b.disabled = true);
      
      if(idx === q.correct) {
        btn.classList.add('correct');
        score++;
      } else {
        btn.classList.add('incorrect');
        allBtns[q.correct].classList.add('correct');
      }
      document.getElementById(`expl-${currentQ}`).classList.add('show');
      document.getElementById(`nav-${currentQ}`).style.display = 'block';
    }

    function nextQ() {
      currentQ++;
      renderQuestion();
    }

    function showResult() {
      document.getElementById('quiz-container').style.display = 'none';
      document.getElementById('result-area').style.display = 'block';
      document.getElementById('score-display').innerText = `${score} / 20`;
      
      let msg = score >= 18 ? "Gerund Master! ğŸ†" : (score >= 12 ? "Good Job! Keep practicing! ğŸ’ª" : "Review the rules and try again! ğŸ“š");
      document.getElementById('result-msg').innerText = msg;
    }
  </script>
</body>
</html>
