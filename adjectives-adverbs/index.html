<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Shirley's Grammar | Adjectives & Adverbs</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,500;0,700;1,500&family=Inter:wght@400;500;600&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      /* --- æ ¸å¿ƒé…è‰² --- */
      --primary-tone: #3a5a40; /* æ£®æ—æ·±ç¶  */
      --secondary-tone: #c9a972; /* å¾©å¤é‡‘ */
      --text-main: #333333;
      --bg-cream: #faf8f2;
      --highlight-bg: #f0eadd;
      
      /* --- å°ºå¯¸è®Šæ•¸ --- */
      --node-size: 120px; 
      --center-size: 200px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      background-color: var(--bg-cream);
      color: var(--text-main);
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      position: relative;
    }

    /* === 1. èƒŒæ™¯æ¼‚æµ®ä¿®é£¾èª (Floating Words) === */
    .floating-objects {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    .float-item {
      position: absolute;
      opacity: 0.1;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      color: var(--primary-tone);
      animation: floatUp 25s infinite linear;
      white-space: nowrap;
    }
    @keyframes floatUp {
      0% { transform: translateY(110vh) rotate(0deg); }
      100% { transform: translateY(-20vh) rotate(360deg); }
    }

    /* === 2. Mind Map èˆå° === */
    .mindmap-stage {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .connections {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      z-index: 1;
    }
    .connection-line {
      stroke: var(--secondary-tone);
      stroke-width: 2;
      stroke-dasharray: 6, 6;
      opacity: 0.4;
    }

    /* æ ¸å¿ƒ Core */
    .core-node {
      width: var(--center-size);
      height: var(--center-size);
      background: var(--primary-tone);
      color: white;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      z-index: 5;
      box-shadow: 0 0 0 12px rgba(58, 90, 64, 0.08), 0 25px 50px rgba(0,0,0,0.25);
      animation: corePulse 5s infinite ease-in-out;
      cursor: default;
    }
    .core-title { font-family: 'Playfair Display', serif; font-size: 1.8rem; font-weight: 700; line-height: 1.1; }
    .core-sub { font-size: 0.75rem; letter-spacing: 2px; text-transform: uppercase; margin-top: 10px; color: var(--secondary-tone); }

    @keyframes corePulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    /* å­ç¯€é» Satellite */
    .satellite {
      position: absolute;
      width: var(--node-size);
      height: var(--node-size);
      border-radius: 50%;
      background: white;
      border: 2px solid var(--primary-tone);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      cursor: pointer;
      z-index: 5;
      box-shadow: 0 10px 25px rgba(58, 90, 64, 0.1);
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      font-family: 'Playfair Display', serif;
      font-weight: 600;
      font-size: 0.85rem;
      color: var(--primary-tone);
      padding: 5px;
    }
    
    .satellite:hover {
      transform: scale(1.15);
      background: var(--primary-tone);
      color: white;
      border-color: var(--secondary-tone);
      box-shadow: 0 15px 35px rgba(58, 90, 64, 0.3);
      z-index: 10;
    }

    /* é †åºç·¨è™Ÿ Badge */
    .step-badge {
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--secondary-tone);
      color: white;
      font-family: 'Inter', sans-serif;
      font-size: 0.8rem;
      font-weight: 700;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .satellite.quiz-node {
      border-color: var(--secondary-tone);
      background: #fffcf5;
    }
    .satellite.quiz-node .step-badge { background: #d32f2f; }

    /* === 3. Modal å…§å®¹å€ === */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(250, 248, 242, 0.95);
      backdrop-filter: blur(5px);
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .modal-overlay.active { opacity: 1; pointer-events: auto; }

    .modal-content {
      width: 90%;
      max-width: 900px;
      max-height: 85vh;
      background: white;
      border-radius: 16px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.2);
      border-top: 6px solid var(--primary-tone);
      overflow-y: auto;
      padding: 40px;
      display: none;
      animation: slideUp 0.4s ease-out;
    }
    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .close-btn {
      position: absolute;
      top: 20px; right: 20px;
      width: 40px; height: 40px;
      border-radius: 50%;
      border: none;
      background: #f4f4f4;
      font-size: 1.5rem;
      color: var(--text-main);
      cursor: pointer;
      transition: all 0.2s;
    }
    .close-btn:hover { background: var(--secondary-tone); color: white; }

    /* --- å…§éƒ¨å…§å®¹æ¨£å¼ (ç§»æ¤è‡ªåŸæª”ä¸¦å„ªåŒ–) --- */
    h2 { font-family: 'Playfair Display', serif; font-size: 2rem; color: var(--primary-tone); margin-bottom: 20px; border-bottom: 2px solid var(--secondary-tone); padding-bottom: 10px; }
    h3 { font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--primary-tone); margin: 30px 0 15px; border-left: 4px solid var(--secondary-tone); padding-left: 12px; }
    
    .bilingual-box { display: flex; gap: 20px; background: #fbfbf9; padding: 25px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 20px; position: relative; }
    .bi-col { flex: 1; }
    .bi-label { display: block; font-size: 0.75rem; color: var(--secondary-tone); font-weight: 700; text-transform: uppercase; margin-bottom: 5px; }
    .highlight { background: var(--highlight-bg); padding: 2px 6px; border-radius: 4px; color: var(--primary-tone); font-weight: 600; }
    .bi-play-btn { background: var(--secondary-tone); color: white; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; margin-right: 10px; flex-shrink: 0; }
    .bi-play-btn:hover { background: var(--primary-tone); transform: scale(1.1); }

    /* Table */
    .table-responsive { overflow-x: auto; margin: 20px 0; border: 1px solid #e8e4d9; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; min-width: 500px; }
    th { background: #f4f1ea; color: var(--primary-tone); padding: 15px; text-align: left; font-family: 'Playfair Display', serif; border-bottom: 2px solid #e8e4d9; }
    td { padding: 14px; border-bottom: 1px solid #eee; }
    
    /* Compound Tags */
    .compound-grid { display: flex; flex-wrap: wrap; gap: 10px; margin: 15px 0; }
    .compound-tag { background: white; border: 1px solid var(--secondary-tone); color: var(--primary-tone); padding: 6px 14px; border-radius: 50px; font-weight: 600; font-size: 0.9rem; }

    /* Audio List */
    .audio-list { display: grid; gap: 12px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
    .audio-card { background: #fff; border: 1px solid #e8e4d9; padding: 12px 18px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; transition: all 0.2s; }
    .audio-card:hover { border-color: var(--secondary-tone); background: #fefcf8; transform: translateY(-2px); }
    .audio-text { font-size: 0.95rem; font-weight: 500; }

    /* Note Box */
    .note-box { padding: 20px; margin: 20px 0; border-radius: 0 8px 8px 0; font-size: 0.95rem; line-height: 1.6; }
    .note-tip { background: #f1f8f1; border-left: 4px solid #3a5a40; color: #2d4632; }

    /* Quiz Styling */
    .quiz-progress { text-align: right; color: var(--secondary-tone); font-weight: 700; margin-bottom: 15px; }
    .quiz-question-box { background: #fff; padding: 25px; border-radius: 12px; border: 1px solid #eee; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
    .quiz-q-text { font-size: 1.2rem; font-weight: 600; color: var(--primary-tone); margin-bottom: 20px; font-family: 'Playfair Display', serif; }
    .quiz-options-grid { display: grid; gap: 10px; }
    .quiz-opt { padding: 14px 20px; border: 2px solid #f0f0f0; border-radius: 8px; background: white; text-align: left; cursor: pointer; transition: all 0.2s; font-size: 1rem; position: relative; }
    .quiz-opt:hover { border-color: var(--secondary-tone); background: #fffbf5; }
    .quiz-opt.correct { background: #e8f5e9; border-color: #4caf50; color: #2e7d32; }
    .quiz-opt.incorrect { background: #ffebee; border-color: #ef5350; color: #c62828; opacity: 0.7; }
    .quiz-opt:disabled { cursor: default; }

    .explanation { margin-top: 20px; padding: 15px; background: #faf8f2; border-left: 4px solid var(--secondary-tone); display: none; border-radius: 4px; }
    .explanation.show { display: block; animation: slideIn 0.3s ease; }
    @keyframes slideIn { from {opacity:0; transform:translateY(-5px);} to {opacity:1; transform:translateY(0);} }

    .quiz-nav { margin-top: 20px; text-align: right; display: none; }
    .quiz-nav.show { display: block; }
    
    .btn-cta { background: var(--secondary-tone); color: white; padding: 10px 24px; border-radius: 50px; border: none; font-size: 1rem; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; transition: 0.3s; font-weight: 600; }
    .btn-cta:hover { background: var(--primary-tone); transform: translateY(-2px); }

    .result-card { text-align: center; padding: 40px 20px; display: none; }
    .result-score { font-size: 3.5rem; font-family: 'Playfair Display', serif; color: var(--primary-tone); font-weight: 700; margin-bottom: 10px; }

    /* RWD */
    @media (max-width: 768px) {
      body { overflow-y: auto; height: auto; }
      .floating-objects { height: 100vh; position: fixed; }
      .mindmap-stage { flex-direction: column; height: auto; padding: 50px 20px; }
      .connections { display: none; }
      .core-node { margin-bottom: 40px; width: 160px; height: 160px; }
      .satellite { 
        position: relative; top: auto !important; left: auto !important; transform: none !important;
        width: 100%; height: auto; min-height: 70px; border-radius: 12px; padding: 15px 20px;
        margin-bottom: 12px; flex-direction: row; justify-content: flex-start; text-align: left; gap: 20px;
      }
      .satellite:hover { transform: translateY(-3px) !important; }
      .step-badge { position: static; transform: none; margin-right: 0; min-width: 24px; }
      .modal-content { padding: 25px; width: 95%; max-height: 90vh; }
      .bilingual-box { flex-direction: column; }
    }
  </style>
</head>
<body>

  <div class="floating-objects" id="floatingBg"></div>

  <div class="mindmap-stage" id="stage">
    <svg class="connections" id="svgLines"></svg>

    <div class="core-node">
      <div class="core-title">Adjectives<br>& Adverbs</div>
      <div class="core-sub">Shirley's Masterclass</div>
    </div>

    <div class="satellite" data-target="def-modal">
      <div class="step-badge">1</div>
      <div>Definition<br>å®šç¾©èˆ‡å€åˆ¥</div>
    </div>
    <div class="satellite" data-target="adj-usage-modal">
      <div class="step-badge">2</div>
      <div>Adjectives<br>å½¢å®¹è©ç”¨æ³•</div>
    </div>
    <div class="satellite" data-target="adv-usage-modal">
      <div class="step-badge">3</div>
      <div>Adverbs<br>å‰¯è©è®ŠåŒ–</div>
    </div>
    <div class="satellite" data-target="comp-modal">
      <div class="step-badge">4</div>
      <div>Comparisons<br>æ¯”è¼ƒç´š</div>
    </div>
    <div class="satellite" data-target="confuse-modal">
      <div class="step-badge">5</div>
      <div>Confusions<br>æ˜“æ··æ·†å­—</div>
    </div>
    <div class="satellite" data-target="clause-modal">
      <div class="step-badge">6</div>
      <div>Clauses<br>é€²éšå­å¥</div>
    </div>
    <div class="satellite" data-target="mistake-modal">
      <div class="step-badge">7</div>
      <div>Mistakes<br>å¸¸è¦‹éŒ¯èª¤</div>
    </div>
    <div class="satellite quiz-node" data-target="quiz-modal">
      <div class="step-badge">8</div>
      <div>Quiz<br>20é¡ŒæŒ‘æˆ°</div>
    </div>
  </div>

  <div class="modal-overlay" id="modalOverlay">
    <button class="close-btn" onclick="closeModal()">âœ•</button>

    <div id="def-modal" class="modal-content">
      <h2>1. Definition å®šç¾©</h2>
      <div class="bilingual-box">
        <button class="bi-play-btn" onclick="speak('Adjectives describe nouns. Adverbs modify verbs, adjectives, or other adverbs.')">ğŸ”Š</button>
        <div style="flex:1;">
          <div class="bi-col" style="margin-bottom:15px;">
            <span class="bi-label">Adjectives (å½¢å®¹è©)</span>
            Describe <strong>nouns</strong> (åè©).<br>
            <em style="color:#666">e.g., a <strong>smart</strong> student.</em>
          </div>
          <div class="bi-col">
            <span class="bi-label">Adverbs (å‰¯è©)</span>
            Modify <strong>verbs, adjectives, or adverbs</strong>.<br>
            <em style="color:#666">e.g., run <strong>fast</strong>, <strong>very</strong> good.</em>
          </div>
        </div>
      </div>
    </div>

    <div id="adj-usage-modal" class="modal-content">
      <h2>2. Adjectives Usage å½¢å®¹è©ç”¨æ³•</h2>
      <h3>Position ä½ç½®</h3>
      <div class="audio-list">
        <div class="audio-card" onclick="speak('My father is a successful businessman.')">
          <span class="audio-text"><strong>Attributive (å‰ä½)</strong>: a <span class="highlight">successful</span> businessman</span>
          <span>ğŸ”Š</span>
        </div>
        <div class="audio-card" onclick="speak('The meeting is successful.')">
          <span class="audio-text"><strong>Predicative (å¾Œä½)</strong>: The meeting is <span class="highlight">successful</span></span>
          <span>ğŸ”Š</span>
        </div>
      </div>
      <div class="note-box note-tip">
        <strong>ğŸ’¡ A-é–‹é ­å½¢å®¹è©:</strong> åªèƒ½æ”¾ be å‹•è©å¾Œé¢ (asleep, awake, alone, afraid)ã€‚
      </div>

      <h3>Compound Adjectives è¤‡åˆå½¢å®¹è©</h3>
      <div class="compound-grid">
        <span class="compound-tag">well-known</span>
        <span class="compound-tag">three-year-old</span>
        <span class="compound-tag">all-night</span>
        <span class="compound-tag">good-looking</span>
      </div>

      <h3>The + Adjective</h3>
      <div class="audio-list">
        <div class="audio-card" onclick="speak('The rich are not always happy.')">
          <span class="audio-text"><strong>The rich</strong> = Rich people (è¤‡æ•¸)</span>
          <span>ğŸ”Š</span>
        </div>
      </div>
    </div>

    <div id="adv-usage-modal" class="modal-content">
      <h2>3. Adverbs å‰¯è©å½¢æˆ</h2>
      <p>å¤§å¤šæ•¸å‰¯è©ç”± Adj + ly æ§‹æˆï¼Œä½†è¦æ³¨æ„ä¾‹å¤–ã€‚</p>
      <div class="table-responsive">
        <table>
          <tr><th>Rule</th><th>Examples</th></tr>
          <tr><td>Adj + ly</td><td>quick â†’ <strong>quickly</strong></td></tr>
          <tr><td>y â†’ ily</td><td>happy â†’ <strong>happily</strong></td></tr>
          <tr><td>Irregular (åŒå½¢)</td><td>fast â†’ <strong>fast</strong>, hard â†’ <strong>hard</strong></td></tr>
          <tr><td>Irregular (è®Šå½¢)</td><td>good â†’ <strong>well</strong></td></tr>
        </table>
      </div>
    </div>

    <div id="comp-modal" class="modal-content">
      <h2>4. Comparatives & Superlatives</h2>
      <div class="table-responsive">
        <table>
          <tr><th>Original</th><th>Comparative</th><th>Superlative</th></tr>
          <tr><td>tall</td><td>taller</td><td>the tallest</td></tr>
          <tr><td>beautiful</td><td>more beautiful</td><td>the most beautiful</td></tr>
          <tr><td>good</td><td>better</td><td>the best</td></tr>
          <tr><td>bad</td><td>worse</td><td>the worst</td></tr>
        </table>
      </div>
      <h3>So vs. Such</h3>
      <div class="audio-list">
        <div class="audio-card" onclick="speak('She is so beautiful.')">
          <span class="audio-text"><strong>so</strong> + Adj (so beautiful)</span>
          <span>ğŸ”Š</span>
        </div>
        <div class="audio-card" onclick="speak('She is such a beautiful girl.')">
          <span class="audio-text"><strong>such</strong> + a + Adj + Noun</span>
          <span>ğŸ”Š</span>
        </div>
      </div>
    </div>

    <div id="confuse-modal" class="modal-content">
      <h2>5. Common Confusions æ˜“æ··æ·†è©</h2>
      <div class="audio-list">
        <div class="audio-card" onclick="speak('He works hard.')">
          <span class="audio-text"><strong>hard</strong> (åŠªåŠ›åœ°) - å‰¯è©</span>
          <span>ğŸ”Š</span>
        </div>
        <div class="audio-card" onclick="speak('He hardly works.')">
          <span class="audio-text"><strong>hardly</strong> (å¹¾ä¹ä¸) - é »ç‡å‰¯è©</span>
          <span>ğŸ”Š</span>
        </div>
        <div class="audio-card" onclick="speak('late vs lately')">
          <span class="audio-text"><strong>late</strong> (é²åˆ°) vs <strong>lately</strong> (æœ€è¿‘)</span>
          <span>ğŸ”Š</span>
        </div>
      </div>
    </div>

    <div id="clause-modal" class="modal-content">
      <h2>6. Advanced Clauses å­å¥</h2>
      <p>ç•¶å–®å­—ä¸è¶³ä»¥è¡¨é”æ™‚ï¼Œä½¿ç”¨å­å¥ä¾†ä¿®é£¾ã€‚</p>
      <div style="display:flex; gap:10px; margin-top:20px; flex-wrap:wrap;">
        <a href="https://ducj-creator.github.io/Shirley-Grammar/adjective-clause/" target="_blank" class="btn-cta">
          ğŸ“– Adjective Clause
        </a>
        <a href="https://ducj-creator.github.io/Shirley-Grammar/adverb-clause/" target="_blank" class="btn-cta">
          ğŸ“˜ Adverb Clause
        </a>
      </div>
    </div>

    <div id="mistake-modal" class="modal-content">
      <h2>7. Common Mistakes å¸¸è¦‹éŒ¯èª¤</h2>
      <div class="table-responsive">
        <table>
          <tr><th style="color:#c62828">Wrong (X)</th><th style="color:#2e7d32">Right (O)</th></tr>
          <tr><td>a well known singer</td><td>a <strong>well-known</strong> singer</td></tr>
          <tr><td>harder than me</td><td>harder than <strong>I (do)</strong> / <strong>mine</strong> (è¦–æ–‡æ„)</td></tr>
          <tr><td>She looks beautifully.</td><td>She looks <strong>beautiful</strong>. (é€£ç¶´å‹•è©ç”¨å½¢å®¹è©)</td></tr>
        </table>
      </div>
    </div>

    <div id="quiz-modal" class="modal-content">
      <h2>8. Challenge Quiz (20 Qs) ğŸ†</h2>
      <p style="margin-bottom:20px; color:#666;">Test your knowledge! Select the best answer.</p>
      
      <div id="quiz-container"></div>

      <div id="result-area" class="result-card">
        <div class="result-score" id="score-display">0 / 20</div>
        <h3 style="border:none;">Quiz Completed!</h3>
        <p id="result-msg" style="margin-bottom:20px;"></p>
        <button onclick="startQuiz()" class="btn-cta">
          â†º Restart Quiz
        </button>
      </div>
    </div>

  </div>

  <script>
    // === 1. Floating Background ===
    const floatWords = ['Fast', 'Slowly', 'Good', 'Well', 'Hard', 'Hardly', 'Happy', 'Beautiful', 'So', 'Such', 'More', 'Most'];
    const floatContainer = document.getElementById('floatingBg');

    function createFloatingIcons() {
      for(let i=0; i<15; i++) {
        const el = document.createElement('div');
        el.classList.add('float-item');
        el.innerText = floatWords[Math.floor(Math.random() * floatWords.length)];
        el.style.left = Math.random() * 100 + 'vw';
        el.style.animationDuration = (20 + Math.random() * 15) + 's';
        el.style.animationDelay = (Math.random() * 5) + 's';
        el.style.fontSize = (1.2 + Math.random() * 2) + 'rem';
        floatContainer.appendChild(el);
      }
    }
    createFloatingIcons();

    // === 2. Mind Map Layout ===
    function updateLayout() {
      const satellites = document.querySelectorAll('.satellite');
      const stage = document.getElementById('stage');
      const svg = document.getElementById('svgLines');
      const isMobile = window.innerWidth <= 768;

      while(svg.firstChild) svg.removeChild(svg.firstChild);

      if(isMobile) return; 

      const centerX = stage.offsetWidth / 2;
      const centerY = stage.offsetHeight / 2;
      const radius = 280;
      const total = satellites.length;

      satellites.forEach((node, index) => {
        const angle = (index / total) * 2 * Math.PI - (Math.PI / 2); // Start from top
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);

        node.style.left = x + 'px';
        node.style.top = y + 'px';
        node.style.transform = 'translate(-50%, -50%)';

        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
        line.setAttribute('x1', centerX);
        line.setAttribute('y1', centerY);
        line.setAttribute('x2', x);
        line.setAttribute('y2', y);
        line.classList.add('connection-line');
        svg.appendChild(line);
      });
    }
    window.addEventListener('resize', updateLayout);
    window.addEventListener('load', updateLayout);

    // === 3. Modal Logic ===
    const overlay = document.getElementById('modalOverlay');
    document.querySelectorAll('.satellite').forEach(btn => {
      btn.addEventListener('click', () => {
        const targetId = btn.getAttribute('data-target');
        document.querySelectorAll('.modal-content').forEach(c => c.style.display = 'none');
        document.getElementById(targetId).style.display = 'block';
        overlay.classList.add('active');
        if(targetId === 'quiz-modal') startQuiz(); // Start quiz when opened
      });
    });
    function closeModal() { overlay.classList.remove('active'); }
    overlay.addEventListener('click', (e) => { if(e.target === overlay) closeModal(); });

    // === 4. TTS ===
    function speak(text) {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'en-US';
        speechSynthesis.speak(utterance);
      }
    }

    // === 5. Quiz Logic (20 Questions with Explanation) ===
    const quizQuestions = [
        { q: "1. The soup smells _____.", options: ["deliciously", "delicious", "well", "badly"], correct: 1, explanation: "'Smell' is a linking verb here, so it needs an Adjective (delicious)." },
        { q: "2. He drives very _____.", options: ["careful", "carefully", "slow", "good"], correct: 1, explanation: "Modify verb 'drives' -> need Adverb (carefully)." },
        { q: "3. This is a _____ walk.", options: ["ten-minutes", "ten minute", "ten-minute", "ten minutes"], correct: 2, explanation: "Compound adjective before noun: singular & hyphenated (ten-minute)." },
        { q: "4. The rich _____ not always happy.", options: ["is", "are", "be", "does"], correct: 1, explanation: "'The rich' = Rich people (Plural) -> use 'are'." },
        { q: "5. She is _____ a nice person.", options: ["so", "such", "very", "too"], correct: 1, explanation: "such + a + Adj + Noun." },
        { q: "6. He studies _____ for the exam.", options: ["hardly", "hard", "hards", "harderly"], correct: 1, explanation: "hard (åŠªåŠ›åœ°). hardly (å¹¾ä¹ä¸)." },
        { q: "7. I haven't seen him _____.", options: ["late", "lately", "latest", "later"], correct: 1, explanation: "lately = recently (æœ€è¿‘)." },
        { q: "8. This movie is _____ than that one.", options: ["exciting", "more exciting", "most exciting", "excited"], correct: 1, explanation: "Comparative for long adjectives: more + adj." },
        { q: "9. Of all students, Tom works _____.", options: ["the hardest", "harder", "most hard", "hardly"], correct: 0, explanation: "Comparing with 'all' -> Superlative (the hardest)." },
        { q: "10. She plays the piano very _____.", options: ["good", "goodly", "well", "nice"], correct: 2, explanation: "Modify verb 'plays' -> Adverb (well)." },
        { q: "11. The baby is _____.", options: ["sleeping", "asleep", "sleep", "asleeping"], correct: 1, explanation: "asleep is an adjective used after be-verb." },
        { q: "12. Please be _____.", options: ["quietly", "quiet", "quietness", "quieter"], correct: 1, explanation: "Be + Adjective (quiet)." },
        { q: "13. Her car is faster than _____.", options: ["me", "mine", "I", "my"], correct: 1, explanation: "Compare car with car -> mine (my car)." },
        { q: "14. It is _____ hot to go outside.", options: ["so", "such", "too", "very"], correct: 2, explanation: "Too... to... (å¤ª...ä»¥è‡³æ–¼ä¸èƒ½...)." },
        { q: "15. The test was _____ easy.", options: ["surprising", "surprisingly", "surprise", "surprised"], correct: 1, explanation: "Adverb (Surprisingly) modifies Adjective (easy)." },
        { q: "16. He _____ knows anyone here.", options: ["hard", "hardly", "harder", "hards"], correct: 1, explanation: "Hardly (å¹¾ä¹ä¸)." },
        { q: "17. That sounds _____.", options: ["great", "greatly", "well", "greatness"], correct: 0, explanation: "Sound (é€£ç¶´å‹•è©) + Adjective (great)." },
        { q: "18. She is the _____ singer.", options: ["good", "better", "best", "goodest"], correct: 2, explanation: "The + Superlative (best)." },
        { q: "19. The traffic is _____ than yesterday.", options: ["bad", "badder", "worse", "worst"], correct: 2, explanation: "Comparative of bad -> worse." },
        { q: "20. He looked at me _____.", options: ["angry", "angrily", "anger", "angrier"], correct: 1, explanation: "Look (action verb: glanced) + Adverb (angrily)." }
    ];

    let currentQ = 0;
    let score = 0;

    function startQuiz() {
      currentQ = 0;
      score = 0;
      document.getElementById('quiz-container').style.display = 'block';
      document.getElementById('result-area').style.display = 'none';
      renderQuestion();
    }

    function renderQuestion() {
      if(currentQ >= quizQuestions.length) {
        showResult();
        return;
      }
      const q = quizQuestions[currentQ];
      const container = document.getElementById('quiz-container');
      
      let html = `
        <div class="quiz-progress">Question ${currentQ + 1} / ${quizQuestions.length}</div>
        <div class="quiz-question-box">
          <div class="quiz-q-text">${q.q.replace('_____', '<span style="border-bottom:2px solid var(--secondary-tone); color:var(--secondary-tone);">?</span>')}</div>
          <div class="quiz-options-grid">
            ${q.options.map((opt, idx) => `
              <button class="quiz-opt" onclick="checkAns(this, ${idx})">${opt}</button>
            `).join('')}
          </div>
          <div class="explanation" id="expl-${currentQ}">${q.explanation}</div>
          <div class="quiz-nav" id="nav-${currentQ}">
            <button class="btn-cta" onclick="nextQ()">Next â†’</button>
          </div>
        </div>
      `;
      container.innerHTML = html;
    }

    function checkAns(btn, idx) {
      const q = quizQuestions[currentQ];
      const parent = btn.parentElement;
      const allBtns = parent.querySelectorAll('.quiz-opt');
      
      // Disable all
      allBtns.forEach(b => b.disabled = true);
      
      if(idx === q.correct) {
        btn.classList.add('correct');
        score++;
      } else {
        btn.classList.add('incorrect');
        allBtns[q.correct].classList.add('correct');
      }
      
      document.getElementById(`expl-${currentQ}`).classList.add('show');
      document.getElementById(`nav-${currentQ}`).classList.add('show');
    }

    function nextQ() {
      currentQ++;
      renderQuestion();
    }

    function showResult() {
      document.getElementById('quiz-container').style.display = 'none';
      document.getElementById('result-area').style.display = 'block';
      document.getElementById('score-display').innerText = `${score} / 20`;
      
      let msg = "";
      if(score === 20) msg = "Perfect! You are a Grammar Master! ğŸ†";
      else if(score >= 16) msg = "Excellent job! Keep it up! ğŸŒŸ";
      else if(score >= 12) msg = "Good effort! Review the notes again. ğŸ’ª";
      else msg = "Keep practicing! You can do it! ğŸ“š";
      
      document.getElementById('result-msg').innerText = msg;
    }
  </script>
</body>
</html>
