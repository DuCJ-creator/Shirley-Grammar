<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Level 4: Compound-Complex Sentences</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');

        :root {
            /* È´òÈõÖËé´Ëò≠Ëø™‰∏ªËâ≤Ë™ø */
            --bg-main: #faf8f5;
            --bg-card: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --accent-blue: #6b7280;     /* ÂÜ∑ÁÅ∞ËóçÔºàICÔºâ */
            --accent-purple: #9f7aea;   /* ÊüîÁ¥´ÔºàDCÔºâ */
            --accent-amber: #dd9a43;    /* ÊöñÈáëÔºàConnectorÔºâ */
            --border: #e2e8f0;
            --shadow-sm: 0 4px 15px rgba(0,0,0,0.06);
            --shadow-lg: 0 20px 40px rgba(0,0,0,0.1);
        }

        * { 
            margin:0; 
            padding:0; 
            box-sizing:border-box; 
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--text-primary);
            height: 100dvh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            touch-action: manipulation;
        }

        #stage {
            width: 100vw;
            height: 100dvh;
            max-width: 1920px;
            max-height: 1080px;
            background: var(--bg-card);
            border-radius: 0;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* ÈüøÊáâÂºèÂ≠óÁ¥öËàáÈñìË∑ù - ÂÑ™ÂåñÊ®ôÈ°åÂ≠óÈ´î */
        .header h1 { 
            font-size: clamp(2rem, 8vw, 5rem); 
            font-weight: 700; 
            margin: 8px 0;
            line-height: 1.1;
            letter-spacing: -0.02em;
        }
        .header .level-tag { 
            font-size: clamp(0.8rem, 3vw, 1.4rem); 
            padding: clamp(6px, 1.5vw, 12px) clamp(16px, 4vw, 24px); 
            border-radius: 50px; 
            margin-bottom: clamp(8px, 2vw, 16px);
        }
        .subtitle { 
            font-size: clamp(1rem, 4vw, 2.2rem); 
            margin-top: clamp(4px, 1vw, 12px);
            font-weight: 500;
            color: var(--text-secondary);
        }
        .sub-text { font-size: clamp(1.1rem, 3.5vw, 1.6rem); }
        .sub-tc { font-size: clamp(0.9rem, 3vw, 1.3rem); margin-top: 6px; }
        .word-block { font-size: clamp(1.3rem, 4.5vw, 2.2rem); padding: clamp(12px, 3vw, 20px) clamp(16px, 4vw, 28px); border-radius: 16px; }
        .formula-block { font-size: clamp(1.2rem, 4vw, 1.8rem); padding: clamp(12px, 3vw, 20px) clamp(20px, 5vw, 32px); border-radius: 16px; }

        /* ÂÖßÂÆπÂçÄ */
        #content {
            flex: 1;
            padding: clamp(16px, 4vw, 40px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        .header {
            text-align: center;
            position: absolute;
            top: clamp(20px, 8vh, 80px);
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: all 0.9s ease;
            width: 90%;
            max-width: 800px;
        }
        .level-tag {
            background: var(--accent-purple);
            color: white;
            display: inline-block;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(159,122,234,0.3);
            font-weight: 600;
        }
        h1 {
            background: linear-gradient(to right, #4a5568, #2d3748);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.1;
        }

        .formula-container {
            display: flex;
            gap: clamp(8px, 2vw, 20px);
            flex-wrap: wrap;
            justify-content: center;
            margin: clamp(20px, 5vw, 40px) 0;
            opacity: 0;
        }
        .f-ic { border: 3px solid var(--accent-blue); color: var(--accent-blue); }
        .f-dc { border: 3px solid var(--accent-purple); color: var(--accent-purple); }
        .f-plus { 
            border:none; 
            font-size: clamp(1.8rem, 5vw, 3rem); 
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sentence-container {
            display: flex;
            flex-wrap: wrap;
            gap: clamp(8px, 2vw, 16px);
            justify-content: center;
            max-width: 95%;
            margin: clamp(20px, 4vw, 30px) 0;
        }
        .word-block {
            background: white;
            box-shadow: var(--shadow-sm);
            border-left: 6px solid #cbd5e1;
            transition: all 0.6s ease;
            opacity: 0;
            transform: translateY(30px);
            font-weight: 500;
        }
        .word-block.visible { opacity:1; transform:translateY(0); }
        .type-ic { border-left-color: var(--accent-blue); }
        .type-dc { border-left-color: var(--accent-purple); }
        .type-conn {
            background: var(--accent-amber) !important;
            color: white !important;
            border: none;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(221,154,67,0.4);
        }

        .difficulty-badge {
            position: absolute;
            top: clamp(20px, 8vh, 80px);
            right: clamp(16px, 4vw, 40px);
            font-size: clamp(1.5rem, 6vw, 4rem);
            font-weight: 900;
            color: #e2e8f0;
            opacity: 0;
            transform: scale(0);
            transition: all 0.7s;
        }
        .diff-active {
            opacity: 1;
            transform: scale(1);
            color: var(--accent-amber);
            text-shadow: 0 0 20px rgba(221,154,67,0.5);
        }

        /* Â∫ïÈÉ®Â≠óÂπïËàáÊéßÂà∂ */
        .footer {
            padding: clamp(12px, 3vw, 24px);
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(12px);
            border-top: 1px solid var(--border);
            text-align: center;
        }
        .progress-track {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin: clamp(12px, 3vw, 16px) 0;
        }
        .progress-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, var(--accent-blue), var(--accent-purple));
            transition: width 0.2s ease;
        }

        /* ÊéßÂà∂ÊåâÈàï */
        .control-buttons {
            position: absolute;
            top: clamp(12px, 3vw, 20px);
            right: clamp(12px, 3vw, 20px);
            display: flex;
            gap: clamp(8px, 2vw, 12px);
            z-index: 200;
        }

        .control-btn {
            font-size: clamp(1.1rem, 3vw, 1.5rem);
            cursor: pointer;
            background: white;
            width: clamp(36px, 10vw, 48px);
            height: clamp(36px, 10vw, 48px);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            user-select: none;
        }
        .control-btn:hover, .control-btn:active { 
            transform: scale(1.1); 
        }

        /* Â§ßÊåâÈàïÔºàÊâãÊ©üË∂ÖÂ•ΩÊåâÔºâ */
        #big-pause-btn {
            position: fixed;
            right: clamp(12px, 4vw, 24px);
            bottom: clamp(16px, 6vh, 32px);
            width: clamp(48px, 12vw, 64px);
            height: clamp(48px, 12vw, 64px);
            background: rgba(45,55,72,0.95);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.25);
            z-index: 999;
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255,255,255,0.2);
        }
        #big-pause-btn:hover { transform: scale(1.1); }
        #big-pause-btn svg { width: 40%; height: 40%; }

        /* Êö´ÂÅúË¶ÜËìãÂ±§ */
        .pause-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 150;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            padding: 20px;
            text-align: center;
        }
        .pause-overlay.active { opacity: 1; pointer-events: all; }
        .pause-overlay h2 {
            font-family: 'Inter', sans-serif;
            font-size: 2.5rem;
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        /* ÊâãÊ©üÈÅ©ÈÖçÂÑ™Âåñ */
        @media (max-width: 480px) {
            .header {
                top: clamp(16px, 6vh, 60px);
            }
            .difficulty-badge {
                top: clamp(16px, 6vh, 60px);
                right: clamp(12px, 3vw, 20px);
            }
            .formula-container { 
                gap: clamp(6px, 1.5vw, 12px); 
                margin: clamp(16px, 4vw, 24px) 0;
            }
            .sentence-container {
                gap: clamp(6px, 1.5vw, 12px);
                margin: clamp(16px, 4vw, 24px) 0;
            }
            .pause-overlay h2 {
                font-size: 2rem;
            }
        }

        @media (max-width: 768px) {
            #stage { border-radius: 0; height: 100dvh; width: 100vw; }
        }

        /* Ê©´ÂêëÊ®°ÂºèÂÑ™Âåñ */
        @media (max-height: 500px) and (orientation: landscape) {
            .header {
                top: clamp(12px, 4vh, 20px);
            }
            .header h1 {
                font-size: clamp(1.5rem, 6vw, 3rem);
            }
            .subtitle {
                font-size: clamp(0.9rem, 3vw, 1.5rem);
            }
            .difficulty-badge {
                top: clamp(12px, 4vh, 20px);
                font-size: clamp(1.2rem, 5vw, 2.5rem);
            }
            #content {
                padding: clamp(12px, 3vw, 20px);
            }
        }
    </style>
</head>
<body>

<div id="stage">
    <!-- ÊéßÂà∂ÊåâÈàï -->
    <div class="control-buttons">
        <div class="control-btn pause-btn" id="pauseToggle">‚è∏Ô∏è</div>
        <div class="control-btn music-btn" id="musicToggle">üîá</div>
    </div>
    
    <!-- Êö´ÂÅúË¶ÜËìãÂ±§ -->
    <div class="pause-overlay" id="pauseOverlay">
        <h2>Paused</h2>
        <p style="font-size: 1.2rem; color: #666; margin-bottom: 30px;">ÈªûÊìäÁπºÁ∫åÊåâÈàïÊàñÊö´ÂÅúÈçµÊÅ¢Âæ©</p>
        <button class="control-btn" style="font-size: 1.5rem; width: 60px; height: 60px;" onclick="togglePause()">‚ñ∂Ô∏è</button>
    </div>

    <div class="difficulty-badge" id="diff-badge">LEVEL 4</div>

    <div id="content">
        <div class="header" id="header">
            <div class="level-tag">Advanced Grammar</div>
            <h1>Compound-Complex Sentences</h1>
            <div class="subtitle">Ë§áÂêàË§áÈõúÂè•</div>
        </div>

        <div class="formula-container" id="formula">
            <div class="formula-block f-ic">Indep. Clause</div>
            <div class="formula-block f-plus">+</div>
            <div class="formula-block f-ic">Indep. Clause</div>
            <div class="formula-block f-plus">+</div>
            <div class="formula-block f-dc">Dep. Clause</div>
        </div>

        <div class="sentence-container" id="sentence-area"></div>
    </div>

    <div class="footer">
        <div class="sub-text" id="sub-en"></div>
        <div class="sub-text sub-tc" id="sub-tc"></div>
        <div class="progress-track"><div class="progress-fill" id="progress"></div></div>
    </div>

    <!-- ÊòéÈ°ØÁöÑÈ´òÈõÖÊö´ÂÅúÊåâÈàï -->
    <div id="big-pause-btn" onclick="togglePause()">
        <svg id="big-pause-icon" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" fill="white"/></svg>
        <svg id="big-play-icon" viewBox="0 0 24 24" style="display:none"><path d="M8 5v14l11-7z" fill="white"/></svg>
    </div>
</div>

<script>
    /* --- Èü≥ÊïàÁ≥ªÁµ± --- */
    const AudioSys = {
        ctx: null,
        muted: false, // È†êË®≠ÁÇ∫‰∏çÈùúÈü≥
        
        init() {
            // Âª∂ÈÅ≤ÂàùÂßãÂåñÈü≥È†ª‰∏ä‰∏ãÊñáÔºåÈÅøÂÖçiOSÈôêÂà∂
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        },
        
        toggle() {
            if (!this.ctx) this.init();
            
            this.muted = !this.muted;
            if(!this.muted) {
                this.ctx.resume();
            } else {
                this.ctx.suspend();
            }
            return this.muted;
        },

        playSound(type) {
            if (this.muted || !this.ctx) return;
            
            const osc = this.ctx.createOscillator();
            const gainNode = this.ctx.createGain();
            
            osc.connect(gainNode);
            gainNode.connect(this.ctx.destination);
            
            const now = this.ctx.currentTime;

            if (type === 'pop') {
                // Ê∞îÊ≥°ÂºπÂá∫Â£∞
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'snap') {
                // ÊãºÊé•Â£∞
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gainNode.gain.setValueAtTime(0.5, now);
                gainNode.gain.linearRampToValueAtTime(0.01, now + 0.15);
                osc.start(now);
                osc.stop(now + 0.15);
            } else if (type === 'magic') {
                // È≠îÊ≥ïÈü≥Êïà
                osc.type = 'sine';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.linearRampToValueAtTime(1200, now + 0.5);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            }
        }
    };

    /* --- Êö´ÂÅúÁ≥ªÁµ± --- */
    let isPaused = false;
    let pauseTime = 0;
    let animationFrameId;
    let executedIndices = new Set();
    let startTime = performance.now();

    function togglePause() {
        if (isPaused) {
            // ÊÅ¢Âæ©Êí≠Êîæ
            isPaused = false;
            document.getElementById('pauseOverlay').classList.remove('active');
            document.getElementById('pauseToggle').innerHTML = '‚è∏Ô∏è';
            document.getElementById('big-pause-icon').style.display = 'block';
            document.getElementById('big-play-icon').style.display = 'none';
            
            // ÊÅ¢Âæ©Èü≥Êïà
            if (!AudioSys.muted && AudioSys.ctx) {
                AudioSys.ctx.resume();
            }
            
            // ÈáçÊñ∞ÈñãÂßãÂãïÁï´Âæ™Áí∞
            startTime = performance.now() - pauseTime;
            loop();
        } else {
            // Êö´ÂÅú
            isPaused = true;
            document.getElementById('pauseOverlay').classList.add('active');
            document.getElementById('pauseToggle').innerHTML = '‚ñ∂Ô∏è';
            document.getElementById('big-pause-icon').style.display = 'none';
            document.getElementById('big-play-icon').style.display = 'block';
            
            // Êö´ÂÅúÈü≥Êïà
            if (AudioSys.ctx) {
                AudioSys.ctx.suspend();
            }
            
            // ÂÅúÊ≠¢ÂãïÁï´Âæ™Áí∞
            cancelAnimationFrame(animationFrameId);
            pauseTime = performance.now() - startTime;
        }
    }

    /* --- ÂãïÁï´ÊéßÂà∂ÈÇèËºØ --- */
    const els = {
        header: document.getElementById('header'),
        formula: document.getElementById('formula'),
        sentenceArea: document.getElementById('sentence-area'),
        subEn: document.getElementById('sub-en'),
        subTc: document.getElementById('sub-tc'),
        diffBadge: document.getElementById('diff-badge'),
        progress: document.getElementById('progress'),
        musicBtn: document.getElementById('musicToggle'),
        pauseBtn: document.getElementById('pauseToggle'),
        pauseOverlay: document.getElementById('pauseOverlay'),
        formulaBlocks: document.querySelectorAll('.formula-block')
    };

    function setSub(en, tc) {
        els.subEn.style.opacity = els.subTc.style.opacity = 0;
        setTimeout(() => {
            els.subEn.textContent = en;
            els.subTc.textContent = tc;
            els.subEn.style.opacity = els.subTc.style.opacity = 1;
        }, 350);
    }

    function setDiff(l) { 
        els.diffBadge.textContent = l; 
        els.diffBadge.classList.add('diff-active'); 
        AudioSys.playSound('pop'); 
    }

    function clearStage() { 
        els.sentenceArea.innerHTML = ''; 
        els.diffBadge.className = 'difficulty-badge'; 
        els.header.style.opacity = 0.3; 
        els.formula.style.opacity = 0; 
    }

    function addBlock(text, label, type) {
        const b = document.createElement('div');
        b.className = `word-block ${type} visible`;
        b.textContent = text;
        b.dataset.type = label;
        els.sentenceArea.appendChild(b);
        setTimeout(() => {
            b.style.opacity = 1;
            b.style.transform = 'translateY(0)';
        }, 50);
        AudioSys.playSound(type === 'type-conn' ? 'snap' : 'pop');
    }

    /* --- ÂäáÊú¨ÂÆöÁæ© (Timeline) --- */
    const timeline = [
        { 
            t: 0, 
            action: () => { 
                AudioSys.playSound('pop'); 
                els.header.style.opacity = 1; 
                els.header.style.transform = 'translateX(-50%) translateY(0)'; 
                setSub("Compound-Complex Sentences are the most sophisticated sentence type.", "Ë§áÂêàË§áÈõúÂè•ÊòØÊúÄË§áÈõúÁöÑÂè•Âûã„ÄÇ"); 
            }
        },
        { 
            t: 4000, 
            action: () => { 
                setSub("They combine at least two Independent Clauses and one Dependent Clause.", "ÂÆÉÂÄëÁµêÂêà‰∫ÜËá≥Â∞ëÂÖ©ÂÄãÁç®Á´ãÂ≠êÂè•Âíå‰∏ÄÂÄãÂæûÂ±¨Â≠êÂè•„ÄÇ"); 
                els.formula.style.opacity = 1; 
            }
        },
        { 
            t: 6000, 
            action: () => { 
                AudioSys.playSound('pop'); 
                els.formulaBlocks[0].style.opacity = 1; 
                els.formulaBlocks[0].style.transform = 'scale(1)'; 
            }
        },
        { 
            t: 6500, 
            action: () => { 
                AudioSys.playSound('pop'); 
                els.formulaBlocks[2].style.opacity = 1; 
                els.formulaBlocks[2].style.transform = 'scale(1)'; 
            }
        },
        { 
            t: 7000, 
            action: () => { 
                AudioSys.playSound('snap'); 
                els.formulaBlocks[1].style.opacity = 1; 
                els.formulaBlocks[3].style.opacity = 1; 
                els.formulaBlocks[4].style.opacity = 1; 
                els.formulaBlocks[4].style.transform = 'scale(1)'; 
            }
        },
        { 
            t: 9000, 
            action: () => { 
                clearStage(); 
                setDiff('LOW'); 
                setSub("Level 1: Basic Structure. Simple vocabulary.", "‰ΩéÈöéÔºöÂü∫Êú¨ÁµêÊßã„ÄÇÁ∞°ÂñÆÁöÑË©ûÂΩô„ÄÇ"); 
            }
        },
        { 
            t: 11000, 
            action: () => addBlock("Because I was hungry,", "DC", "type-dc") 
        },
        { 
            t: 12500, 
            action: () => addBlock("I cooked pasta,", "IC", "type-ic") 
        },
        { 
            t: 13500, 
            action: () => addBlock("and", "CONN", "type-conn") 
        },
        { 
            t: 14000, 
            action: () => addBlock("I ate it all.", "IC", "type-ic") 
        },
        { 
            t: 15000, 
            action: () => setSub("Because I was hungry, I cooked pasta, and I ate it all.", "Âõ†ÁÇ∫ÊàëÂæàÈ§ìÔºåÊàëÁÖÆ‰∫ÜÁæ©Â§ßÂà©È∫µÔºåËÄå‰∏îÊàëÊääÂÆÉÂÖ®ÂêÉÂÖâ‰∫Ü„ÄÇ") 
        },
        { 
            t: 20000, 
            action: () => { 
                clearStage(); 
                setDiff('MEDIUM'); 
                setSub("Level 2: More complex vocabulary and structure.", "‰∏≠ÈöéÔºöÊõ¥Ë§áÈõúÁöÑË©ûÂΩôÂíåÁµêÊßã„ÄÇ"); 
            }
        },
        { 
            t: 22000, 
            action: () => addBlock("Although it was raining,", "DC", "type-dc") 
        },
        { 
            t: 23500, 
            action: () => addBlock("we decided to go hiking,", "IC", "type-ic") 
        },
        { 
            t: 24500, 
            action: () => addBlock("and", "CONN", "type-conn") 
        },
        { 
            t: 25000, 
            action: () => addBlock("we had a great time.", "IC", "type-ic") 
        },
        { 
            t: 26000, 
            action: () => setSub("Although it was raining, we decided to go hiking, and we had a great time.", "ÈõñÁÑ∂‰∏ãËëóÈõ®ÔºåÊàëÂÄëÈÇÑÊòØÊ±∫ÂÆöÂéªÈÅ†Ë∂≥ÔºåËÄå‰∏îÊàëÂÄëÁé©ÂæóÂæàÈñãÂøÉ„ÄÇ") 
        },
        { 
            t: 32000, 
            action: () => { 
                clearStage(); 
                setDiff('HIGH'); 
                setSub("Level 3: Advanced vocabulary and complex structure.", "È´òÈöéÔºöÈÄ≤ÈöéË©ûÂΩôÂíåË§áÈõúÁµêÊßã„ÄÇ"); 
            }
        },
        { 
            t: 34000, 
            action: () => addBlock("While I was studying for my exam,", "DC", "type-dc") 
        },
        { 
            t: 35500, 
            action: () => addBlock("my roommate was watching TV,", "IC", "type-ic") 
        },
        { 
            t: 36500, 
            action: () => addBlock("but", "CONN", "type-conn") 
        },
        { 
            t: 37000, 
            action: () => addBlock("I managed to concentrate.", "IC", "type-ic") 
        },
        { 
            t: 38000, 
            action: () => setSub("While I was studying for my exam, my roommate was watching TV, but I managed to concentrate.", "Áï∂ÊàëÂú®Ê∫ñÂÇôËÄÉË©¶ÊôÇÔºåÊàëÁöÑÂÆ§ÂèãÂú®ÁúãÈõªË¶ñÔºå‰ΩÜÊàëÈÇÑÊòØË®≠Ê≥ïÈõÜ‰∏≠Ê≥®ÊÑèÂäõ„ÄÇ") 
        },
        { 
            t: 45000, 
            action: () => { 
                clearStage(); 
                setDiff('MASTER'); 
                setSub("Congratulations! You've mastered Compound-Complex Sentences.", "ÊÅ≠ÂñúÔºÅ‰Ω†Â∑≤Á∂ìÊéåÊè°‰∫ÜË§áÂêàË§áÈõúÂè•„ÄÇ"); 
                AudioSys.playSound('magic');
            }
        }
    ];

    const totalTime = 50000;

    function loop() {
        if (isPaused) return;
        
        const elapsed = performance.now() - startTime;
        els.progress.style.width = Math.min(elapsed / totalTime * 100, 100) + '%';
        
        // Âü∑Ë°åÊôÇÈñìËª∏‰∏äÁöÑÂãï‰Ωú
        timeline.forEach((item, i) => {
            if (elapsed >= item.t && !executedIndices.has(i)) {
                item.action();
                executedIndices.add(i);
            }
        });
        
        if (elapsed < totalTime) {
            animationFrameId = requestAnimationFrame(loop);
        } else {
            // ÂãïÁï´ÁµêÊùü
            togglePause();
        }
    }

    // ÂàùÂßãÂåñÈü≥Ê®ÇÊåâÈàï
    els.musicBtn.onclick = () => {
        const isMuted = AudioSys.toggle();
        els.musicBtn.innerText = isMuted ? "üîá" : "üîä";
    };

    // Á∂ÅÂÆöÊö´ÂÅúÊåâÈàï‰∫ã‰ª∂
    els.pauseBtn.onclick = togglePause;

    // Èò≤Ê≠¢ÊâãÊ©ü‰∏äÁöÑÈõôÊìäÁ∏ÆÊîæ
    document.addEventListener('touchstart', function(e) {
        if (e.touches.length > 1) {
            e.preventDefault();
        }
    }, { passive: false });

    let lastTouchEnd = 0;
    document.addEventListener('touchend', function(e) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
            e.preventDefault();
        }
        lastTouchEnd = now;
    }, false);

    // Ëá™ÂãïÊí≠Êîæ
    window.onload = () => {
        setTimeout(() => {
            AudioSys.init();
            loop();
        }, 600);
    };

</script>
</body>
</html>
