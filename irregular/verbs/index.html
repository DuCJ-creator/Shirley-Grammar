<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ä¸è¦å‰‡å‹•è©äº’å‹•å­¸ç¿’å¹³å°</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* ===== ç·Šæ¹Šæ’ç‰ˆç‰ˆ CSS ===== */
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Noto Sans TC', sans-serif;
      line-height: 1.5;
      color: #333;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 10px;
    }
    .container { max-width: 1100px; margin: 0 auto; }

    header {
      text-align: center;
      margin-bottom: 12px;
      padding: 10px 12px;
      background: rgba(255,255,255,0.95);
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
    }
    h1 { color: #2c3e50; margin-bottom: 4px; font-size: 1.35rem; }
    .description { color: #7f8c8d; font-size: 0.85rem; }

    .mode-selector {
      display: flex; justify-content: center; flex-wrap: wrap;
      gap: 6px; margin-bottom: 12px;
    }
    .mode-btn {
      padding: 6px 12px; background: #3498db; color: #fff;
      border: none; border-radius: 16px; cursor: pointer;
      font-size: 0.85rem; font-weight: 500; transition: all .2s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,.1);
    }
    .mode-btn:hover { transform: translateY(-1px); }
    .mode-btn.active { background: #2c3e50; }

    .content-area {
      background: #fff; border-radius: 8px; padding: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,.1);
      min-height: 320px;
    }

    .section { display: none; }
    .section.active { display: block; }

    .filter-options {
      display: flex; flex-wrap: wrap; gap: 6px; margin: 8px 0 10px;
    }
    .filter-btn {
      padding: 4px 10px; background: #ecf0f1; border: none; border-radius: 12px;
      cursor: pointer; font-size: 0.8rem; transition: all .2s ease;
    }
    .filter-btn.active { background: #3498db; color: #fff; }

    .verb-list {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 6px; margin-bottom: 10px;
    }
    .verb-item {
      padding: 7px; background: #f8f9fa; border-radius: 6px; cursor: pointer;
      text-align: center; border-left: 3px solid #3498db; transition: all .2s ease;
      font-size: 0.9rem;
    }
    .verb-item small { font-size: 0.75rem; color: #666; }
    .verb-item:hover { background: #e9ecef; transform: translateY(-1px); }

    .verb-card {
      background: #fff; border-radius: 8px; padding: 10px; margin-top: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,.08);
      border-left: 4px solid #3498db;
    }
    .verb-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 6px;
    }
    .verb-header h3 { font-size: 1.05rem; }
    .verb-type {
      padding: 2px 7px; border-radius: 12px; color: #fff;
      font-size: 0.72rem; font-weight: bold;
    }
    .type-AAA { background:#e74c3c; }
    .type-ABA { background:#f39c12; }
    .type-ABB { background:#3498db; }
    .type-ABC { background:#9b59b6; }

    .verb-forms {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr));
      gap: 6px; margin-bottom: 6px;
    }
    .verb-form { padding: 6px; background:#f8f9fa; border-radius: 5px; }
    .verb-form h4 { margin-bottom: 2px; color:#7f8c8d; font-size:.75rem; }
    .verb-form p { font-weight:bold; font-size:.9rem; color:#2c3e50; }
    .pronunciation-btn {
      background: none; border: none; color:#3498db; cursor:pointer; font-size:.9rem;
      margin-left: 2px;
    }

    .examples { margin-top: 6px; }
    .example-toggle {
      background:#3498db; color:#fff; border:none; padding:4px 8px;
      border-radius:5px; cursor:pointer; font-size:.75rem;
    }
    .example { margin-top:6px; padding:6px; background:#f8f9fa; border-radius:5px;
      font-style: italic; font-size:.82rem; }

    .hidden { display:none; }

    /* ===== Quizï¼ˆä¸€æ¬¡ 10 é¡Œä¸€èµ·å¯«ï¼‰ ===== */
    .quiz-start { text-align:center; padding: 10px; }
    .quiz-start p { font-size: .9rem; margin-bottom: 4px; }
    .quiz-submit {
      padding: 8px 16px; background:#3498db; color:#fff; border:none; border-radius:6px;
      cursor:pointer; font-size:.95rem; margin-top:8px;
    }

    .quiz-container { margin-top: 6px; }
    .quiz-hint {
      background:#f1f7ff; border-left:4px solid #3498db; padding:6px 8px; border-radius:6px;
      font-size:.9rem; margin-bottom: 8px;
    }
    .quiz-list { display: grid; gap: 6px; }
    .quiz-item {
      padding: 8px; border:1px solid #eee; border-radius:6px; background:#fafafa;
      display: grid; grid-template-columns: 1fr 1fr; gap: 6px; align-items:center;
    }
    .quiz-item .q-title { grid-column: 1 / -1; font-weight: 700; font-size: .95rem; }
    .quiz-item label { font-size: .8rem; color:#555; }
    .quiz-item input {
      width: 100%; padding: 6px; border:1px solid #ddd; border-radius:4px; font-size:.9rem;
    }

    .quiz-result {
      margin-top: 10px; padding: 10px; background:#f8f9fa; border-radius:8px;
    }
    .result-score { font-size: 1.3rem; font-weight: 800; margin: 6px 0; color:#2c3e50; }
    .result-item { padding:6px; border-bottom:1px solid #eee; font-size:.88rem; }
    .result-item.correct { background:#d4edda; }
    .result-item.incorrect { background:#f8d7da; }

    @media (max-width: 768px) {
      .verb-list { grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); }
      .verb-forms { grid-template-columns: 1fr; }
      .quiz-item { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>Shirley's Irregular Verbs Learning Platform</h1>
    <p class="description">ä¸è¦å‰‡å‹•è©äº’å‹•å­¸ç¿’å¹³å°ï¼šå­¸ç¿’ã€è¤‡ç¿’ã€æ¸¬é©—ä¸è¦å‰‡å‹•è©ä¸‰æ…‹ï¼ˆå«ç™¼éŸ³èˆ‡ä¾‹å¥ï¼‰</p>
  </header>

  <div class="mode-selector">
    <button class="mode-btn active" data-mode="learn">Study Mode å­¸ç¿’æ¨¡å¼</button>
    <button class="mode-btn" data-mode="review">Review Mode è¤‡ç¿’æ¨¡å¼</button>
    <button class="mode-btn" data-mode="quiz">Quiz Mode æ¸¬é©—æ¨¡å¼</button>
  </div>

  <div class="content-area">
    <!-- å­¸ç¿’æ¨¡å¼ -->
    <div class="section active" id="learn-section">
      <h2 style="font-size:1.05rem;margin-bottom:4px;">å­¸ç¿’ä¸è¦å‰‡å‹•è©</h2>
      <p style="font-size:.85rem;color:#666;">é»æ“Šå‹•è©æŸ¥çœ‹è©³ç´°è³‡è¨Š</p>

      <div class="filter-options">
        <button class="filter-btn active" data-type="all">å…¨éƒ¨</button>
        <button class="filter-btn" data-type="AAA">AAAå‹</button>
        <button class="filter-btn" data-type="ABA">ABAå‹</button>
        <button class="filter-btn" data-type="ABB">ABBå‹</button>
        <button class="filter-btn" data-type="ABC">ABCå‹</button>
      </div>

      <div class="verb-list" id="learn-verb-list">
        <div style="padding:8px;color:#888;">è¼‰å…¥ä¸­...</div>
      </div>
      <div id="learn-verb-detail"></div>
    </div>

    <!-- è¤‡ç¿’æ¨¡å¼ -->
    <div class="section" id="review-section">
      <h2 style="font-size:1.05rem;margin-bottom:4px;">è¤‡ç¿’ä¸è¦å‰‡å‹•è©</h2>
      <p style="font-size:.85rem;color:#666;">é»æ“Šå‹•è©æŸ¥çœ‹è©³ç´°è³‡è¨Š</p>

      <div class="filter-options">
        <button class="filter-btn active" data-type="all">å…¨éƒ¨</button>
        <button class="filter-btn" data-type="AAA">AAAå‹</button>
        <button class="filter-btn" data-type="ABA">ABAå‹</button>
        <button class="filter-btn" data-type="ABB">ABBå‹</button>
        <button class="filter-btn" data-type="ABC">ABCå‹</button>
      </div>

      <div class="verb-list" id="review-verb-list">
        <div style="padding:8px;color:#888;">è¼‰å…¥ä¸­...</div>
      </div>
      <div id="review-verb-detail"></div>
    </div>

    <!-- æ¸¬é©—æ¨¡å¼ -->
    <div class="section" id="quiz-section">
      <h2 style="font-size:1.05rem;margin-bottom:6px;">ä¸è¦å‰‡å‹•è©æ¸¬é©—</h2>

      <div class="quiz-start" id="quiz-start">
        <p>æ¸¬é©—æç¤ºï¼šå¯«å‡ºæ¯å€‹å‹•è©çš„ <b>éå»å¼(V2)</b> èˆ‡ <b>éå»åˆ†è©(V3)</b></p>
        <p>ç³»çµ±å°‡éš¨æ©Ÿå‡º 10 é¡Œï¼Œæ¯é¡Œ 10 åˆ†ï¼Œæ»¿åˆ† 100 åˆ†</p>
        <button class="quiz-submit" id="start-quiz-btn">é–‹å§‹æ¸¬é©—</button>
      </div>

      <div class="quiz-container hidden" id="quiz-container">
        <div class="quiz-hint">ğŸŒŸ é¡Œå‹æç¤ºï¼ˆåªå‡ºç¾ä¸€æ¬¡ï¼‰ï¼šè«‹å¯« V2 / V3</div>

        <form id="quiz-form">
          <div class="quiz-list" id="quiz-list"></div>
          <button type="submit" class="quiz-submit" style="width:100%;">ä¸€æ¬¡æäº¤ç­”æ¡ˆ</button>
        </form>

        <div class="quiz-result hidden" id="quiz-result"></div>
      </div>
    </div>
  </div>
</div>

<script>
  const CSV_URL = "https://ducj-creator.github.io/Shirley-Grammar/irregular/verbs.csv";
  let verbs = [];          // å¾ CSV è¼‰å…¥å¾Œå¡«å…¥
  let quizVerbs = [];      // æœ¬æ¬¡æ¸¬é©— 10 é¡Œ

  document.addEventListener("DOMContentLoaded", async () => {
    // 1) å…ˆè¼‰å…¥ CSV
    await loadVerbsFromCSV();

    // 2) æ¨¡å¼åˆ‡æ›
    const modeButtons = document.querySelectorAll(".mode-btn");
    const sections = document.querySelectorAll(".section");

    modeButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const mode = btn.dataset.mode;

        modeButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        sections.forEach(s => s.classList.remove("active"));
        document.getElementById(`${mode}-section`).classList.add("active");

        if (mode === "learn") initLearnMode();
        if (mode === "review") initReviewMode();
        if (mode === "quiz") initQuizMode();
      });
    });

    // 3) åˆå§‹åŒ– learn
    initLearnMode();

    // Quiz btn
    document.getElementById("start-quiz-btn").addEventListener("click", startQuiz);
    document.getElementById("quiz-form").addEventListener("submit", submitQuiz);
  });

  /* ========== CSV è¼‰å…¥ + è§£æ ========== */
  async function loadVerbsFromCSV() {
    try {
      const res = await fetch(CSV_URL);
      if (!res.ok) throw new Error("CSV ä¸‹è¼‰å¤±æ•—");
      const text = await res.text();
      verbs = parseCSV(text);

      // è‹¥ CSV æ²’æœ‰ type æ¬„ï¼Œå˜—è©¦æ ¹æ“š v1/v2/v3 å½¢æ…‹åˆ¤æ–·
      verbs.forEach(v => { if (!v.type) v.type = inferType(v.v1, v.v2, v.v3); });

      // æ›´æ–°åˆ—è¡¨
      initLearnMode();
      initReviewMode();
    } catch (err) {
      console.error(err);
      const msg = `<div style="padding:8px;color:#c00;">CSV è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªç¶²å€å¯é€£ç·š</div>`;
      document.getElementById("learn-verb-list").innerHTML = msg;
      document.getElementById("review-verb-list").innerHTML = msg;
    }
  }
function parseCSV(csvText) {
  const rows = csvText.trim().split(/\r?\n/).filter(Boolean);
  if (!rows.length) return [];

  const rawHeaders = splitCSVLine(rows[0]);
  const headers = rawHeaders.map(h => normalizeHeader(h));

  const data = [];
  for (let i = 1; i < rows.length; i++) {
    const cols = splitCSVLine(rows[i]);
    const obj = {};
    headers.forEach((h, idx) => {
      obj[h] = (cols[idx] ?? "").trim();
    });

    data.push({
      type: obj.type || "",
      v1: obj.v1 || "",
      v1_example: obj.v1_example || "",
      v2: obj.v2 || "",
      v2_example: obj.v2_example || "",
      v3: obj.v3 || "",
      v3_example: obj.v3_example || "",
      meaning: obj.meaning || ""
    });
  }

  return data.filter(v => v.v1 && v.v2 && v.v3);
}

function normalizeHeader(h) {
  const s = h.trim().toLowerCase();

  if (s.includes("type")) return "type";
  if (s.includes("v1") && s.includes("ä¾‹å¥")) return "v1_example";
  if (s.includes("v2") && s.includes("ä¾‹å¥")) return "v2_example";
  if (s.includes("v3") && s.includes("ä¾‹å¥")) return "v3_example";

  if (s.includes("v1")) return "v1";
  if (s.includes("v2")) return "v2";
  if (s.includes("v3")) return "v3";

  if (s.includes("ä¸­æ–‡") || s.includes("meaning")) return "meaning";

  // å…¶ä»–æ¬„ä½å…ˆåŸæ¨£ï¼ˆä½†æˆ‘å€‘ä¸ä¸€å®šæœƒç”¨åˆ°ï¼‰
  return s.replace(/\s+/g, "_");
}

function splitCSVLine(line) {
  const result = [];
  let cur = "", inQuotes = false;
  for (let i = 0; i < line.length; i++) {
    const ch = line[i];
    if (ch === '"') {
      if (inQuotes && line[i + 1] === '"') { cur += '"'; i++; }
      else inQuotes = !inQuotes;
    } else if (ch === ',' && !inQuotes) {
      result.push(cur); cur = "";
    } else {
      cur += ch;
    }
  }
  result.push(cur);
  return result;
}

  function inferType(v1, v2, v3) {
    if (v1===v2 && v2===v3) return "AAA";
    if (v1===v3 && v1!==v2) return "ABA";
    if (v2===v3 && v1!==v2) return "ABB";
    return "ABC";
  }

  /* ========== Learn / Review ========== */
  function initLearnMode() {
    renderVerbList("learn");
    bindFilters("learn");
  }
  function initReviewMode() {
    renderVerbList("review");
    bindFilters("review");
  }

  function renderVerbList(mode) {
    const verbList = document.getElementById(`${mode}-verb-list`);
    if (!verbs.length) {
      verbList.innerHTML = `<div style="padding:8px;color:#888;">è¼‰å…¥ä¸­...</div>`;
      return;
    }
    verbList.innerHTML = "";
    verbs.forEach(verb => {
      const item = document.createElement("div");
      item.className = "verb-item";
      item.dataset.type = verb.type;
      item.innerHTML = `<div>${verb.v1}</div><small>${verb.meaning || ""}</small>`;
      item.addEventListener("click", () => showVerbDetail(mode, verb));
      verbList.appendChild(item);
    });
  }

  function bindFilters(mode) {
    const filterButtons = document.querySelectorAll(`#${mode}-section .filter-btn`);
    filterButtons.forEach(button => {
      button.onclick = () => {
        const type = button.dataset.type;
        filterButtons.forEach(b => b.classList.remove("active"));
        button.classList.add("active");

        document.querySelectorAll(`#${mode}-verb-list .verb-item`).forEach(item => {
          item.style.display = (type === "all" || item.dataset.type === type) ? "block" : "none";
        });
      };
    });
  }

  function showVerbDetail(mode, verb) {
    const detailContainer = document.getElementById(`${mode}-verb-detail`);
    detailContainer.innerHTML = `
      <div class="verb-card">
        <div class="verb-header">
          <h3>${verb.v1} - ${verb.meaning || ""}</h3>
          <span class="verb-type type-${verb.type}">${verb.type}</span>
        </div>

        <div class="verb-forms">
          <div class="verb-form">
            <h4>åŸå½¢ (V1)</h4>
            <p>${verb.v1} <button class="pronunciation-btn" data-word="${verb.v1}">ğŸ”Š</button></p>
          </div>
          <div class="verb-form">
            <h4>éå»å¼ (V2)</h4>
            <p>${verb.v2} <button class="pronunciation-btn" data-word="${verb.v2}">ğŸ”Š</button></p>
          </div>
          <div class="verb-form">
            <h4>éå»åˆ†è© (V3)</h4>
            <p>${verb.v3} <button class="pronunciation-btn" data-word="${verb.v3}">ğŸ”Š</button></p>
          </div>
        </div>

        <div class="examples">
          <button class="example-toggle">é¡¯ç¤ºä¾‹å¥</button>
          <div class="example-content" style="display:none;">
            ${verb.v1_example ? `<div class="example"><b>V1:</b> ${verb.v1_example} <button class="pronunciation-btn" data-sentence="${verb.v1_example}">ğŸ”Š</button></div>` : ""}
            ${verb.v2_example ? `<div class="example"><b>V2:</b> ${verb.v2_example} <button class="pronunciation-btn" data-sentence="${verb.v2_example}">ğŸ”Š</button></div>` : ""}
            ${verb.v3_example ? `<div class="example"><b>V3:</b> ${verb.v3_example} <button class="pronunciation-btn" data-sentence="${verb.v3_example}">ğŸ”Š</button></div>` : ""}
          </div>
        </div>
      </div>
    `;

    detailContainer.querySelectorAll(".pronunciation-btn").forEach(btn => {
      btn.onclick = () => playAudio(btn.dataset.word || btn.dataset.sentence);
    });

    const toggle = detailContainer.querySelector(".example-toggle");
    const content = detailContainer.querySelector(".example-content");
    toggle.onclick = () => {
      const show = content.style.display === "none";
      content.style.display = show ? "block" : "none";
      toggle.textContent = show ? "éš±è—ä¾‹å¥" : "é¡¯ç¤ºä¾‹å¥";
    };
  }

  /* ========== Quizï¼ˆä¸€æ¬¡ 10 é¡Œã€ä¸€æ¬¡æäº¤ï¼‰ ========== */
  function initQuizMode() {
    document.getElementById("quiz-start").classList.remove("hidden");
    document.getElementById("quiz-container").classList.add("hidden");
    document.getElementById("quiz-result").classList.add("hidden");
    document.getElementById("quiz-list").innerHTML = "";
  }

  function startQuiz() {
    if (!verbs.length) {
      alert("å‹•è©è³‡æ–™å°šæœªè¼‰å…¥å®Œæˆ");
      return;
    }

    quizVerbs = [...verbs].sort(() => Math.random() - 0.5).slice(0, 10);

    document.getElementById("quiz-start").classList.add("hidden");
    document.getElementById("quiz-container").classList.remove("hidden");
    document.getElementById("quiz-result").classList.add("hidden");

    renderQuizList();
  }

  function renderQuizList() {
    const list = document.getElementById("quiz-list");
    list.innerHTML = "";

    quizVerbs.forEach((v, idx) => {
      const item = document.createElement("div");
      item.className = "quiz-item";
      item.innerHTML = `
        <div class="q-title">${idx+1}. ${v.v1} <small style="font-weight:400;color:#666;">(${v.meaning || ""})</small></div>

        <label>V2 éå»å¼</label>
        <input type="text" name="v2-${idx}" autocomplete="off" required />

        <label>V3 éå»åˆ†è©</label>
        <input type="text" name="v3-${idx}" autocomplete="off" required />
      `;
      list.appendChild(item);
    });
  }

  function submitQuiz(e) {
    e.preventDefault();

    let score = 0;
    let detailsHTML = "";

    quizVerbs.forEach((v, idx) => {
      const v2Input = document.querySelector(`input[name="v2-${idx}"]`).value.trim().toLowerCase();
      const v3Input = document.querySelector(`input[name="v3-${idx}"]`).value.trim().toLowerCase();
      const v2Correct = v2Input === (v.v2 || "").toLowerCase();
      const v3Correct = v3Input === (v.v3 || "").toLowerCase();
      const isCorrect = v2Correct && v3Correct;

      if (isCorrect) score += 10;

      detailsHTML += `
        <div class="result-item ${isCorrect ? "correct" : "incorrect"}">
          <div><b>${idx+1}. ${v.v1}</b> (${v.meaning || ""})</div>
          <div>ä½ çš„ç­”æ¡ˆï¼šV2=${v2Input || "-"} / V3=${v3Input || "-"}</div>
          <div>æ­£ç¢ºç­”æ¡ˆï¼šV2=${v.v2} / V3=${v.v3}</div>
          <div>${isCorrect ? "âœ“ æ­£ç¢º" : "âœ— éŒ¯èª¤"}</div>
        </div>
      `;
    });

    const resultEl = document.getElementById("quiz-result");
    resultEl.innerHTML = `
      <h3 style="font-size:1.05rem;">æ¸¬é©—çµæœ</h3>
      <div class="result-score">${score} / 100</div>
      <p style="font-size:.9rem;">${score >= 60 ? "æ­å–œï¼è¡¨ç¾ä¸éŒ¯ï¼" : "éœ€è¦æ›´å¤šç·´ç¿’ï¼ŒåŠ æ²¹ï¼"}</p>
      <div style="margin-top:6px;">${detailsHTML}</div>
      <div style="text-align:center;margin-top:8px;">
        <button class="quiz-submit" type="button" onclick="initQuizMode()">é‡æ–°æ¸¬é©—</button>
      </div>
    `;

    resultEl.classList.remove("hidden");
    // æ²åˆ°çµæœå€
    resultEl.scrollIntoView({ behavior: "smooth", block: "start" });
  }

  /* ========== TTS ç™¼éŸ³ ========== */
  function playAudio(text) {
    if (!text) return;
    if ("speechSynthesis" in window) {
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "en-US";
      u.rate = 0.8;
      window.speechSynthesis.speak(u);
    } else {
      alert("æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒèªéŸ³åˆæˆåŠŸèƒ½");
    }
  }
</script>
</body>
</html>
