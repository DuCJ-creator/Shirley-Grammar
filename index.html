<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shirley's E-Charger - Enhanced</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(to bottom, #1a1a1a, #2d2d2d, #404040);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #fff;
            position: relative;
            overflow-x: hidden;
            cursor: auto;
        }
        
        #station-container {
            text-align: center;
            z-index: 1;
            width: 100%;
            max-width: 800px;
            margin-bottom: 150px;
        }
        
        #station-svg {
            border: 2px solid #808080;
            background: linear-gradient(to bottom, #333333, #555555);
            border-radius: 0;
            box-shadow: 0 0 20px rgba(139, 69, 19, 0.5);
            width: 100%;
            height: auto;
        }
        
        .branch-label {
            font-weight: bold;
            fill: #FFFFFF;
            text-anchor: middle;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .port {
            cursor: pointer;
            stroke: #C0C0C0;
            stroke-width: 2;
            transition: all 0.3s ease;
            fill: #808080;
        }
        
        .port:hover {
            transform: scale(1.2);
            stroke: #FFD700;
            stroke-width: 3;
            fill: #FFD700;
        }
        
        .port-label {
            font-size: 12px;
            fill: #FFFFFF;
            text-anchor: middle;
            pointer-events: none;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.9);
            font-weight: bold;
        }
        
        .pillar-label {
            font-weight: bold;
            fill: #FFFFFF;
            text-anchor: middle;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pillar-label:hover {
            fill: #FFD700;
            font-size: 16px;
        }
        
        .electricity-box {
            fill: #404040;
            stroke: #B87333;
            stroke-width: 3;
            rx: 5;
        }
        
        .box-number {
            font-weight: bold;
            fill: #FFD700;
            text-anchor: middle;
            font-size: 20px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        
        .charging-wire {
            stroke: #B87333;
            stroke-width: 3;
            fill: none;
        }
        
        #modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
        }
        
        #modal-content {
            background: linear-gradient(to bottom, #2d2d2d, #404040);
            margin: auto;
            padding: 20px;
            border: 2px solid #B87333;
            width: 80%;
            max-width: 600px;
            border-radius: 5px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 0 30px rgba(184, 115, 51, 0.7);
            color: #fff;
        }
        
        #close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        #close:hover {
            color: #FFD700;
        }
        
        .explanation-title {
            color: #FFFFFF;
            border-bottom: 2px solid #B87333;
            padding-bottom: 10px;
            font-size: 24px;
        }
        
        .explanation-text {
            line-height: 1.6;
            color: #CCCCCC;
            font-size: 16px;
        }
        
        @keyframes extend {
            from {
                stroke-dashoffset: 1000;
            }
            to {
                stroke-dashoffset: 0;
            }
        }
        
        .animated-cable {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: extend 2s ease-in-out forwards;
            stroke: #4682B4;
            stroke-width: 6;
            fill: none;
        }
        
        .charging-wire {
            stroke-dasharray: 10 5;
            animation: flowWire 0.5s linear infinite;
        }
        
        @keyframes flowWire {
            from {
                stroke-dashoffset: 0;
            }
            to {
                stroke-dashoffset: -15;
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                r: 12;
            }
            50% {
                transform: scale(1.1);
                r: 14;
            }
        }
        
        .port.animate {
            animation: pulse 1s ease-in-out;
        }
        
        h1 {
            color: #B87333;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        p {
            color: #CCCCCC;
            font-style: normal;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .red-button {
            fill: #FF4444;
            stroke: #CC0000;
            stroke-width: 2;
            rx: 8;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .red-button:hover {
            fill: #FF6666;
            stroke: #FFD700;
            stroke-width: 3;
        }
        
        .red-button-text {
            fill: white;
            font-weight: bold;
            text-anchor: middle;
            font-size: 12px;
            pointer-events: none;
        }
        
        .pillar-block {
            fill: #606060;
            stroke: #B87333;
            stroke-width: 2;
            rx: 5;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pillar-block:hover {
            stroke: #FFD700;
            stroke-width: 3;
            fill: #707070;
        }
        
        .pillar-wire {
            stroke: #FFD700;
            stroke-width: 4;
            fill: none;
            stroke-dasharray: 10 5;
            animation: flowWire 0.3s linear infinite;
        }
        
        .status-message {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            font-size: 12px;
        }

        /* 機器人容器樣式 */
        .robots-container {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 50px;
            z-index: 10;
            pointer-events: none;
        }

        .robot-with-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: auto;
        }

        .left-robot {
            align-items: flex-start;
        }

        .right-robot {
            align-items: flex-end;
        }

        /* 機器人樣式 */
        .robot {
            width: 120px;
            height: 180px;
            margin-bottom: 10px;
        }

        .robot-body {
            fill: #87CEEB;
            stroke: #4169E1;
            stroke-width: 2;
        }

        .robot-head {
            fill: #FFB6C1;
            stroke: #FF69B4;
            stroke-width: 2;
        }

        .robot-leg {
            fill: #98FB98;
            stroke: #32CD32;
            stroke-width: 1;
            animation: legSwing 1s ease-in-out infinite alternate;
        }

        .robot-leg.left {
            animation-delay: -0.5s;
        }

        .robot-antenna {
            stroke: #FFD700;
            stroke-width: 3;
            stroke-linecap: round;
            fill: none;
        }

        .robot-eye {
            fill: #000;
        }

        .robot-mouth {
            fill: none;
            stroke: #FF69B4;
            stroke-width: 2;
        }

        @keyframes legSwing {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-5px);
            }
            60% {
                transform: translateY(-3px);
            }
        }

        /* 卡片樣式 */
        .grammar-card {
            width: 100px;
            height: 125px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid #B87333;
            border-radius: 10px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .grammar-card:hover {
            transform: scale(1.3);
            z-index: 20;
            border-color: #FFD700;
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 7px;
        }

        /* 響應式設計 */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            p {
                font-size: 14px;
            }
            
            body {
                padding: 10px;
            }

            .robots-container {
                padding: 0 20px;
            }

            .robot {
                width: 80px;
                height: 120px;
            }

            .grammar-card {
                width: 70px;
                height: 90px;
            }

            .grammar-card:hover {
                transform: scale(1.2);
            }
        }

        @media (max-width: 480px) {
            .robots-container {
                padding: 0 10px;
            }

            .robot {
                width: 60px;
                height: 90px;
            }

            .grammar-card {
                width: 50px;
                height: 65px;
            }

            .grammar-card:hover {
                transform: scale(1.1);
            }
        }
    </style>
</head>
<body>
    <div id="station-container">
        <h1>Shirley's Grammar E-Charger</h1>
        <p>Click on the pillar levels or charging ports to power up your grammar knowledge!</p>
        <svg id="station-svg" width="800" height="600" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
            <!-- 地面 -->
            <rect x="0" y="550" width="800" height="50" fill="#8B4513" />
            
            <!-- 主支柱 -->
            <rect x="390" y="100" width="20" height="400" fill="#696969" stroke="#808080" stroke-width="3" class="animated-cable" />
            
            <!-- 支柱區塊 -->
            <g id="pillar-blocks">
                <rect x="370" y="120" width="60" height="60" class="pillar-block" onclick="handlePillarClick('simple')" />
                <line x1="400" y1="180" x2="400" y2="200" class="pillar-wire" />
                
                <rect x="370" y="200" width="60" height="60" class="pillar-block" onclick="handlePillarClick('compound')" />
                <line x1="400" y1="260" x2="400" y2="280" class="pillar-wire" />
                
                <rect x="370" y="280" width="60" height="60" class="pillar-block" onclick="handlePillarClick('complex')" />
                <line x1="400" y1="340" x2="400" y2="360" class="pillar-wire" />
                
                <rect x="370" y="360" width="60" height="60" class="pillar-block" onclick="handlePillarClick('compound-complex')" />
            </g>
            
            <!-- 支柱標籤 -->
            <text x="400" y="150" class="pillar-label" onclick="handlePillarClick('simple')">1. Simple</text>
            <text x="400" y="230" class="pillar-label" onclick="handlePillarClick('compound')">2. Compound</text>
            <text x="400" y="310" class="pillar-label" onclick="handlePillarClick('complex')">3. Complex</text>
            <text x="400" y="390" class="pillar-label" onclick="handlePillarClick('compound-complex')">4. Compound-Complex</text>
            
            <!-- 頂部標誌 -->
            <rect x="320" y="60" width="160" height="40" fill="#B87333" rx="5" stroke="#CD853F" stroke-width="2" />
            <text x="400" y="90" fill="#FFFFFF" text-anchor="middle" font-weight="bold" font-size="18">Sentence Structures</text>
            
            <!-- 第一部分：詞性 -->
            <path d="M 400 130 Q 300 100 200 130" class="animated-cable" />
            <rect x="160" y="80" width="80" height="100" class="electricity-box" />
            
            <!-- 紅色按鈕 -->
            <rect x="160" y="130" width="80" height="40" class="red-button" onclick="handleSectionClick('parts-of-speech')" />
            <text x="200" y="145" class="red-button-text">I. Parts of</text>
            <text x="200" y="160" class="red-button-text">Speech</text>
            
            <!-- 端口 -->
            <g id="section1-ports">
                <circle cx="80" cy="60" r="12" class="port" onclick="handlePortClick('nouns')" />
                <text x="80" y="65" class="port-label">Nouns</text>
                <line x1="80" y1="60" x2="200" y2="130" class="charging-wire" />
                
                <circle cx="120" cy="200" r="12" class="port" onclick="handlePortClick('pronouns')" />
                <text x="120" y="205" class="port-label">Pronouns</text>
                <line x1="120" y1="200" x2="200" y2="130" class="charging-wire" />
                
                <circle cx="40" cy="120" r="12" class="port" onclick="handlePortClick('adjectives-adverbs')" />
                <text x="40" y="125" class="port-label">Adjectives &amp; Adverbs</text>
                <line x1="40" y1="120" x2="200" y2="130" class="charging-wire" />
                
                <circle cx="140" cy="30" r="12" class="port" onclick="handlePortClick('verbs')" />
                <text x="140" y="35" class="port-label">Verbs</text>
                <line x1="140" y1="30" x2="200" y2="130" class="charging-wire" />
                
                <circle cx="100" cy="220" r="12" class="port" onclick="handlePortClick('prepositions')" />
                <text x="100" y="225" class="port-label">Prepositions</text>
                <line x1="100" y1="220" x2="200" y2="130" class="charging-wire" />
            </g>
            
            <!-- 第二部分：非限定動詞 -->
            <path d="M 400 350 Q 300 380 200 350" class="animated-cable" />
            <rect x="160" y="300" width="80" height="100" class="electricity-box" />
            
            <rect x="160" y="350" width="80" height="40" class="red-button" onclick="handleSectionClick('nonfinite-verbs')" />
            <text x="200" y="365" class="red-button-text">II. Non-finite</text>
            <text x="200" y="380" class="red-button-text">Verbs</text>
            
            <g id="section2-ports">
                <circle cx="80" cy="280" r="12" class="port" onclick="handlePortClick('infinitive')" />
                <text x="80" y="285" class="port-label">Infinitive Verbs</text>
                <line x1="80" y1="280" x2="200" y2="350" class="charging-wire" />
                
                <circle cx="120" cy="420" r="12" class="port" onclick="handlePortClick('gerund')" />
                <text x="120" y="425" class="port-label">Gerund</text>
                <line x1="120" y1="420" x2="200" y2="350" class="charging-wire" />
                
                <circle cx="40" cy="340" r="12" class="port" onclick="handlePortClick('present-participle')" />
                <text x="40" y="345" class="port-label">Present Participle</text>
                <line x1="40" y1="340" x2="200" y2="350" class="charging-wire" />
                
                <circle cx="140" cy="270" r="12" class="port" onclick="handlePortClick('past-participle')" />
                <text x="140" y="275" class="port-label">Past Participle</text>
                <line x1="140" y1="270" x2="200" y2="350" class="charging-wire" />
            </g>
            
            <!-- 第三部分：子句 -->
            <path d="M 400 130 Q 500 100 600 130" class="animated-cable" />
            <rect x="560" y="80" width="80" height="100" class="electricity-box" />
            
            <rect x="560" y="130" width="80" height="40" class="red-button" onclick="handleSectionClick('clauses')" />
            <text x="600" y="145" class="red-button-text">III. Clauses</text>
            
            <g id="section3-ports">
                <circle cx="680" cy="60" r="12" class="port" onclick="handlePortClick('noun-clause')" />
                <text x="680" y="65" class="port-label">Noun Clause</text>
                <line x1="680" y1="60" x2="600" y2="130" class="charging-wire" />
                
                <circle cx="640" cy="200" r="12" class="port" onclick="handlePortClick('adjective-clause')" />
                <text x="640" y="205" class="port-label">Adjective Clause</text>
                <line x1="640" y1="200" x2="600" y2="130" class="charging-wire" />
                
                <circle cx="720" cy="120" r="12" class="port" onclick="handlePortClick('adverb-clause')" />
                <text x="720" y="125" class="port-label">Adverb Clause</text>
                <line x1="720" y1="120" x2="600" y2="130" class="charging-wire" />
            </g>
            
            <!-- 第四部分：特殊句型 -->
            <path d="M 400 350 Q 500 380 600 350" class="animated-cable" />
            <rect x="560" y="300" width="80" height="100" class="electricity-box" />
            
            <rect x="560" y="350" width="80" height="40" class="red-button" onclick="handleSectionClick('special-sentences')" />
            <text x="600" y="365" class="red-button-text">IV. Special</text>
            <text x="600" y="380" class="red-button-text">Sentences</text>
            
            <g id="section4-ports">
                <circle cx="680" cy="280" r="12" class="port" onclick="handlePortClick('questions')" />
                <text x="680" y="285" class="port-label">Questions</text>
                <line x1="680" y1="280" x2="600" y2="350" class="charging-wire" />
                
                <circle cx="640" cy="420" r="12" class="port" onclick="handlePortClick('exclamations')" />
                <text x="640" y="425" class="port-label">Exclamations</text>
                <line x1="640" y1="420" x2="600" y2="350" class="charging-wire" />
                
                <circle cx="720" cy="340" r="12" class="port" onclick="handlePortClick('inverted')" />
                <text x="720" y="345" class="port-label">Inverted</text>
                <line x1="720" y1="340" x2="600" y2="350" class="charging-wire" />
                
                <circle cx="600" cy="270" r="12" class="port" onclick="handlePortClick('subjunctive')" />
                <text x="600" y="275" class="port-label">Subjunctive Mood</text>
                <line x1="600" y1="270" x2="600" y2="350" class="charging-wire" />
            </g>
        </svg>
    </div>

    <!-- 兩個機器人手持卡片 -->
    <div class="robots-container">
        <!-- 左邊機器人 - 顯示第一張圖 -->
        <div class="robot-with-card left-robot">
            <div class="grammar-card" onclick="showCardInfo('sentence-structure')">
                <img src="https://ducj-creator.github.io/Shirley-Grammar/assets/sentence%20structure.png" 
                     alt="Sentence Structure" class="card-image">
            </div>
            <svg class="robot" viewBox="0 0 200 300" xmlns="http://www.w3.org/2000/svg">
                <!-- 機器人身體 -->
                <rect x="50" y="90" width="100" height="80" rx="15" class="robot-body" />
                
                <!-- 機器人頭部 -->
                <circle cx="100" cy="60" r="25" class="robot-head" />
                
                <!-- 天線 -->
                <line x1="100" y1="35" x2="100" y2="15" class="robot-antenna" />
                <circle cx="100" cy="15" r="4" fill="#FFD700" />
                
                <!-- 眼睛 -->
                <circle cx="92" cy="55" r="3" class="robot-eye" />
                <circle cx="108" cy="55" r="3" class="robot-eye" />
                
                <!-- 微笑 -->
                <path d="M 90 70 Q 100 80 110 70" class="robot-mouth" />
                
                <!-- 腿部 -->
                <rect x="70" y="175" width="12" height="25" rx="4" class="robot-leg left" />
                <rect x="118" y="175" width="12" height="25" rx="4" class="robot-leg" />
            </svg>
        </div>

        <!-- 右邊機器人 - 顯示第二張圖 -->
        <div class="robot-with-card right-robot">
            <div class="grammar-card" onclick="showCardInfo('grammar-concepts')">
                <img src="https://ducj-creator.github.io/Shirley-Grammar/assets/key%20grammar%20concepts.png" 
                     alt="Key Grammar Concepts" class="card-image">
            </div>
            <svg class="robot" viewBox="0 0 200 300" xmlns="http://www.w3.org/2000/svg">
                <!-- 機器人身體 -->
                <rect x="50" y="90" width="100" height="80" rx="15" class="robot-body" />
                
                <!-- 機器人頭部 -->
                <circle cx="100" cy="60" r="25" class="robot-head" />
                
                <!-- 天線 -->
                <line x1="100" y1="35" x2="100" y2="15" class="robot-antenna" />
                <circle cx="100" cy="15" r="4" fill="#FFD700" />
                
                <!-- 眼睛 -->
                <circle cx="92" cy="55" r="3" class="robot-eye" />
                <circle cx="108" cy="55" r="3" class="robot-eye" />
                
                <!-- 微笑 -->
                <path d="M 90 70 Q 100 80 110 70" class="robot-mouth" />
                
                <!-- 腿部 -->
                <rect x="70" y="175" width="12" height="25" rx="4" class="robot-leg left" />
                <rect x="118" y="175" width="12" height="25" rx="4" class="robot-leg" />
            </svg>
        </div>
    </div>

    <!-- Modal for Section Explanations -->
    <div id="modal">
        <div id="modal-content">
            <span id="close">&times;</span>
            <h2 id="modal-title" class="explanation-title"></h2>
            <p id="modal-text" class="explanation-text"></p>
        </div>
    </div>

    <!-- Status Message -->
    <div id="status-message" class="status-message" style="display: none;"></div>

    <script>
        // CSV 數據
        const grammarCSV = `no.,key point,url
S-1,simple,https://ducj-creator.github.io/Shirley-Grammar/simple/
S-2,compound,https://ducj-creator.github.io/Shirley-Grammar/compound/
S-3,complex,https://ducj-creator.github.io/Shirley-Grammar/complex/
S-4,compound-complex,https://ducj-creator.github.io/Shirley-Grammar/compound-complex/
P-1,nouns,https://ducj-creator.github.io/Shirley-Grammar/nouns/
P-2,pronouns,https://ducj-creator.github.io/Shirley-Grammar/pronouns/
P-3,adjectives-adverbs,https://ducj-creator.github.io/Shirley-Grammar/adjectives-adverbs/
P-4,verbs,https://ducj-creator.github.io/Shirley-Grammar/verbs/
P-5,prepositions,https://ducj-creator.github.io/Shirley-Grammar/prepositions/
V-1,infinitive,https://ducj-creator.github.io/Shirley-Grammar/infinitive/
V-2,gerund,https://ducj-creator.github.io/Shirley-Grammar/gerund/
V-3,present-participle,https://ducj-creator.github.io/Shirley-Grammar/present-participle/
V-4,past-participle,https://ducj-creator.github.io/Shirley-Grammar/past-participle/
C-1,noun-clause,https://ducj-creator.github.io/Shirley-Grammar/noun-clause/
C-2,adjective-clause,https://ducj-creator.github.io/Shirley-Grammar/adjective-clause/
C-3,adverb-clause,https://ducj-creator.github.io/Shirley-Grammar/adverb-clause/
SS-1,questions,https://ducj-creator.github.io/Shirley-Grammar/questions/
SS-2,exclamations,https://ducj-creator.github.io/Shirley-Grammar/exclamations/
SS-3,inverted,https://ducj-creator.github.io/Shirley-Grammar/inverted/
SS-4,subjunctive,https://ducj-creator.github.io/Shirley-Grammar/subjunctive/`;

        // 解析CSV數據
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const result = {};
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (line) {
                    const columns = line.split(',');
                    if (columns.length >= 3) {
                        const key = columns[1].trim();
                        const url = columns[2].trim();
                        if (key && url) {
                            result[key] = url;
                        }
                    }
                }
            }
            return result;
        }

        // 加載語法點連結
        let grammarLinks = {};
        
        function loadGrammarLinks() {
            try {
                grammarLinks = parseCSV(grammarCSV);
                console.log('Grammar links loaded:', grammarLinks);
                showStatus(`Loaded ${Object.keys(grammarLinks).length} grammar links`, 3000);
            } catch (error) {
                console.error('Error loading grammar links:', error);
                showStatus('Error loading grammar links', 3000);
            }
        }

        // 顯示狀態訊息
        function showStatus(message, duration = 2000) {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.style.display = 'block';
            setTimeout(() => {
                statusEl.style.display = 'none';
            }, duration);
        }

        // 點擊鎖定機制
        let isProcessingClick = false;
        
        // 安全的打開連結函數
        function safeOpenLink(url, key) {
            if (isProcessingClick) {
                console.log('Click already in progress, ignoring duplicate click');
                return;
            }
            
            isProcessingClick = true;
            console.log('Opening link for:', key, 'URL:', url);
            showStatus(`Redirecting to ${key}...`);
            
            setTimeout(() => {
                try {
                    window.open(url, '_blank');
                } catch (error) {
                    console.error('Error opening link:', error);
                    showStatus(`Error opening ${key}`);
                }
                
                setTimeout(() => {
                    isProcessingClick = false;
                }, 1000);
            }, 500);
        }

        // 處理柱子點擊
        function handlePillarClick(key) {
            const lowerKey = key.toLowerCase();
            console.log('Pillar clicked:', key, 'Looking for:', lowerKey);
            
            if (grammarLinks[lowerKey]) {
                safeOpenLink(grammarLinks[lowerKey], key);
            } else {
                console.log('Available keys:', Object.keys(grammarLinks));
                showStatus(`No link found for ${key}`);
            }
        }

        // 處理端口點擊
        function handlePortClick(key) {
            const lowerKey = key.toLowerCase();
            console.log('Port clicked:', key, 'Looking for:', lowerKey);
            
            if (grammarLinks[lowerKey]) {
                safeOpenLink(grammarLinks[lowerKey], key);
            } else {
                showStatus(`No link found for ${key}`);
            }
        }

        // 章節解釋數據
        const sectionExplanations = {
            'parts-of-speech': {
                title: "I. Parts of Speech 詞性",
                text: "The eight parts of speech are the basic categories of words in English grammar: nouns, pronouns, verbs, adjectives, adverbs, prepositions, conjunctions, and interjections. Here, we will mainly focus on the first six. (The FANBOYS conjunctions are explained in 'Compound Sentences,' and interjections like 'Wow,' 'Oh,' 'Hey,' 'Oops,' and 'Ouch' are limited in number.)<br><br>英語的八大詞類是詞彙在文法上的基本類別：名詞、代名詞、動詞、形容詞、副詞、介系詞、連接詞和感嘆詞。在此，我們將主要著重於前六類。（FANBOYS 連接詞已在「複合句」中說明；感嘆詞的數量有限，如「Wow、Oh、Hey、Oops 和 Ouch」。）"
            },
            'nonfinite-verbs': {
                title: "II. Non-finite Verbs 非限定動詞",
                text: "Non-finite verbs are verb forms that do not show tense, person, or number. They function as other parts of speech (nouns, adjectives, or adverbs) within a sentence. They include the infinitive, the gerund, and the participles (present and past).<br><br>非限定動詞 (Non-finite Verbs) 是指不顯示時態、人稱或數量的動詞形式。它們在句中充當其他詞類（如名詞、形容詞或副詞）。它們包括不定詞 (Infinitive)、動名詞 (Gerund)，以及分詞 (Participles)（現在分詞與過去分詞）。"
            },
            'clauses': {
                title: "III. Clauses 子句",
                text: "A clause is a group of words that contains a subject and a verb. Clauses are fundamentally classified into two types based on their function: independent clauses (which can stand alone as a complete sentence) and dependent clauses (which cannot stand alone).<br>Another key method for classifying dependent clauses focuses on their grammatical role within a sentence. These functional classifications are: Nominal Clauses (or Noun Clauses)；Relative Clauses (or Adjective Clauses)；Adverbial Clauses (or Adverb Clauses)<br><br>子句的分類（Clause Classification）<br>子句 (Clause) 是一組包含一個主詞 (subject) 和一個動詞 (verb) 的詞群。子句的分類方式主要有兩種：<br>1. 依獨立性分類<br>這是最基礎的分類，將子句分為兩大類：<br>獨立子句 (Independent Clause)：能獨立存在，構成一個完整的句子。<br>從屬子句 (Dependent Clause)：不能獨立存在，必須依附於獨立子句，在句中充當某個成分。<br>2. 依功能分類<br>這種分類方式主要針對從屬子句在句中所扮演的語法角色，將其分為三類：<br>名詞子句 (Nominal Clause / Noun Clause)：在句子中起名詞的作用，可作主詞、受詞、主詞補語等。<br>形容詞子句 (Adjective Clause / Relative Clause)：又稱關係子句，在句子中起形容詞的作用，用來修飾名詞或代名詞。<br>副詞子句 (Adverbial Clause / Adverb Clause)：在句子中起副詞的作用，用來修飾動詞、形容詞或副詞，表示時間、原因、條件、讓步等。"
            },
            'special-sentences': {
                title: "IV. Special Sentences 特殊句型",
                text: "Special Sentence Structures (or Sentence Types) are categories of sentences based on their function or specific arrangement of words. They include the following forms:<br>Questions (Interrogative Sentences)<br>Exclamations (Exclamatory Sentences)<br>Inverted Sentences (Sentences with Inversion)<br>Sentences using the Subjunctive Mood<br><br>特殊句型 (Special Sentence Structures)（或稱句子類型）是根據句子功能或特定詞序排列而劃分的類別。它們包括以下形式：<br>疑問句 (Questions / Interrogative Sentences)<br>感嘆句 (Exclamations / Exclamatory Sentences)<br>倒裝句 (Inverted Sentences)<br>使用虛擬語氣的句子 (Sentences using the Subjunctive Mood)"
            }
        };

        // 處理章節點擊
        function handleSectionClick(key) {
            console.log('Section clicked:', key);
            showExplanation(key);
        }

        // 顯示卡片信息
        function showCardInfo(cardType) {
            if (cardType === 'sentence-structure') {
                showStatus('Sentence Structure Diagram');
            } else if (cardType === 'grammar-concepts') {
                showStatus('Key Grammar Concepts');
            }
        }

        // Modal functionality
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const close = document.getElementById('close');

        function showExplanation(key) {
            const exp = sectionExplanations[key];
            if (exp) {
                modalTitle.textContent = exp.title;
                modalText.innerHTML = exp.text; // 使用innerHTML以支持換行
                modal.style.display = 'flex';
            } else {
                showStatus(`No explanation found for ${key}`);
            }
        }

        close.onclick = function() {
            modal.style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // 頁面加載時初始化
        window.onload = function() {
            // 加載語法點連結
            loadGrammarLinks();
            
            // 觸發初始動畫
            const ports = document.querySelectorAll('.port');
            ports.forEach((port, index) => {
                setTimeout(() => port.classList.add('animate'), index * 200);
            });
            
            console.log('Available grammar keys:', Object.keys(grammarLinks));
            console.log('SVG loaded successfully');
        };
    </script>
</body>
</html>
