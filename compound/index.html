<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±èªèªæ³•å‹•ç•« - è¤‡åˆå¥æ•™å­¸</title>
    <style>
        /* --- åŸºç¤è¨­ç½®èˆ‡é…è‰² --- */
        :root {
            --bg-color: #fdfcf8;
            --text-main: #2c3e50;
            --card-1: #e3f2fd; /* æ·ºè— Clause 1 */
            --text-1: #1565c0;
            --card-2: #e8f5e9; /* æ·ºç¶  Clause 2 */
            --text-2: #2e7d32;
            --accent: #ffab91; /* çŠç‘šè‰² Connector */
            --accent-text: #d84315;
            --semi: #b39ddb;   /* ç´«è‰² Semicolon */
            --semi-text: #5e35b1;
            --subtitle-bg: rgba(0, 0, 0, 0.85);
            --font-main: 'Segoe UI', 'Microsoft JhengHei', 'Roboto', 'Helvetica Neue', sans-serif;
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-color);
            font-family: var(--font-main);
            overflow: hidden; /* é˜²æ­¢æ»¾å‹• */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: var(--text-main);
            touch-action: manipulation;
        }

        /* --- èˆå°å®¹å™¨ (16:9) --- */
        #stage-container {
            width: 95vw;
            max-width: 1200px;
            height: 95vh;
            max-height: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* --- èƒŒæ™¯è£é£¾å…ƒç´  --- */
        .bg-circle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.3;
            z-index: 0;
        }
        .c1 { width: 300px; height: 300px; background: #fff3e0; top: -50px; right: -50px; animation: float 10s infinite ease-in-out; }
        .c2 { width: 200px; height: 200px; background: #e1f5fe; bottom: 50px; left: -50px; animation: float 12s infinite ease-in-out reverse; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(20px, 30px); }
        }

        /* --- ä¸»è¦å…§å®¹å€åŸŸ --- */
        #main-scene {
            z-index: 10;
            width: 90%;
            height: 60%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.5s ease;
            flex-wrap: wrap;
        }

        /* --- å¥å­å¡ç‰‡ --- */
        .clause {
            padding: 20px 25px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: 600;
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(20px);
            text-align: center;
        }

        .clause.simple { background-color: var(--card-1); color: var(--text-1); }
        .clause.second { background-color: var(--card-2); color: var(--text-2); }
        
        .clause.show { opacity: 1; transform: translateY(0); }

        /* --- é€£æ¥è©èˆ‡æ¨™é» --- */
        .connector-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 15px;
            opacity: 0;
            transform: scale(0);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .connector-wrapper.show { opacity: 1; transform: scale(1); }

        .comma {
            font-size: 2.5rem;
            color: var(--text-main);
            line-height: 1;
            margin-bottom: -10px; /* é è¿‘é€£æ¥è© */
            margin-right: 5px;
        }

        .conjunction {
            background-color: var(--accent);
            color: var(--accent-text);
            padding: 10px 18px;
            border-radius: 50px; /* åœ“å½¢ */
            font-weight: 800;
            font-size: 1.3rem;
            box-shadow: 0 5px 15px rgba(255, 171, 145, 0.4);
            position: relative;
        }

        .semicolon-box {
            background-color: var(--semi);
            color: var(--semi-text);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(179, 157, 219, 0.4);
            margin: 0 15px;
            opacity: 0;
            transform: scale(0) rotate(-180deg);
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .semicolon-box.show { opacity: 1; transform: scale(1) rotate(0deg); }

        /* --- æ¨™é¡Œèˆ‡æ¨™ç±¤ --- */
        #top-label {
            position: absolute;
            top: 40px;
            font-size: 1.2rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: #90a4ae;
            font-weight: 700;
            text-align: center;
            width: 100%;
            padding: 0 10px;
        }

        /* --- FANBOYS åˆ—è¡¨å±•ç¤º --- */
        #fanboys-list {
            position: absolute;
            top: 20%;
            display: flex;
            gap: 12px;
            opacity: 0;
            pointer-events: none;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }
        .fb-item {
            font-size: 1.8rem;
            font-weight: 900;
            color: #ddd;
            transition: all 0.3s;
        }
        .fb-item.active {
            color: var(--accent-text);
            transform: scale(1.5);
            text-shadow: 0 2px 10px rgba(216, 67, 21, 0.2);
        }

        /* --- å­—å¹•å€åŸŸ --- */
        #subtitle-container {
            position: absolute;
            bottom: 40px;
            width: 90%;
            text-align: center;
            background: var(--subtitle-bg);
            padding: 15px 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: opacity 0.5s;
        }

        .sub-en {
            display: block;
            color: #fff;
            font-size: 1.1rem;
            margin-bottom: 5px;
            font-weight: 500;
            line-height: 1.3;
        }
        .sub-cn {
            display: block;
            color: #cfd8dc;
            font-size: 0.9rem;
            font-weight: 300;
            line-height: 1.3;
        }

        /* --- é€²åº¦æ¢ --- */
        #progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--card-1), var(--accent), var(--card-2));
            width: 0%;
            transition: width 0.2s linear;
        }

        /* --- æ§åˆ¶æŒ‰éˆ• --- */
        .control-buttons {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            z-index: 200;
        }

        .control-btn {
            font-size: 1.3rem;
            cursor: pointer;
            background: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            user-select: none;
        }
        .control-btn:hover, .control-btn:active { 
            transform: scale(1.1); 
        }

        /* --- æš«åœè¦†è“‹å±¤ --- */
        .pause-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 150;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            padding: 20px;
            text-align: center;
        }
        .pause-overlay.active { opacity: 1; pointer-events: all; }
        .pause-overlay h2 {
            font-family: var(--font-main);
            font-size: 2.5rem;
            color: var(--text-main);
            margin-bottom: 15px;
        }

        /* --- è¼”åŠ©å‹•ç•« --- */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .highlight {
            animation: pulse 1s infinite;
            border: 3px solid var(--accent);
        }

        /* æ‰‹æ©Ÿå°è¢å¹•èª¿æ•´ */
        @media (max-width: 480px) {
            #stage-container {
                width: 98%;
                height: 98vh;
                border-radius: 15px;
            }
            
            .clause {
                padding: 15px 20px;
                font-size: 1.3rem;
            }
            
            .conjunction {
                padding: 8px 15px;
                font-size: 1.1rem;
            }
            
            .semicolon-box {
                width: 45px;
                height: 45px;
                font-size: 1.8rem;
            }
            
            .sub-en {
                font-size: 1rem;
            }
            
            .sub-cn {
                font-size: 0.8rem;
            }
            
            .fb-item {
                font-size: 1.5rem;
            }
            
            #top-label {
                font-size: 1rem;
                top: 20px;
            }
            
            .control-btn {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }
            
            .pause-overlay h2 {
                font-size: 2rem;
            }
        }

        /* æ‰‹æ©Ÿæ©«å‘æ¨¡å¼èª¿æ•´ */
        @media (max-height: 500px) and (orientation: landscape) {
            #stage-container {
                height: 98vh;
                max-height: none;
            }
            
            .clause {
                padding: 15px 20px !important;
                font-size: 1.4rem !important;
            }
            
            .sub-en {
                font-size: 1.1rem !important;
            }
            
            .sub-cn {
                font-size: 0.9rem !important;
            }
            
            #top-label {
                top: 20px !important;
                font-size: 1rem !important;
            }
        }
    </style>
</head>
<body>

    <div id="stage-container">
        <!-- æ§åˆ¶æŒ‰éˆ• -->
        <div class="control-buttons">
            <div class="control-btn pause-btn" id="pauseToggle">â¸ï¸</div>
            <div class="control-btn music-btn" id="musicToggle">ğŸ”‡</div>
        </div>
        
        <!-- æš«åœè¦†è“‹å±¤ -->
        <div class="pause-overlay" id="pauseOverlay">
            <h2>å·²æš«åœ</h2>
            <p style="font-size: 1.2rem; color: #666; margin-bottom: 30px;">é»æ“Šç¹¼çºŒæŒ‰éˆ•æˆ–æš«åœéµæ¢å¾©</p>
            <button class="control-btn" style="font-size: 1.5rem; width: 60px; height: 60px;" onclick="togglePause()">â–¶ï¸</button>
        </div>
        
        <!-- èƒŒæ™¯è£é£¾ -->
        <div class="bg-circle c1"></div>
        <div class="bg-circle c2"></div>

        <!-- é ‚éƒ¨æ¨™ç±¤ -->
        <div id="top-label"> Level 2 Compound Sentences è¤‡åˆå¥</div>

        <!-- FANBOYS å…¨å±€åˆ—è¡¨ -->
        <div id="fanboys-list">
            <span class="fb-item" id="fb-f">F</span>
            <span class="fb-item" id="fb-a">A</span>
            <span class="fb-item" id="fb-n">N</span>
            <span class="fb-item" id="fb-b">B</span>
            <span class="fb-item" id="fb-o">O</span>
            <span class="fb-item" id="fb-y">Y</span>
            <span class="fb-item" id="fb-s">S</span>
        </div>

        <!-- å‹•æ…‹å…§å®¹èˆå° -->
        <div id="main-scene">
            <!-- å…§å®¹ç”± JS å‹•æ…‹ç”Ÿæˆ -->
        </div>

        <!-- å­—å¹• -->
        <div id="subtitle-container">
            <span class="sub-en" id="sub-en">æ­¡è¿ä¾†åˆ°è‹±èªèªæ³•èª²å ‚ã€‚</span>
            <span class="sub-cn" id="sub-cn">Welcome to English Grammar.</span>
        </div>

        <!-- é€²åº¦æ¢ -->
        <div id="progress-bar"></div>
    </div>

    <script>
        /* --- éŸ³æ•ˆç³»çµ± --- */
        const AudioSys = {
            ctx: null,
            muted: true,
            
            init() {
                // å»¶é²åˆå§‹åŒ–éŸ³é »ä¸Šä¸‹æ–‡ï¼Œé¿å…iOSé™åˆ¶
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
            },
            
            toggle() {
                if (!this.ctx) this.init();
                
                this.muted = !this.muted;
                if(!this.muted) {
                    this.ctx.resume();
                } else {
                    this.ctx.suspend();
                }
                return this.muted;
            },

            playSound(type) {
                if (this.muted || !this.ctx) return;
                
                const osc = this.ctx.createOscillator();
                const gainNode = this.ctx.createGain();
                
                osc.connect(gainNode);
                gainNode.connect(this.ctx.destination);
                
                const now = this.ctx.currentTime;

                if (type === 'pop') {
                    // æ°£æ³¡å½ˆå‡ºè²
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, now);
                    osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
                    gainNode.gain.setValueAtTime(0.3, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                    osc.start(now);
                    osc.stop(now + 0.1);
                } else if (type === 'snap') {
                    // æ‹¼æ¥è²
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(200, now);
                    osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                    gainNode.gain.setValueAtTime(0.5, now);
                    gainNode.gain.linearRampToValueAtTime(0.01, now + 0.15);
                    osc.start(now);
                    osc.stop(now + 0.15);
                } else if (type === 'magic') {
                    // é­”æ³•éŸ³æ•ˆ
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(300, now);
                    osc.frequency.linearRampToValueAtTime(1200, now + 0.5);
                    gainNode.gain.setValueAtTime(0.1, now);
                    gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
                    osc.start(now);
                    osc.stop(now + 0.5);
                } else if (type === 'whoosh') {
                    // æ»‘å‹•è²
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(100, now);
                    gainNode.gain.setValueAtTime(0.05, now);
                    gainNode.gain.linearRampToValueAtTime(0, now + 0.2);
                    osc.start(now);
                    osc.stop(now + 0.2);
                }
            }
        };

        /* --- æš«åœç³»çµ± --- */
        let isPaused = false;
        let pauseResolve = null;
        let pausePromise = null;

        function togglePause() {
            isPaused = !isPaused;
            
            if (isPaused) {
                // æš«åœç‹€æ…‹
                document.getElementById('pauseOverlay').classList.add('active');
                document.getElementById('pauseToggle').innerHTML = 'â–¶ï¸';
                
                // æš«åœéŸ³æ•ˆ
                if (AudioSys.ctx) {
                    AudioSys.ctx.suspend();
                }
                
                // å‰µå»ºä¸€å€‹Promiseï¼Œç•¶æ¢å¾©æ™‚è§£æ±ºå®ƒ
                pausePromise = new Promise(resolve => {
                    pauseResolve = resolve;
                });
            } else {
                // æ¢å¾©ç‹€æ…‹
                document.getElementById('pauseOverlay').classList.remove('active');
                document.getElementById('pauseToggle').innerHTML = 'â¸ï¸';
                
                // æ¢å¾©éŸ³æ•ˆ
                if (!AudioSys.muted && AudioSys.ctx) {
                    AudioSys.ctx.resume();
                }
                
                // è§£æ±ºPromiseï¼Œè®“ç­‰å¾…çš„å‹•ç•«ç¹¼çºŒ
                if (pauseResolve) {
                    pauseResolve();
                    pauseResolve = null;
                }
            }
        }

        // ä¿®æ”¹sleepå‡½æ•¸ä»¥æ”¯æŒæš«åœ
        async function sleep(ms) {
            const start = Date.now();
            let elapsed = 0;
            
            while (elapsed < ms) {
                if (isPaused) {
                    await pausePromise;
                    // é‡æ–°è¨ˆç®—å‰©é¤˜æ™‚é–“
                    elapsed = Date.now() - start;
                } else {
                    const remaining = ms - elapsed;
                    await new Promise(r => setTimeout(r, Math.min(100, remaining)));
                    elapsed = Date.now() - start;
                }
            }
        }

        /* --- å‹•ç•«æ§åˆ¶é‚è¼¯ --- */
        const scene = document.getElementById('main-scene');
        const subEn = document.getElementById('sub-en');
        const subCn = document.getElementById('sub-cn');
        const progressBar = document.getElementById('progress-bar');
        const fanboysList = document.getElementById('fanboys-list');
        const topLabel = document.getElementById('top-label');

        // è¼”åŠ©å‡½æ•¸ï¼šæ¸…ç©ºèˆå°
        function clearStage() {
            scene.innerHTML = '';
        }

        // è¼”åŠ©å‡½æ•¸ï¼šå‰µå»ºç°¡å–®å¥å¡ç‰‡
        function createClause(text, type = 'simple') {
            const el = document.createElement('div');
            el.className = `clause ${type}`;
            el.innerText = text;
            return el;
        }

        // è¼”åŠ©å‡½æ•¸ï¼šå‰µå»ºé€£æ¥è©çµæ§‹ (é€—è™Ÿ + è©)
        function createConnector(word) {
            const wrapper = document.createElement('div');
            wrapper.className = 'connector-wrapper';
            
            // é€—è™Ÿæ˜¯å¿…é ˆçš„
            const comma = document.createElement('div');
            comma.className = 'comma';
            comma.innerText = ',';
            
            const conj = document.createElement('div');
            conj.className = 'conjunction';
            conj.innerText = word;

            wrapper.appendChild(comma);
            wrapper.appendChild(conj);
            return wrapper;
        }

        // è¼”åŠ©å‡½æ•¸ï¼šå‰µå»ºåˆ†è™Ÿ
        function createSemicolon() {
            const el = document.createElement('div');
            el.className = 'semicolon-box';
            el.innerText = ';';
            return el;
        }

        // è¼”åŠ©å‡½æ•¸ï¼šæ›´æ–°å­—å¹•
        function setSubtitle(en, cn) {
            subEn.style.opacity = 0;
            subCn.style.opacity = 0;
            setTimeout(() => {
                subEn.innerText = en;
                subCn.innerText = cn;
                subEn.style.opacity = 1;
                subCn.style.opacity = 1;
            }, 300);
        }

        // è¼”åŠ©å‡½æ•¸ï¼šé«˜äº® FANBOYS åˆ—è¡¨ä¸­çš„å­—æ¯
        function highlightFanboy(letter) {
            document.querySelectorAll('.fb-item').forEach(el => el.classList.remove('active'));
            if(letter) {
                const target = document.getElementById(`fb-${letter.toLowerCase()}`);
                if(target) target.classList.add('active');
            }
        }

        /* --- åŠ‡æœ¬å®šç¾© (Timeline) --- */
        const script = [
            {
                // 0: ä»‹ç´¹
                duration: 4000,
                action: async () => {
                    topLabel.innerText = "Level 1: ç°¡å–®å¥";
                    clearStage();
                    const c1 = createClause("æˆ‘å–œæ­¡è˜‹æœã€‚");
                    scene.appendChild(c1);
                    await sleep(500);
                    c1.classList.add('show'); 
                    AudioSys.playSound('pop');
                    setSubtitle("Level 1: ç°¡å–®å¥ã€‚", "Level 1: The Simple Sentence. ä¸€å€‹å®Œæ•´çš„ä¸»èªåŠ è¬‚èªã€‚");
                }
            },
            {
                // 1: å•é¡Œå¼•å…¥ (é€£å¯«å¥)
                duration: 5000,
                action: async () => {
                    topLabel.innerText = "å•é¡Œæ‰€åœ¨";
                    const c1 = scene.querySelector('.clause'); // ä¿ç•™ç¾æœ‰å¥å­
                    const c2 = createClause("ä½ å–œæ­¡é¦™è•‰ã€‚", "second");
                    scene.appendChild(c2);
                    
                    setSubtitle("ä½†å¦‚æœæˆ‘å€‘æƒ³é€£æ¥å…©å€‹æƒ³æ³•æ€éº¼è¾¦ï¼Ÿ", "But what if we want to connect two ideas?");
                    
                    await sleep(1000);
                    c2.classList.add('show'); 
                    AudioSys.playSound('pop');
                    
                    // ç¢°æ’å‹•ç•«
                    await sleep(1000);
                    c1.style.transform = "translateX(20px)";
                    c2.style.transform = "translateX(-20px)";
                    await sleep(200);
                    c1.style.transform = "translateX(0)";
                    c2.style.transform = "translateX(0)";
                }
            },
            {
                // 2: ä»‹ç´¹ Level 2
                duration: 4000,
                action: () => {
                    topLabel.innerText = "Level 2: è¤‡åˆå¥";
                    scene.innerHTML = ''; // æ¸…é™¤æ‰€æœ‰
                    fanboysList.style.opacity = 1; // é¡¯ç¤º FANBOYS åˆ—è¡¨
                    setSubtitle("æ­¡è¿ä¾†åˆ° Level 2ï¼šè¤‡åˆå¥ã€‚", "Welcome to Level 2: Compound Sentences. æˆ‘å€‘éœ€è¦è† æ°´ã€‚");
                    AudioSys.playSound('magic');
                }
            },
            {
                // 3: FANBOYS ä»‹ç´¹
                duration: 4000,
                action: async () => {
                    setSubtitle("æˆ‘å€‘ä½¿ç”¨ 'FANBOYS' ä¾†è¨˜ä½é€™äº›é€£æ¥è©ã€‚", "We use 'FANBOYS' to remember the connectors.");
                    // ä¾æ¬¡é«˜äº®
                    const letters = ['f','a','n','b','o','y','s'];
                    for (let i = 0; i < letters.length; i++) {
                        await sleep(400);
                        highlightFanboy(letters[i]);
                        AudioSys.playSound('pop');
                    }
                }
            },
            // --- ç¯„ä¾‹ ---
            {
                // 4: For
                duration: 5000,
                action: async () => {
                    fanboysList.style.opacity = 0.2; // æ·¡åŒ–åˆ—è¡¨
                    highlightFanboy('f');
                    clearStage();
                    
                    const c1 = createClause("æˆ‘å–äº†æ°´");
                    const c2 = createClause("æˆ‘å£æ¸´äº†", "second");
                    const glue = createConnector("å› ç‚º"); // for = because
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    await sleep(100);
                    c1.classList.add('show'); 
                    AudioSys.playSound('whoosh');
                    
                    await sleep(900);
                    glue.classList.add('show'); 
                    AudioSys.playSound('snap');
                    
                    await sleep(1000);
                    c2.classList.add('show'); 
                    AudioSys.playSound('whoosh');

                    setSubtitle("'For' è§£é‡‹åŸå› ï¼ˆåƒ because ä¸€æ¨£ï¼‰ã€‚", "'For' explains a reason. (Like 'because') æ³¨æ„å‰é¢çš„é€—è™Ÿï¼");
                }
            },
            {
                // 5: And
                duration: 4500,
                action: async () => {
                    highlightFanboy('a');
                    clearStage();
                    
                    const c1 = createClause("æˆ‘å‘å·¦èµ°");
                    const c2 = createClause("ä½ å‘å³èµ°", "second");
                    const glue = createConnector("å’Œ");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    await sleep(100);
                    c1.classList.add('show'); 
                    AudioSys.playSound('whoosh');
                    
                    await sleep(700);
                    glue.classList.add('show'); 
                    AudioSys.playSound('snap');
                    
                    await sleep(800);
                    c2.classList.add('show'); 
                    AudioSys.playSound('whoosh');

                    setSubtitle("'And' å°‡ä¸€å€‹æƒ³æ³•åŠ åˆ°å¦ä¸€å€‹æƒ³æ³•ä¸Šã€‚", "'And' adds one idea to another.");
                }
            },
            {
                // 6: Nor
                duration: 5000,
                action: async () => {
                    highlightFanboy('n');
                    clearStage();
                    
                    const c1 = createClause("æˆ‘ä¸å”±æ­Œ");
                    const c2 = createClause("æˆ‘ä¹Ÿä¸è·³èˆ", "second"); // å€’è£å¥
                    const glue = createConnector("ä¹Ÿä¸");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    await sleep(100);
                    c1.classList.add('show'); 
                    AudioSys.playSound('whoosh');
                    
                    await sleep(700);
                    glue.classList.add('show'); 
                    AudioSys.playSound('snap');
                    
                    await sleep(800);
                    c2.classList.add('show'); 
                    AudioSys.playSound('whoosh');

                    setSubtitle("'Nor' ç”¨æ–¼å¦å®šçš„è£œå……ï¼ˆæˆ‘ä¹Ÿä¸æœƒè·³èˆï¼‰ã€‚", "'Nor' is for negative additions.");
                }
            },
            {
                // 7: But
                duration: 4500,
                action: async () => {
                    highlightFanboy('b');
                    clearStage();
                    
                    const c1 = createClause("æˆ‘æ‘”å€’äº†");
                    const c2 = createClause("æˆ‘æ²’æœ‰å“­", "second");
                    const glue = createConnector("ä½†æ˜¯");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    await sleep(100);
                    c1.classList.add('show'); 
                    AudioSys.playSound('whoosh');
                    
                    await sleep(700);
                    glue.classList.add('show'); 
                    AudioSys.playSound('snap');
                    
                    await sleep(800);
                    c2.classList.add('show'); 
                    AudioSys.playSound('whoosh');

                    setSubtitle("'But' è¡¨ç¤ºè½‰æŠ˜æˆ–å°æ¯”ã€‚", "'But' shows contrast.");
                }
            },
            {
                // 8: Or
                duration: 4500,
                action: async () => {
                    highlightFanboy('o');
                    clearStage();
                    
                    const c1 = createClause("æˆ‘å€‘å¯ä»¥åƒæŠ«è–©");
                    const c2 = createClause("æˆ‘å€‘å¯ä»¥åƒå¡”å¯", "second");
                    const glue = createConnector("æˆ–è€…");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    await sleep(100);
                    c1.classList.add('show'); 
                    AudioSys.playSound('whoosh');
                    
                    await sleep(700);
                    glue.classList.add('show'); 
                    AudioSys.playSound('snap');
                    
                    await sleep(800);
                    c2.classList.add('show'); 
                    AudioSys.playSound('whoosh');

                    setSubtitle("'Or' æå‡ºä¸€ç¨®é¸æ“‡ã€‚", "'Or' presents a choice.");
                }
            },
            {
                // 9: Yet
                duration: 5000,
                action: async () => {
                    highlightFanboy('y');
                    clearStage();
                    
                    const c1 = createClause("æ­£åœ¨ä¸‹é›¨");
                    const c2 = createClause("å¤©æ°£å¾ˆç†±", "second");
                    const glue = createConnector("ç„¶è€Œ");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    await sleep(100);
                    c1.classList.add('show'); 
                    AudioSys.playSound('whoosh');
                    
                    await sleep(700);
                    glue.classList.add('show'); 
                    AudioSys.playSound('snap');
                    
                    await sleep(800);
                    c2.classList.add('show'); 
                    AudioSys.playSound('whoosh');

                    setSubtitle("'Yet' åƒ 'but'ï¼Œç”¨æ–¼æ„æƒ³ä¸åˆ°çš„è½‰æŠ˜ã€‚", "'Yet' is like 'but', for unexpected results.");
                }
            },
            {
                // 10: So
                duration: 4500,
                action: async () => {
                    highlightFanboy('s');
                    clearStage();
                    
                    const c1 = createClause("æˆ‘å¾ˆç´¯");
                    const c2 = createClause("æˆ‘å»ç¡è¦ºäº†", "second");
                    const glue = createConnector("æ‰€ä»¥");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    await sleep(100);
                    c1.classList.add('show'); 
                    AudioSys.playSound('whoosh');
                    
                    await sleep(700);
                    glue.classList.add('show'); 
                    AudioSys.playSound('snap');
                    
                    await sleep(800);
                    c2.classList.add('show'); 
                    AudioSys.playSound('whoosh');

                    setSubtitle("'So' è¡¨ç¤ºçµæœã€‚", "'So' shows a result.");
                }
            },
            // --- åˆ†è™Ÿ ---
            {
                // 11: åˆ†è™Ÿä»‹ç´¹
                duration: 5000,
                action: async () => {
                    highlightFanboy(null); // æ¸…é™¤é«˜äº®
                    fanboysList.style.opacity = 0; // éš±è— FANBOYS
                    
                    // ä¿ç•™å‰ä¸€å¥å­ä½†ç§»é™¤é€£æ¥è©
                    const glue = scene.querySelector('.connector-wrapper');
                    if(glue) glue.style.transform = 'scale(0)'; // ç¸®å°è† æ°´
                    
                    await sleep(500);
                    if(glue) glue.remove();
                    // æ·»åŠ åˆ†è™Ÿ
                    const semi = createSemicolon();
                    // æ’å…¥å­å¥ä¹‹é–“
                    const c2 = scene.querySelector('.clause.second');
                    scene.insertBefore(semi, c2);
                    
                    await sleep(100);
                    semi.classList.add('show');
                    AudioSys.playSound('magic');

                    setSubtitle("æˆ–è€…â€¦â€¦ä½¿ç”¨åˆ†è™Ÿï¼ˆ;ï¼‰ã€‚ä¸éœ€è¦ä»»ä½•é€£æ¥è©ï¼", "Or... use the Semicolon (;). No glue needed!");
                }
            },
            {
                // 12: åˆ†è™Ÿç¯„ä¾‹ 2
                duration: 5000,
                action: async () => {
                    clearStage();
                    const c1 = createClause("æˆ‘å–œæ­¡ç·¨ç¨‹");
                    const semi = createSemicolon();
                    const c2 = createClause("å®ƒå¾ˆæœ‰è¶£", "second");
                    
                    scene.appendChild(c1);
                    scene.appendChild(semi);
                    scene.appendChild(c2);

                    await sleep(100);
                    c1.classList.add('show'); 
                    AudioSys.playSound('pop');
                    
                    await sleep(700);
                    semi.classList.add('show'); 
                    AudioSys.playSound('magic');
                    
                    await sleep(700);
                    c2.classList.add('show'); 
                    AudioSys.playSound('pop');

                    setSubtitle("åˆ†è™Ÿé€£æ¥å…©å€‹é—œä¿‚éå¸¸ç·Šå¯†çš„å¥å­ã€‚", "The semicolon connects two closely related sentences.");
                }
            },
            // --- ç¸½çµ ---
            {
                // 13: ç¸½çµ
                duration: 6000,
                action: () => {
                    clearStage();
                    topLabel.innerText = "ç¸½çµ";
                    
                    const box = document.createElement('div');
                    box.style.textAlign = 'center';
                    box.innerHTML = `
                        <h2 style="color:var(--text-1); margin-bottom:10px;">è¤‡åˆå¥</h2>
                        <div style="font-size:1.5rem; color:#555;">å­å¥ 1 <span style="color:var(--accent-text)">, FANBOYS</span> å­å¥ 2</div>
                        <div style="font-size:1.5rem; color:#555; margin-top:10px;">å­å¥ 1 <span style="color:var(--semi-text)">;</span> å­å¥ 2</div>
                    `;
                    scene.appendChild(box);
                    
                    setSubtitle("æ­å–œï¼ä½ å·²ç¶“æŒæ¡äº† Level 2 è¤‡åˆå¥ã€‚", "Congratulations! You mastered Level 2.");
                    AudioSys.playSound('magic');
                }
            }
        ];

        /* --- æ’­æ”¾å¼•æ“ --- */
        let currentStep = 0;
        let totalDuration = script.reduce((acc, cur) => acc + cur.duration, 0);
        let elapsed = 0;
        let progressInterval;

        async function playScene() {
            if (currentStep >= script.length) {
                return;
            }

            const step = script[currentStep];
            await step.action();

            // é€²åº¦æ¢é‚è¼¯
            let stepElapsed = 0;
            progressInterval = setInterval(() => {
                if (!isPaused) {
                    stepElapsed += 100;
                    elapsed += 100;
                    const pct = Math.min((elapsed / totalDuration) * 100, 100);
                    progressBar.style.width = `${pct}%`;
                    
                    if (elapsed >= totalDuration) clearInterval(progressInterval);
                }
            }, 100);

            await sleep(step.duration);
            clearInterval(progressInterval);
            currentStep++;
            playScene();
        }

        // çŸ­æš«å»¶é²å¾Œé–‹å§‹ï¼Œç¢ºä¿ DOM æº–å‚™å°±ç·’
        setTimeout(() => {
            playScene();
            
            // å¦‚æœç”¨æˆ¶æ²’æœ‰åˆ‡æ›ï¼Œé»˜èªå–æ¶ˆéœéŸ³
            if(AudioSys.muted) {
                AudioSys.toggle();
                document.getElementById('musicToggle').innerText = "ğŸ”Š";
            }
        }, 1000);

        // --- åˆå§‹åŒ–æ§åˆ¶æŒ‰éˆ• ---
        document.getElementById('musicToggle').onclick = () => {
            const isMuted = AudioSys.toggle();
            document.getElementById('musicToggle').innerText = isMuted ? "ğŸ”‡" : "ğŸ”Š";
        };

        // ç¶å®šæš«åœæŒ‰éˆ•äº‹ä»¶
        document.getElementById('pauseToggle').onclick = togglePause;

        // é˜²æ­¢æ‰‹æ©Ÿä¸Šçš„é›™æ“Šç¸®æ”¾
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

    </script>
</body>
</html>
