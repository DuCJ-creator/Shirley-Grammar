<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shirley's Preposition Adventure | ä»‹ä¿‚è©æ¢éšª</title>
    <style>
        :root {
            /* æŸ”å’Œä¸”ç¾ä»£çš„é…è‰² */
            --primary: #8E7CC3;       /* ç´«è‰²ä¸»èª¿ */
            --primary-dark: #674EA7;
            --secondary: #D9D2E9;     /* æ·ºç´«è¼”åŠ© */
            --accent: #F4A261;        /* æ´»åŠ›æ©˜ */
            --bg-gradient-start: #FDFBF7;
            --bg-gradient-end: #E6E2D3;
            --text-main: #434343;
            --text-light: #666666;
            --success: #93C47D;
            --error: #E06666;
            --info: #6FA8DC;
            --phrasal: #FFE599;       /* ç‰‡èªå‹•è©å°ˆç”¨è‰² */
            
            /* UI è®Šæ•¸ */
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 8px;
            --shadow-card: 0 10px 40px rgba(142, 124, 195, 0.15);
            --shadow-float: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Nunito', 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            color: var(--text-main);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px); /* æ¯›ç»ç’ƒæ•ˆæœ */
            -webkit-backdrop-filter: blur(12px);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }
        
        /* ===== Header ===== */
        header {
            background: linear-gradient(120deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 15px rgba(103, 78, 167, 0.2);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .header-btn {
            position: absolute;
            top: 25px;
            background: rgba(255, 255, 255, 0.25);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .header-btn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }
        
        #languageToggle { right: 20px; }
        #volumeToggle { left: 20px; }
        
        /* ===== Main Layout ===== */
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            padding: 30px;
        }
        
        /* ===== Animation Section ===== */
        .animation-section {
            flex: 1.2;
            min-width: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .animation-container {
            width: 100%;
            height: 320px;
            background: white;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.05);
            border: 2px solid var(--secondary);
        }
        
        canvas {
            width: 100%;
            height: 100%;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        /* é€šç”¨æŒ‰éˆ•æ¨£å¼ */
        .btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 700;
            box-shadow: 0 4px 6px rgba(142, 124, 195, 0.3);
            font-size: 0.95rem;
        }
        
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(142, 124, 195, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-outline {
            background-color: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        .btn-outline:hover {
            background-color: var(--secondary);
            color: var(--primary-dark);
        }

        /* ä»‹ä¿‚è©é¸æ“‡æŒ‰éˆ•å€ */
        .preposition-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-top: 5px;
        }
        
        .prep-tag {
            background-color: var(--info);
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .prep-tag:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }
        
        .prep-tag.phrasal {
            background-color: var(--phrasal);
            color: #5b4d2e;
            font-weight: bold;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 8px;
            background-color: #eee;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            width: 0%;
            transition: width 0.1s linear;
        }
        
        /* ===== Info Section & Tabs ===== */
        .info-section {
            flex: 1;
            min-width: 320px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: var(--radius-md);
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.5);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
            /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        .tabs::-webkit-scrollbar { display: none; }
        
        .tab {
            padding: 8px 18px;
            cursor: pointer;
            background: transparent;
            border: 2px solid transparent;
            color: var(--text-light);
            font-weight: 700;
            border-radius: 20px;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: var(--primary);
            background: rgba(142, 124, 195, 0.1);
        }
        
        .tab.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(142, 124, 195, 0.3);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* å…§å®¹å¡ç‰‡æ¨£å¼ */
        .example {
            margin: 15px 0;
            padding: 18px;
            background-color: white;
            border-radius: var(--radius-md);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.03);
            border-left: 5px solid var(--primary);
            transition: transform 0.2s;
        }
        
        .example:hover {
            transform: translateX(5px);
        }
        
        .example h3 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .level {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .beginner { background-color: var(--success); color: white; }
        .intermediate { background-color: var(--accent); color: white; }
        
        .phrase-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .phrase-item {
            padding: 10px;
            background-color: #fcfcfc;
            border: 1px solid #eee;
            border-radius: 10px;
            font-size: 0.9rem;
            text-align: center;
            transition: all 0.2s;
        }
        
        .phrase-item:hover {
            border-color: var(--primary);
            background-color: #fbf9ff;
        }
        
        .phrase-item strong {
            color: var(--primary-dark);
            display: block;
            margin-bottom: 4px;
        }
        
        /* ===== Bonus Card (Special Style) ===== */
        .bonus-card {
            border: none;
            background: linear-gradient(135deg, #FFF7E6 0%, #FFFDF5 100%);
            border-left: 6px solid var(--accent);
            position: relative;
            overflow: hidden;
        }
        
        .bonus-card::after {
            content: 'ğŸ';
            position: absolute;
            right: -10px;
            bottom: -10px;
            font-size: 5rem;
            opacity: 0.1;
            transform: rotate(-20deg);
        }
        
        .bonus-title {
            color: #D35400;
            font-weight: 800;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        
        .bonus-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        /* ===== Quiz Section ===== */
        .quiz-section {
            width: 100%;
            padding: 30px;
            background: white;
            border-radius: var(--radius-lg);
            margin-top: 10px;
            text-align: center;
            position: relative;
        }
        
        .quiz-container { display: none; max-width: 600px; margin: 0 auto; }
        .quiz-container.active { display: block; }
        
        .question {
            font-size: 1.4rem;
            margin: 20px 0 30px;
            font-weight: 700;
            color: var(--text-main);
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .option {
            padding: 15px;
            background: white;
            border: 2px solid #eee;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-light);
        }
        
        .option:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: #fbf9ff;
        }
        
        .option.correct {
            background-color: var(--success);
            border-color: var(--success);
            color: white;
            animation: pulse 0.5s;
        }
        
        .option.incorrect {
            background-color: var(--error);
            border-color: var(--error);
            color: white;
            animation: shake 0.4s;
        }
        
        .quiz-result { display: none; }
        .quiz-result.active { display: block; animation: popIn 0.5s; }
        
        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0 auto 20px;
            box-shadow: 0 10px 20px rgba(142, 124, 195, 0.4);
        }
        
        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-light);
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* RWD */
        @media (max-width: 768px) {
            .main-content { flex-direction: column; padding: 15px; }
            .options { grid-template-columns: 1fr; }
            h1 { font-size: 1.8rem; }
            .header-btn span { display: none; } /* æ‰‹æ©Ÿç‰ˆéš±è—æŒ‰éˆ•æ–‡å­—åªç•™åœ–ç¤º */
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="header-btn" id="volumeToggle">
                <span class="icon">ğŸ”Š</span> <span>éŸ³æ•ˆ</span>
            </button>
            <h1>Shirley's Preposition Adventure</h1>
            <div class="subtitle">è·Ÿè‘— Shirley ä¸€èµ·æ¢ç´¢ä»‹ä¿‚è©çš„å¥§ç§˜</div>
            <button class="header-btn" id="languageToggle">
                <span>EN/ä¸­æ–‡</span> <span class="icon">ğŸŒ</span>
            </button>
        </header>
        
        <div class="main-content">
            <section class="animation-section">
                <div class="animation-container" id="animationContainer">
                    <canvas id="prepositionCanvas"></canvas>
                </div>
                
                <div class="controls">
                    <button class="btn" id="playBtn">â–¶ æ’­æ”¾</button>
                    <button class="btn btn-outline" id="pauseBtn">â¸ æš«åœ</button>
                    <button class="btn btn-outline" id="resetBtn">â†º é‡ç½®</button>
                </div>
                
                <div class="preposition-buttons" id="prepositionButtons">
                    </div>
                
                <div class="progress-bar-container">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
            </section>
            
            <section class="info-section">
                <div class="tabs">
                    <div class="tab active" data-tab="intro">ä»‹ç´¹</div>
                    <div class="tab" data-tab="basic">åŸºç¤ä»‹ä¿‚è©</div>
                    <div class="tab" data-tab="phrasal">Phrasal Verbs</div>
                    <div class="tab" data-tab="bonus">ğŸ Bonus</div>
                </div>
                
                <div class="tab-content active" id="intro">
                    <h2>ä»‹ä¿‚è©æ˜¯ä»€éº¼ï¼Ÿ</h2>
                    <p style="margin-bottom: 15px; color: #666;">Prepositions show the relationship between words.</p>
                    <div class="example">
                        <span class="level beginner">è§€å¿µ</span>
                        <p>ä»‹ä¿‚è©é€šå¸¸ç”¨ä¾†è¡¨ç¤ºï¼š</p>
                        <ul style="margin-left: 20px; margin-top: 5px; color: #555;">
                            <li>ğŸ“ <strong>ä½ç½® (Place)</strong>: in, on, at</li>
                            <li>â° <strong>æ™‚é–“ (Time)</strong>: in, on, at</li>
                            <li>â¡ï¸ <strong>æ–¹å‘ (Direction)</strong>: into, towards</li>
                        </ul>
                    </div>
                </div>
                
                <div class="tab-content" id="basic">
                    <h2>ç©ºé–“èˆ‡ä½ç½®</h2>
                    <div class="example">
                        <h3>IN (åœ¨...è£¡é¢)</h3>
                        <p>æƒ³åƒä¸€å€‹<strong>å®¹å™¨</strong>æˆ–<strong>å°é–‰ç©ºé–“</strong>ã€‚</p>
                        <p class="phrase-item">ğŸ“¦ The cat is <strong>in</strong> the box.</p>
                    </div>
                    <div class="example">
                        <h3>ON (åœ¨...ä¸Šé¢)</h3>
                        <p>æ¥è§¸åˆ°ç‰©é«”çš„<strong>è¡¨é¢</strong>ã€‚</p>
                        <p class="phrase-item">ğŸ The apple is <strong>on</strong> the table.</p>
                    </div>
                    <div class="example">
                        <h3>AT (åœ¨...é»)</h3>
                        <p>æŒ‡ä¸€å€‹ç‰¹å®šçš„<strong>åœ°é»</strong>æˆ–<strong>æ™‚åˆ»</strong>ã€‚</p>
                        <p class="phrase-item">ğŸš Let's meet <strong>at</strong> the bus stop.</p>
                    </div>
                </div>
                
                <div class="tab-content" id="phrasal">
                    <h2>Phrasal Verbs (å‹•è©ç‰‡èª)</h2>
                    <p>å‹•è© + ä»‹ä¿‚è© = å…¨æ–°çš„æ„æ€ï¼</p>
                    
                    <div class="example">
                        <h3>Turn (è½‰è®Š)</h3>
                        <div class="phrase-list">
                            <div class="phrase-item"><strong>Turn in</strong><br>ğŸ›Œ ä¸Šäº¤ï¼›å°±å¯¢</div>
                            <div class="phrase-item"><strong>Turn on</strong><br>ğŸ’¡ æ‰“é–‹é›»æº</div>
                            <div class="phrase-item"><strong>Turn off</strong><br>ğŸ“´ é—œé–‰é›»æº</div>
                            <div class="phrase-item"><strong>Turn up</strong><br>ğŸ”Š èª¿å¤§ï¼›å‡ºç¾</div>
                        </div>
                    </div>
                    
                    <div class="example">
                        <h3>Give (çµ¦äºˆ)</h3>
                        <div class="phrase-list">
                            <div class="phrase-item"><strong>Give up</strong><br>ğŸ³ï¸ æ”¾æ£„</div>
                            <div class="phrase-item"><strong>Give in</strong><br>ğŸ™‡ å±ˆæœ</div>
                            <div class="phrase-item"><strong>Give away</strong><br>ğŸ è´ˆé€</div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="bonus">
                    <div class="example bonus-card">
                        <div class="bonus-title">ğŸš€ å­¸ç¿’è³‡æºå¤§ç¦®åŒ…</div>
                        <p style="margin-bottom: 10px;">è¦ºå¾—æ„çŒ¶æœªç›¡å—ï¼ŸShirley è€å¸«æº–å‚™äº†æ›´å¤šäº’å‹•å¼å¡ç‰‡ç·´ç¿’ï¼Œå¹«åŠ©ä½ æ›´å¿«é€Ÿè¨˜æ†¶ï¼</p>
                        <div class="bonus-actions">
                            <a class="btn" href="https://ducj-creator.github.io/Shirley-Grammar/phrases" target="_blank">
                                ğŸ® é–‹å§‹äº’å‹•ç·´ç¿’
                            </a>
                            <a class="btn btn-outline" href="https://ducj-creator.github.io/Shirley-Grammar/phrases" target="_blank">
                                ğŸ”— åˆ†äº«é€£çµ
                            </a>
                        </div>
                    </div>
                    <div class="example">
                        <h3>å¸¸ç”¨æ­é…è© (Collocations)</h3>
                        <div class="phrase-list">
                            <div class="phrase-item"><strong>Interested in</strong><br>æ„Ÿèˆˆè¶£</div>
                            <div class="phrase-item"><strong>Good at</strong><br>æ“…é•·</div>
                            <div class="phrase-item"><strong>Afraid of</strong><br>å®³æ€•</div>
                            <div class="phrase-item"><strong>Listen to</strong><br>è†è½</div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <div class="quiz-section">
            <h2>ğŸ§  æ¸¬é©—æ™‚é–“ (Quiz Time)</h2>
            <p style="margin-bottom: 20px; color: #666;">æ¸¬è©¦ä½ å°ä»‹ä¿‚è©çš„ç›´è¦ºï¼</p>
            <button class="btn" id="startQuiz">ğŸš€ é–‹å§‹æ¸¬é©—</button>
            
            <div class="quiz-container" id="quizContainer">
                <div class="question" id="question"></div>
                <div class="options" id="options"></div>
            </div>
            
            <div class="quiz-result" id="quizResult">
                <div class="score-circle" id="score"></div>
                <h3 id="resultMessage" style="font-size: 1.5rem; margin-bottom: 15px;"></h3>
                <button class="btn" id="restartQuiz">ğŸ”„ å†è©¦ä¸€æ¬¡</button>
            </div>
        </div>
        
        <footer>
            <p>Made with â¤ï¸ for English Learners</p>
            <p>Â© 2025 Shirley's Grammar Adventure</p>
        </footer>
    </div>

    <script>
        // === éŸ³æ•ˆç³»çµ± (Web Audio API) ===
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();
        let isSoundEnabled = true;

        function playTone(freq, type, duration) {
            if (!isSoundEnabled) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function playSound(effect) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            switch(effect) {
                case 'correct': playTone(880, 'sine', 0.5); playTone(1100, 'sine', 0.5); break;
                case 'incorrect': playTone(200, 'sawtooth', 0.3); break;
                case 'click': playTone(400, 'triangle', 0.1); break;
                case 'transition': playTone(600, 'sine', 0.2); break;
                case 'win': 
                    [523, 659, 783, 1046].forEach((f, i) => setTimeout(() => playTone(f, 'sine', 0.3), i*100));
                    break;
            }
        }

        // === UI æ§åˆ¶ ===
        document.getElementById('volumeToggle').addEventListener('click', function() {
            isSoundEnabled = !isSoundEnabled;
            this.innerHTML = isSoundEnabled ? '<span class="icon">ğŸ”Š</span> <span>éŸ³æ•ˆ</span>' : '<span class="icon">ğŸ”‡</span> <span>éœéŸ³</span>';
        });

        document.getElementById('languageToggle').addEventListener('click', function() {
            const span = this.querySelector('span:first-child');
            span.textContent = span.textContent === 'EN/ä¸­æ–‡' ? 'ä¸­/English' : 'EN/ä¸­æ–‡';
            playSound('click');
        });

        // Tabs åˆ‡æ›
        const tabs = document.querySelectorAll('.tab');
        const contents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                contents.forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
                playSound('click');
            });
        });

        // === Canvas å‹•ç•«ç³»çµ± (Emoji Enhanced) ===
        const canvas = document.getElementById('prepositionCanvas');
        const ctx = canvas.getContext('2d');
        const animationContainer = document.getElementById('animationContainer');
        
        let canvasWidth, canvasHeight;
        function resizeCanvas() {
            canvasWidth = animationContainer.clientWidth;
            canvasHeight = animationContainer.clientHeight;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            drawScene(); // é‡ç¹ªç•¶å‰å ´æ™¯
        }
        window.addEventListener('resize', resizeCanvas);
        
        // ç¹ªåœ–è¼”åŠ©å‡½æ•¸
        function drawEmoji(emoji, x, y, size) {
            ctx.font = `${size}px Arial`;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(emoji, x, y);
        }

        function drawText(text, subtext) {
            ctx.fillStyle = "#434343";
            ctx.font = "bold 24px Nunito";
            ctx.textAlign = "left";
            ctx.fillText(text, 20, 40);
            
            ctx.fillStyle = "#666";
            ctx.font = "18px Microsoft JhengHei";
            ctx.fillText(subtext, 20, canvasHeight - 20);
        }

        // å ´æ™¯å®šç¾©
        const scenes = [
            {
                id: 'in', title: "IN", text: "The cat is IN the box.", trans: "è²“åœ¨ç®±å­è£¡é¢ ğŸ“¦",
                draw: (prog) => {
                    const boxX = canvasWidth/2, boxY = canvasHeight/2 + 30;
                    // Draw Box Back
                    ctx.fillStyle = "#D7B377";
                    ctx.fillRect(boxX - 60, boxY - 50, 120, 100);
                    // Draw Cat (moves up and down)
                    const catY = boxY + Math.sin(prog/10) * 5;
                    drawEmoji("ğŸ±", boxX, catY, 60);
                    // Draw Box Front (creates depth)
                    ctx.fillStyle = "rgba(215, 179, 119, 0.9)";
                    ctx.fillRect(boxX - 60, boxY, 120, 50);
                }
            },
            {
                id: 'on', title: "ON", text: "The apple is ON the table.", trans: "è˜‹æœåœ¨æ¡Œå­ä¸Šé¢ ğŸ",
                draw: (prog) => {
                    const tX = canvasWidth/2, tY = canvasHeight/2 + 50;
                    // Table
                    ctx.fillStyle = "#8D6E63";
                    ctx.fillRect(tX - 80, tY, 160, 15); // top
                    ctx.fillRect(tX - 70, tY + 15, 15, 60); // leg L
                    ctx.fillRect(tX + 55, tY + 15, 15, 60); // leg R
                    // Apple (bounce)
                    const bounce = Math.abs(Math.sin(prog/8)) * 20;
                    drawEmoji("ğŸ", tX, tY - 25 - bounce, 50);
                }
            },
            {
                id: 'at', title: "AT", text: "He is waiting AT the bus stop.", trans: "ä»–åœ¨å…¬è»Šç«™ç­‰å€™ ğŸš",
                draw: (prog) => {
                    const cX = canvasWidth/2;
                    drawEmoji("ğŸš", cX - 40, canvasHeight/2, 80);
                    const walk = Math.sin(prog/5) * 5;
                    drawEmoji("ğŸ§", cX + 40 + walk, canvasHeight/2 + 20, 70);
                }
            },
            {
                id: 'under', title: "UNDER", text: "The dog is UNDER the desk.", trans: "ç‹—åœ¨æ›¸æ¡Œä¸‹é¢ ğŸ•",
                draw: (prog) => {
                    const tX = canvasWidth/2, tY = canvasHeight/2;
                    drawEmoji("ğŸ•", tX, tY + 60, 50); // Dog first (behind legs)
                    // Desk
                    ctx.fillStyle = "#5D4037";
                    ctx.fillRect(tX - 90, tY, 180, 15);
                    ctx.fillRect(tX - 80, tY + 15, 15, 80);
                    ctx.fillRect(tX + 65, tY + 15, 15, 80);
                }
            },
            {
                id: 'turn_in', title: "TURN IN", text: "Time to TURN IN. (Go to bed)", trans: "è©²ä¸ŠåºŠç¡è¦ºäº† ğŸ›Œ",
                draw: (prog) => {
                    const cX = canvasWidth/2;
                    // Bed
                    drawEmoji("ğŸ›ï¸", cX, canvasHeight/2 + 20, 100);
                    // ZZZ animation
                    const zOffset = (prog % 50) * 1.5;
                    const zOp = 1 - (prog % 50)/50;
                    ctx.fillStyle = `rgba(0,0,200,${zOp})`;
                    ctx.font = "20px Arial";
                    ctx.fillText("Zzz...", cX + 30 + zOffset/2, canvasHeight/2 - 20 - zOffset);
                }
            },
            {
                id: 'give_up', title: "GIVE UP", text: "Don't GIVE UP!", trans: "ä¸è¦æ”¾æ£„ï¼åŠ æ²¹ï¼ğŸ’ª",
                draw: (prog) => {
                    const cX = canvasWidth/2;
                    // Person changing expression
                    const face = Math.floor(prog / 20) % 2 === 0 ? "ğŸ˜«" : "ğŸ˜¤"; 
                    drawEmoji(face, cX, canvasHeight/2, 80);
                    
                    // Sweat drops
                    if (Math.floor(prog / 10) % 2 === 0) {
                        drawEmoji("ğŸ’¦", cX + 50, canvasHeight/2 - 20, 30);
                    }
                }
            }
        ];

        // åˆå§‹åŒ–
        let currentSceneIdx = 0;
        let isPlaying = false;
        let progress = 0;
        let animId;

        // ç”ŸæˆæŒ‰éˆ•
        const btnContainer = document.getElementById('prepositionButtons');
        scenes.forEach((s, idx) => {
            const b = document.createElement('button');
            b.className = `prep-tag ${s.title.includes(' ') ? 'phrasal' : ''}`;
            b.textContent = s.title;
            b.onclick = () => {
                currentSceneIdx = idx;
                progress = 0;
                drawScene();
                playSound('transition');
            };
            btnContainer.appendChild(b);
        });

        function drawScene() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            
            // èƒŒæ™¯æ·¡è‰²è£é£¾
            ctx.fillStyle = "#FDFBF7";
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            const scene = scenes[currentSceneIdx];
            
            // å‘¼å«ç‰¹å®šç¹ªåœ–å‡½æ•¸
            ctx.save();
            scene.draw(progress);
            ctx.restore();
            
            // æ–‡å­—è¦†è“‹
            drawText(scene.text, scene.trans);
        }

        function loop() {
            if (!isPlaying) return;
            progress += 1;
            document.getElementById('progressBar').style.width = `${(progress % 100)}%`;
            
            drawScene();
            
            // æ¯ 200 frame è‡ªå‹•æ›å ´æ™¯ (ç´„ 3.3ç§’)
            if (progress > 200) {
                progress = 0;
                // ä¸è‡ªå‹•æ›å ´æ™¯ï¼Œè®“ç”¨æˆ¶è‡ªå·±é»é¸ï¼Œé«”é©—è¼ƒå¥½ã€‚åªé‡ç½®å‹•ç•«å¾ªç’°ã€‚
                // è‹¥éœ€è‡ªå‹•æ’­æ”¾å¯è§£é–‹ä¸‹è¡Œï¼š
                // currentSceneIdx = (currentSceneIdx + 1) % scenes.length;
            }
            
            animId = requestAnimationFrame(loop);
        }

        // æ§åˆ¶å™¨
        document.getElementById('playBtn').onclick = () => {
            if (!isPlaying) { isPlaying = true; loop(); playSound('click'); }
        };
        document.getElementById('pauseBtn').onclick = () => {
            isPlaying = false; cancelAnimationFrame(animId); playSound('click');
        };
        document.getElementById('resetBtn').onclick = () => {
            isPlaying = false; cancelAnimationFrame(animId); progress = 0; drawScene(); playSound('click');
        };

        // å•Ÿå‹•ç¬¬ä¸€æ¬¡ç¹ªè£½
        resizeCanvas();


        // === æ¸¬é©—ç³»çµ± ===
        const quizData = [
            { q: "The book is ___ the table.", options: ["in", "on", "at", "under"], ans: 1 },
            { q: "I will meet you ___ 5:00 PM.", options: ["on", "in", "at", "to"], ans: 2 },
            { q: "She is interested ___ music.", options: ["on", "in", "of", "with"], ans: 1 },
            { q: "Please turn ___ the light. It's dark.", options: ["in", "on", "off", "up"], ans: 1 },
            { q: "Never give ___ on your dreams.", options: ["up", "in", "out", "away"], ans: 0 },
            { q: "The fish is swimming ___ the river.", options: ["on", "at", "in", "over"], ans: 2 }
        ];

        let quizState = { current: 0, score: 0 };

        const els = {
            start: document.getElementById('startQuiz'),
            container: document.getElementById('quizContainer'),
            qText: document.getElementById('question'),
            opts: document.getElementById('options'),
            res: document.getElementById('quizResult'),
            score: document.getElementById('score'),
            msg: document.getElementById('resultMessage'),
            restart: document.getElementById('restartQuiz')
        };

        els.start.onclick = initQuiz;
        els.restart.onclick = initQuiz;

        function initQuiz() {
            quizState = { current: 0, score: 0 };
            els.start.style.display = 'none';
            els.res.classList.remove('active');
            els.container.classList.add('active');
            loadQuestion();
            playSound('click');
        }

        function loadQuestion() {
            if (quizState.current >= quizData.length) return showResults();
            
            const q = quizData[quizState.current];
            els.qText.textContent = `${quizState.current + 1}. ${q.q}`;
            els.opts.innerHTML = '';
            
            q.options.forEach((opt, idx) => {
                const btn = document.createElement('div');
                btn.className = 'option';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(idx, q.ans, btn);
                els.opts.appendChild(btn);
            });
        }

        function checkAnswer(selected, correct, btnInfo) {
            // é˜²æ­¢é‡è¤‡é»æ“Š
            const allOpts = document.querySelectorAll('.option');
            allOpts.forEach(o => o.style.pointerEvents = 'none');

            if (selected === correct) {
                btnInfo.classList.add('correct');
                quizState.score++;
                playSound('correct');
            } else {
                btnInfo.classList.add('incorrect');
                allOpts[correct].classList.add('correct'); // é¡¯ç¤ºæ­£è§£
                playSound('incorrect');
            }

            setTimeout(() => {
                quizState.current++;
                loadQuestion();
            }, 1000);
        }

        function showResults() {
            els.container.classList.remove('active');
            els.res.classList.add('active');
            els.score.textContent = `${quizState.score}/${quizData.length}`;
            
            const percentage = (quizState.score / quizData.length);
            if (percentage === 1) {
                els.msg.textContent = "ğŸ† Perfect! å¤ªå²å®³äº†ï¼";
                playSound('win');
                fireConfetti();
            } else if (percentage >= 0.6) {
                els.msg.textContent = "ğŸ‰ Great Job! åšå¾—å¾ˆå¥½ï¼";
                playSound('transition');
            } else {
                els.msg.textContent = "ğŸ’ª Keep Trying! å†æ¥å†å²ï¼";
            }
        }

        // ç°¡æ˜“ Confetti æ•ˆæœ
        function fireConfetti() {
            const colors = ['#f4a261', '#2a9d8f', '#e9c46a', '#e76f51', '#8E7CC3'];
            for(let i=0; i<50; i++) {
                const conf = document.createElement('div');
                conf.style.position = 'fixed';
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.top = '-10px';
                conf.style.width = '10px';
                conf.style.height = '10px';
                conf.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                conf.style.transition = 'all 2s ease-out';
                conf.style.zIndex = '9999';
                document.body.appendChild(conf);
                
                setTimeout(() => {
                    conf.style.transform = `translate(${Math.random()*100 - 50}px, 100vh) rotate(${Math.random()*720}deg)`;
                    conf.style.opacity = 0;
                }, 50);
                
                setTimeout(() => conf.remove(), 2000);
            }
        }
    </script>
</body>
</html>
