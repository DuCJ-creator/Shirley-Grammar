<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shirley's Advanced Preposition Lab | ä»‹ä¿‚è©å®Œå…¨é«”</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* å»¶çºŒé«˜è³ªæ„Ÿçš„æ·±ç´«è‰²ç³» */
            --primary: #6C5CE7;
            --primary-dark: #4834D4;
            --secondary: #A29BFE;
            --accent: #FDCB6E;        
            --phrasal-color: #00B894; /* ç‰‡èªå°ˆç”¨è‰² (é’ç¶ è‰²) */
            
            --surface: rgba(255, 255, 255, 0.95);
            --bg-gradient: linear-gradient(135deg, #F5F6FA 0%, #DFE6E9 100%);
            
            --text-main: #2D3436;
            --text-light: #636E72;
            
            --radius: 20px;
            --shadow: 0 10px 30px rgba(108, 92, 231, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Nunito', 'Noto Sans TC', sans-serif; }
        
        body {
            background: var(--bg-gradient);
            color: var(--text-main);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .app-container {
            width: 100%;
            max-width: 1200px;
            background: var(--surface);
            backdrop-filter: blur(20px);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.8);
            display: grid;
            grid-template-rows: auto 1fr auto;
            overflow: hidden;
            min-height: 800px;
        }

        /* Header */
        header {
            padding: 20px 30px;
            background: white;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .brand h1 { font-size: 1.6rem; color: var(--primary-dark); font-weight: 800; }
        .brand span { background: var(--accent); padding: 4px 10px; border-radius: 8px; font-size: 0.8rem; font-weight: 700; margin-left: 10px;}

        /* Grid Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 4fr 5fr;
            height: 100%;
            overflow: hidden;
        }

        /* Left: Visualizer */
        .visualizer-panel {
            background: #F8F9FA;
            padding: 25px;
            border-right: 1px solid #eee;
            display: flex;
            flex-direction: column;
        }

        .canvas-wrapper {
            flex: 1;
            background: white;
            border-radius: var(--radius);
            border: 2px solid #eee;
            position: relative;
            overflow: hidden;
            min-height: 300px;
            margin-bottom: 15px;
        }
        canvas { width: 100%; height: 100%; }

        .scene-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .scene-btn {
            padding: 10px;
            border: 1px solid var(--secondary);
            background: white;
            color: var(--primary);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.85rem;
        }
        .scene-btn:hover, .scene-btn.active {
            background: var(--primary); color: white; transform: translateY(-2px);
        }

        /* Right: Content */
        .content-panel {
            padding: 0;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .tabs {
            display: flex;
            padding: 0 20px;
            border-bottom: 1px solid #eee;
            background: #FAFAFA;
        }

        .tab {
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 700;
            color: var(--text-light);
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }
        .tab:hover { color: var(--primary); background: rgba(108, 92, 231, 0.05); }
        .tab.active { color: var(--primary); border-bottom-color: var(--primary); background: white; }

        .content-scroll {
            padding: 25px;
            overflow-y: auto;
            flex: 1;
        }

        .section-content { display: none; animation: fadeIn 0.3s; }
        .section-content.active { display: block; }

        /* Card Styles */
        .concept-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
        }
        .concept-card.phrasal { border-left-color: var(--phrasal-color); }

        .tag-row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .ex-tag {
            background: #F1F2F6; padding: 4px 10px; border-radius: 6px; font-size: 0.9rem; color: #555;
            border: 1px solid #e1e1e1;
        }
        .ex-tag strong { color: var(--primary-dark); }

        /* Portal Link Button (High-End) */
        .portal-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #00B894 0%, #00CEC9 100%);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-decoration: none;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(0, 184, 148, 0.3);
            transition: transform 0.2s;
        }
        .portal-link:hover { transform: translateY(-3px); }
        .portal-icon { font-size: 2rem; margin-right: 15px; }

        /* Quiz Styles */
        .quiz-container { text-align: center; padding: 20px; }
        .option-btn {
            display: block; width: 100%; padding: 15px; margin-bottom: 10px;
            border: 2px solid #eee; border-radius: 12px; background: white;
            cursor: pointer; font-size: 1rem; text-align: left; transition: all 0.2s;
        }
        .option-btn:hover { border-color: var(--primary); background: #f8f9ff; }
        .option-btn.correct { background: #d4edda; border-color: #c3e6cb; color: #155724; }
        .option-btn.wrong { background: #f8d7da; border-color: #f5c6cb; color: #721c24; }

        .feedback-box {
            background: #F0F3F4; padding: 15px; border-radius: 10px; margin-top: 15px;
            text-align: left; display: none; border-left: 4px solid #666;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Mobile */
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
            .visualizer-panel { height: 400px; border-right: none; border-bottom: 1px solid #eee; }
            .app-container { height: auto; display: block; }
        }
    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="brand">
            <h1>Shirley's Preposition Lab</h1>
            <span>V3.0 Complete</span>
        </div>
        <div style="font-size: 0.9rem; color: #666;">ä»‹ä¿‚è© & å‹•è©ç‰‡èªå®Œå…¨æ”»ç•¥</div>
    </header>

    <div class="main-grid">
        <section class="visualizer-panel">
            <h3 style="margin-bottom: 10px; color: var(--primary);">ğŸ¥ å‹•æ…‹å¯¦é©—å®¤</h3>
            <div class="canvas-wrapper" id="canvasContainer">
                <canvas id="prepCanvas"></canvas>
            </div>
            
            <div class="scene-controls">
                <button class="scene-btn active" onclick="setScenario('pyramid')">ğŸ“ å€’ä¸‰è§’æ³•å‰‡</button>
                <button class="scene-btn" onclick="setScenario('motion_through')">ğŸš‡ Through/Across</button>
                <button class="scene-btn" onclick="setScenario('surface_in')">ğŸ“¦ In vs On</button>
                <button class="scene-btn" onclick="setScenario('transport')" style="border-color: var(--phrasal-color); color: var(--phrasal-color);">ğŸšŒ Get On vs In</button>
            </div>
            <p id="caption" style="margin-top:15px; font-size:0.9rem; color:#666; background:#fff; padding:10px; border-radius:8px;">
                é¸æ“‡ä¸Šæ–¹æŒ‰éˆ•è§€å¯Ÿè®ŠåŒ–ã€‚
            </p>
        </section>

        <section class="content-panel">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('time_place')">â³ æ™‚é–“èˆ‡åœ°é»</div>
                <div class="tab" onclick="switchTab('motion')">ğŸƒ å‹•æ…‹è·¯å¾‘</div>
                <div class="tab" onclick="switchTab('phrasal')">ğŸ§© å‹•è©ç‰‡èª</div>
                <div class="tab" onclick="switchTab('quiz')">ğŸ§  ç¶œåˆæ¸¬é©—</div>
            </div>

            <div class="content-scroll">
                
                <div id="time_place" class="section-content active">
                    <h2 style="margin-bottom: 15px;">The Pyramid Rule (å€’ä¸‰è§’æ³•å‰‡)</h2>
                    
                    <div class="concept-card">
                        <h3 style="color: #0984e3;">IN (å¤§ç¯„åœ / å®¹å™¨)</h3>
                        <p>æ™‚é–“ï¼šä¸–ç´€, å¹´, å­£ç¯€, æœˆä»½, æ™‚æ®µ (in the morning)</p>
                        <p>åœ°é»ï¼šåœ‹å®¶, åŸå¸‚, å°é–‰ç©ºé–“ (in the box, in the car)</p>
                    </div>

                    <div class="concept-card">
                        <h3 style="color: #00b894;">ON (ç‰¹å®šé¢ / æ—¥å­)</h3>
                        <p>æ™‚é–“ï¼šæ—¥æœŸ, æ˜ŸæœŸå¹¾, ç‰¹å®šçš„ç¯€æ—¥ (on Christmas Day)</p>
                        <p>åœ°é»ï¼šæ¥è§¸è¡¨é¢, è¡—é“, <strong>å¤§çœ¾é‹è¼¸ (on the bus)</strong></p>
                    </div>

                    <div class="concept-card">
                        <h3 style="color: #d63031;">AT (ç²¾ç¢ºé»)</h3>
                        <p>æ™‚é–“ï¼šå¹¾é»å¹¾åˆ† (at 5 PM), æ­¤åˆ» (at the moment)</p>
                        <p>åœ°é»ï¼šåœ°åœ–ä¸Šçš„é» (at the station), é–€å£ (at the door)</p>
                    </div>
                </div>

                <div id="motion" class="section-content">
                    <h2>Motion Prepositions</h2>
                    <div class="concept-card">
                        <h3>Through vs Across</h3>
                        <p><strong>Through:</strong> ç©¿éç«‹é«”ç©ºé–“å…§éƒ¨ (tunnel, forest)ã€‚</p>
                        <p><strong>Across:</strong> æ©«è¶Šå¹³é¢è¡¨é¢ (road, river)ã€‚</p>
                    </div>
                    <div class="concept-card">
                        <h3>To vs Towards</h3>
                        <p><strong>To:</strong> ç›®çš„åœ° (æœƒåˆ°é”)ã€‚</p>
                        <p><strong>Towards:</strong> æœå‘...æ–¹å‘ (ä¸ä¸€å®šåˆ°é”)ã€‚</p>
                    </div>
                </div>

                <div id="phrasal" class="section-content">
                    <a href="https://ducj-creator.github.io/Shirley-Grammar/phrases" target="_blank" class="portal-link">
                        <div style="display:flex; align-items:center;">
                            <div class="portal-icon">ğŸ®</div>
                            <div>
                                <h3 style="margin:0;">äº’å‹•å¼ç‰‡èªç·´ç¿’å€</h3>
                                <p style="margin:0; font-size:0.9rem; opacity:0.9;">é»æ“Šå‰å¾€ Shirley's Phrases åšæ›´æ·±å…¥çš„å¡ç‰‡ç·´ç¿’</p>
                            </div>
                        </div>
                        <div>â”</div>
                    </a>

                    <h2>Phrasal Verbs (å‹•è©ç‰‡èª)</h2>
                    <p style="margin-bottom: 20px; color: #666;">å‹•è© + ä»‹ä¿‚è© = å…¨æ–°çš„æ„æ€ï¼é€™æ˜¯è‹±èªé“åœ°çš„é—œéµã€‚</p>

                    <div class="concept-card phrasal">
                        <h3>ğŸ‘€ Look (çœ‹)</h3>
                        <div class="tag-row">
                            <div class="ex-tag"><strong>Look at</strong> æ³¨è¦–</div>
                            <div class="ex-tag"><strong>Look for</strong> å°‹æ‰¾</div>
                            <div class="ex-tag"><strong>Look after</strong> ç…§é¡§</div>
                            <div class="ex-tag"><strong>Look up</strong> æŸ¥é–±(å­—å…¸)</div>
                        </div>
                    </div>

                    <div class="concept-card phrasal">
                        <h3>ğŸ Give (çµ¦)</h3>
                        <div class="tag-row">
                            <div class="ex-tag"><strong>Give up</strong> æ”¾æ£„</div>
                            <div class="ex-tag"><strong>Give in</strong> å±ˆæœ</div>
                            <div class="ex-tag"><strong>Give away</strong> è´ˆé€/æ´©éœ²</div>
                            <div class="ex-tag"><strong>Give off</strong> æ•£ç™¼(æ°£å‘³/å…‰)</div>
                        </div>
                    </div>

                    <div class="concept-card phrasal">
                        <h3>ğŸ”Œ Turn (è½‰)</h3>
                        <div class="tag-row">
                            <div class="ex-tag"><strong>Turn on</strong> æ‰“é–‹(é›»æº)</div>
                            <div class="ex-tag"><strong>Turn off</strong> é—œæ‰</div>
                            <div class="ex-tag"><strong>Turn up</strong> èª¿å¤§è²/å‡ºç¾</div>
                            <div class="ex-tag"><strong>Turn down</strong> æ‹’çµ•/èª¿å°è²</div>
                        </div>
                    </div>

                    <div class="concept-card phrasal">
                        <h3>ğŸšŒ Transport (äº¤é€š)</h3>
                        <p>é€™èˆ‡ä»‹ä¿‚è©é‚è¼¯æœ‰é—œï¼š</p>
                        <div class="tag-row">
                            <div class="ex-tag"><strong>Get on / off</strong> Bus, Train, Plane (å¯ç«™ç«‹/ç”²æ¿)</div>
                            <div class="ex-tag"><strong>Get in / out of</strong> Car, Taxi (éœ€å½è…°/å®¹å™¨)</div>
                        </div>
                    </div>
                </div>

                <div id="quiz" class="section-content">
                    <div class="quiz-container">
                        <h3 id="qText" style="margin-bottom: 20px; color: var(--primary-dark);">Question Loading...</h3>
                        <div id="qOptions"></div>
                        <div class="feedback-box" id="qFeedback"></div>
                        <button id="nextBtn" onclick="nextQ()" style="display:none; margin-top:15px; padding:10px 20px; background:var(--primary); color:white; border:none; border-radius:50px; cursor:pointer;">Next Question â¡ï¸</button>
                    </div>
                </div>

            </div>
        </section>
    </div>
</div>

<script>
    // === Canvas Visualizer ===
    const canvas = document.getElementById('prepCanvas');
    const ctx = canvas.getContext('2d');
    let frame = 0;
    let scenario = 'pyramid';
    
    function resize() {
        const p = document.getElementById('canvasContainer');
        canvas.width = p.clientWidth;
        canvas.height = p.clientHeight;
    }
    window.addEventListener('resize', resize);

    function drawEmoji(e, x, y, s) {
        ctx.font = `${s}px Arial`; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(e, x, y);
    }

    function loop() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        frame++;
        const cx = canvas.width/2;
        const cy = canvas.height/2;

        if(scenario === 'pyramid') {
            // Pyramid Draw
            ctx.beginPath(); ctx.moveTo(cx, cy-120); ctx.lineTo(cx-100, cy+80); ctx.lineTo(cx+100, cy+80); ctx.closePath();
            const g = ctx.createLinearGradient(0, cy-120, 0, cy+80);
            g.addColorStop(0, '#fab1a0'); g.addColorStop(0.5, '#55efc4'); g.addColorStop(1, '#74b9ff');
            ctx.fillStyle=g; ctx.fill();
            
            ctx.fillStyle="#000"; ctx.font="bold 14px Arial";
            ctx.fillText("AT (Point)", cx, cy-80);
            ctx.fillText("ON (Surface)", cx, cy);
            ctx.fillText("IN (Volume)", cx, cy+60);

            // Floating items
            const y = cy - 80 + Math.sin(frame/20)*60;
            drawEmoji("ğŸ“…", cx+120, y, 30);
            ctx.fillStyle="#555"; ctx.fillText("Time/Place", cx+120, y+30);

        } else if (scenario === 'transport') {
            // Get On (Bus) vs Get In (Car)
            // Car
            const carX = cx - 100;
            ctx.fillStyle = "#ff7675"; ctx.fillRect(carX-40, cy, 80, 40); // Body
            ctx.fillStyle = "#dfe6e9"; ctx.fillRect(carX-30, cy-25, 60, 25); // Top
            drawEmoji("ğŸš—", carX, cy+20, 20); // Wheels visual filler
            ctx.fillStyle="#2d3436"; ctx.fillText("IN the car", carX, cy+60);
            
            // Bus
            const busX = cx + 100;
            ctx.fillStyle = "#0984e3"; ctx.fillRect(busX-50, cy-40, 100, 80);
            ctx.fillStyle="#fff"; ctx.fillRect(busX-45, cy-30, 90, 30); // Windows
            ctx.fillStyle="#2d3436"; ctx.fillText("ON the bus", busX, cy+60);

            // Animated Person
            const pX = (frame % 200) < 100 ? carX : busX;
            const action = (frame % 200) < 100 ? "Get IN" : "Get ON";
            // Make person crouch for car, stand for bus
            const emoji = (frame % 200) < 100 ? "ğŸ§" : "ğŸš¶";
            
            drawEmoji(emoji, pX, cy + 10, 40);
            ctx.fillStyle = "#00b894"; ctx.font="bold 20px Arial";
            ctx.fillText(action, cx, cy-100);

        } else if (scenario === 'surface_in') {
             // In Box vs On Table
             drawEmoji("ğŸ“¦", cx-80, cy, 80);
             drawEmoji("ğŸ±", cx-80, cy, 40); // Cat IN box
             ctx.fillStyle="#333"; ctx.fillText("IN the box", cx-80, cy+60);

             // Table
             ctx.fillStyle="#a29bfe"; ctx.fillRect(cx+40, cy+20, 80, 10);
             ctx.fillRect(cx+50, cy+30, 10, 30); ctx.fillRect(cx+100, cy+30, 10, 30);
             drawEmoji("ğŸ", cx+80, cy, 40); // Apple ON table
             ctx.fillStyle="#333"; ctx.fillText("ON the table", cx+80, cy+80);

        } else if (scenario === 'motion_through') {
            // Tunnel vs Road
            ctx.fillStyle="#636e72"; ctx.beginPath(); ctx.arc(cx, cy-50, 40, Math.PI, 0); ctx.fill();
            const tx = (frame*2)%300 + (cx-150);
            if(tx > cx-40 && tx < cx+40) ctx.globalAlpha=0.3;
            drawEmoji("ğŸš‚", tx, cy-50, 40);
            ctx.globalAlpha=1;
            ctx.fillStyle="#333"; ctx.fillText("THROUGH (Tunnel)", cx, cy-10);

            // Road
            ctx.fillStyle="#b2bec3"; ctx.fillRect(cx-100, cy+50, 200, 40);
            const wx = cx; const wy = cy+30 + (frame%100)/100 * 80;
            drawEmoji("ğŸš¶", wx, wy, 30);
            ctx.fillStyle="#333"; ctx.fillText("ACROSS (Road)", cx, cy+110);
        }

        requestAnimationFrame(loop);
    }

    function setScenario(s) {
        scenario = s;
        frame = 0;
        document.querySelectorAll('.scene-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        const texts = {
            pyramid: "å€’ä¸‰è§’æ³•å‰‡ï¼šä¸Šæ–¹ç¯„åœæœ€å¤§ç”¨ INï¼Œä¸­é–“ç‰¹å®šç”¨ ONï¼Œä¸‹æ–¹ç²¾ç¢ºé»ç”¨ ATã€‚",
            transport: "äº¤é€šå·¥å…·åˆ¤æ–·ï¼šè¦å½è…°é€²å»åƒå®¹å™¨çš„ç”¨ IN (Car)ï¼›å¯ä»¥ç«™ç«‹èµ°å‹•åƒç”²æ¿çš„ç”¨ ON (Bus)ã€‚",
            surface_in: "ç©ºé–“åˆ¤æ–·ï¼šIN å¼·èª¿åœ¨å…§éƒ¨ï¼ŒON å¼·èª¿åœ¨è¡¨é¢æ¥è§¸ã€‚",
            motion_through: "å‹•æ…‹åˆ¤æ–·ï¼šThrough æ˜¯ç©¿éç«‹é«”å…§éƒ¨ï¼ŒAcross æ˜¯æ©«è¶Šå¹³é¢è¡¨é¢ã€‚"
        };
        document.getElementById('caption').innerText = texts[s];
    }
    
    resize();
    loop();

    // === Tabs ===
    function switchTab(id) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById(id).classList.add('active');
    }

    // === Quiz System (Include Phrasal Verbs) ===
    const quizData = [
        { q: "Please turn ___ the lights. It's too dark.", opts: ["in", "on", "up", "over"], ans: 1, why: "Turn on (æ‰“é–‹é›»æº)ã€‚" },
        { q: "Don't give ___ ! You can do it!", opts: ["in", "up", "off", "out"], ans: 1, why: "Give up (æ”¾æ£„)ã€‚" },
        { q: "I was born ___ 1995.", opts: ["at", "on", "in", "to"], ans: 2, why: "å¹´ä»½æ˜¯å¤§ç¯„åœæ™‚é–“ï¼Œä½¿ç”¨ INã€‚" },
        { q: "He is sitting ___ the bus.", opts: ["in", "at", "on", "by"], ans: 2, why: "å…¬è»Šæ˜¯å¤§çœ¾é‹è¼¸å·¥å…·ï¼Œå¯ç«™ç«‹ï¼Œä½¿ç”¨ ONã€‚" },
        { q: "Who is looking ___ the baby?", opts: ["at", "for", "after", "up"], ans: 2, why: "Look after (ç…§é¡§)ã€‚Look at æ˜¯æ³¨è¦–ï¼ŒLook for æ˜¯å°‹æ‰¾ã€‚" }
    ];
    let qIdx = 0;

    function loadQ() {
        if(qIdx >= quizData.length) {
            document.getElementById('quiz-container').innerHTML = "<h3>æ¸¬é©—çµæŸï¼ğŸ‰</h3>";
            return;
        }
        const d = quizData[qIdx];
        document.getElementById('qText').innerText = `${qIdx+1}. ${d.q}`;
        const area = document.getElementById('qOptions');
        area.innerHTML = '';
        document.getElementById('qFeedback').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'none';

        d.opts.forEach((o, i) => {
            const b = document.createElement('button');
            b.className = 'option-btn';
            b.innerText = o;
            b.onclick = () => check(b, i, d.ans, d.why);
            area.appendChild(b);
        });
    }

    function check(btn, i, ans, why) {
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.style.pointerEvents = 'none');
        
        const fb = document.getElementById('qFeedback');
        fb.style.display = 'block';
        
        if(i === ans) {
            btn.classList.add('correct');
            fb.innerHTML = `âœ… æ­£ç¢ºï¼<br>${why}`;
            fb.style.borderLeftColor = "var(--primary)";
        } else {
            btn.classList.add('wrong');
            btns[ans].classList.add('correct');
            fb.innerHTML = `âŒ éŒ¯èª¤ã€‚<br>${why}`;
            fb.style.borderLeftColor = "#e74c3c";
        }
        document.getElementById('nextBtn').style.display = 'inline-block';
    }

    function nextQ() {
        qIdx++;
        loadQ();
    }
    
    loadQ();

</script>
</body>
</html>
