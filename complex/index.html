<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 2: Compound Sentences Animation</title>
    <style>
        /* --- 基础设置与配色 --- */
        :root {
            --bg-color: #fdfcf8;
            --text-main: #2c3e50;
            --card-1: #e3f2fd; /* 浅蓝 Clause 1 */
            --text-1: #1565c0;
            --card-2: #e8f5e9; /* 浅绿 Clause 2 */
            --text-2: #2e7d32;
            --accent: #ffab91; /* 珊瑚色 Connector */
            --accent-text: #d84315;
            --semi: #b39ddb;   /* 紫色 Semicolon */
            --semi-text: #5e35b1;
            --subtitle-bg: rgba(0, 0, 0, 0.85);
            --font-main: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            font-family: var(--font-main);
            overflow: hidden; /* 防止滚动 */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: var(--text-main);
        }

        /* --- 舞台容器 (16:9) --- */
        #stage-container {
            width: 90vw;
            max-width: 1200px;
            aspect-ratio: 16/9;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* --- 背景装饰元素 --- */
        .bg-circle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.3;
            z-index: 0;
        }
        .c1 { width: 300px; height: 300px; background: #fff3e0; top: -50px; right: -50px; animation: float 10s infinite ease-in-out; }
        .c2 { width: 200px; height: 200px; background: #e1f5fe; bottom: 50px; left: -50px; animation: float 12s infinite ease-in-out reverse; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(20px, 30px); }
        }

        /* --- 主要内容区域 --- */
        #main-scene {
            z-index: 10;
            width: 80%;
            height: 60%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            transition: all 0.5s ease;
        }

        /* --- 句子卡片 --- */
        .clause {
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.8rem;
            font-weight: 600;
            box-shadow: 0 10px 20px rgba(0,0,0,0.08);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(20px);
        }

        .clause.simple { background-color: var(--card-1); color: var(--text-1); }
        .clause.second { background-color: var(--card-2); color: var(--text-2); }
        
        .clause.show { opacity: 1; transform: translateY(0); }

        /* --- 连接词与标点 --- */
        .connector-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 15px;
            opacity: 0;
            transform: scale(0);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .connector-wrapper.show { opacity: 1; transform: scale(1); }

        .comma {
            font-size: 3rem;
            color: var(--text-main);
            line-height: 1;
            margin-bottom: -10px; /* Pull closer to word */
            margin-right: 5px;
        }

        .conjunction {
            background-color: var(--accent);
            color: var(--accent-text);
            padding: 10px 20px;
            border-radius: 50px; /* Pill shape */
            font-weight: 800;
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(255, 171, 145, 0.4);
            position: relative;
        }

        .semicolon-box {
            background-color: var(--semi);
            color: var(--semi-text);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(179, 157, 219, 0.4);
            margin: 0 20px;
            opacity: 0;
            transform: scale(0) rotate(-180deg);
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .semicolon-box.show { opacity: 1; transform: scale(1) rotate(0deg); }

        /* --- 标题与标签 --- */
        #top-label {
            position: absolute;
            top: 40px;
            font-size: 1.2rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: #90a4ae;
            font-weight: 700;
        }

        /* --- FANBOYS 列表展示 --- */
        #fanboys-list {
            position: absolute;
            top: 20%;
            display: flex;
            gap: 15px;
            opacity: 0;
            pointer-events: none;
        }
        .fb-item {
            font-size: 2rem;
            font-weight: 900;
            color: #ddd;
            transition: all 0.3s;
        }
        .fb-item.active {
            color: var(--accent-text);
            transform: scale(1.5);
            text-shadow: 0 2px 10px rgba(216, 67, 21, 0.2);
        }

        /* --- 字幕区域 --- */
        #subtitle-container {
            position: absolute;
            bottom: 40px;
            width: 80%;
            text-align: center;
            background: var(--subtitle-bg);
            padding: 15px 25px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: opacity 0.5s;
        }

        .sub-en {
            display: block;
            color: #fff;
            font-size: 1.3rem;
            margin-bottom: 5px;
            font-weight: 500;
        }
        .sub-cn {
            display: block;
            color: #cfd8dc;
            font-size: 1rem;
            font-weight: 300;
        }

        /* --- 进度条 --- */
        #progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--card-1), var(--accent), var(--card-2));
            width: 0%;
            transition: width 0.2s linear;
        }

        /* --- 辅助动画 --- */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .highlight {
            animation: pulse 1s infinite;
            border: 3px solid var(--accent);
        }

    </style>
</head>
<body>

    <div id="stage-container">
        <!-- 背景装饰 -->
        <div class="bg-circle c1"></div>
        <div class="bg-circle c2"></div>

        <!-- 顶部标签 -->
        <div id="top-label">English Grammar Level 2</div>

        <!-- FANBOYS 全局列表 -->
        <div id="fanboys-list">
            <span class="fb-item" id="fb-f">F</span>
            <span class="fb-item" id="fb-a">A</span>
            <span class="fb-item" id="fb-n">N</span>
            <span class="fb-item" id="fb-b">B</span>
            <span class="fb-item" id="fb-o">O</span>
            <span class="fb-item" id="fb-y">Y</span>
            <span class="fb-item" id="fb-s">S</span>
        </div>

        <!-- 动态内容舞台 -->
        <div id="main-scene">
            <!-- 内容由 JS 动态生成 -->
        </div>

        <!-- 字幕 -->
        <div id="subtitle-container">
            <span class="sub-en" id="sub-en">Welcome to English Grammar.</span>
            <span class="sub-cn" id="sub-cn">欢迎来到英语语法课堂。</span>
        </div>

        <!-- 进度条 -->
        <div id="progress-bar"></div>
    </div>

    <script>
        /* --- 音频引擎 (Web Audio API) --- */
        // 简单的合成器，不需要外部文件
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            const now = audioCtx.currentTime;

            if (type === 'pop') {
                // 气泡弹出声
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'snap') {
                // 拼接声
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gainNode.gain.setValueAtTime(0.5, now);
                gainNode.gain.linearRampToValueAtTime(0.01, now + 0.15);
                osc.start(now);
                osc.stop(now + 0.15);
            } else if (type === 'magic') {
                // 魔法音效
                osc.type = 'sine';
                osc.frequency.setValueAtTime(300, now);
                osc.frequency.linearRampToValueAtTime(1200, now + 0.5);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            } else if (type === 'whoosh') {
                // 滑动声
                osc.type = 'square';
                osc.frequency.setValueAtTime(100, now);
                gainNode.gain.setValueAtTime(0.05, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            }
        }

        /* --- 动画控制逻辑 --- */
        const scene = document.getElementById('main-scene');
        const subEn = document.getElementById('sub-en');
        const subCn = document.getElementById('sub-cn');
        const progressBar = document.getElementById('progress-bar');
        const fanboysList = document.getElementById('fanboys-list');
        const topLabel = document.getElementById('top-label');

        // 辅助函数：清空舞台
        function clearStage() {
            scene.innerHTML = '';
        }

        // 辅助函数：创建简单句卡片
        function createClause(text, type = 'simple') {
            const el = document.createElement('div');
            el.className = `clause ${type}`;
            el.innerText = text;
            return el;
        }

        // 辅助函数：创建连接词结构 (逗号 + 词)
        function createConnector(word) {
            const wrapper = document.createElement('div');
            wrapper.className = 'connector-wrapper';
            
            // 逗号是必须的
            const comma = document.createElement('div');
            comma.className = 'comma';
            comma.innerText = ',';
            
            const conj = document.createElement('div');
            conj.className = 'conjunction';
            conj.innerText = word;

            wrapper.appendChild(comma);
            wrapper.appendChild(conj);
            return wrapper;
        }

        // 辅助函数：创建分号
        function createSemicolon() {
            const el = document.createElement('div');
            el.className = 'semicolon-box';
            el.innerText = ';';
            return el;
        }

        // 辅助函数：更新字幕
        function setSubtitle(en, cn) {
            subEn.style.opacity = 0;
            subCn.style.opacity = 0;
            setTimeout(() => {
                subEn.innerText = en;
                subCn.innerText = cn;
                subEn.style.opacity = 1;
                subCn.style.opacity = 1;
            }, 300);
        }

        // 辅助函数：高亮 FANBOYS 列表中的字母
        function highlightFanboy(letter) {
            document.querySelectorAll('.fb-item').forEach(el => el.classList.remove('active'));
            if(letter) {
                const target = document.getElementById(`fb-${letter.toLowerCase()}`);
                if(target) target.classList.add('active');
            }
        }

        /* --- 剧本定义 (Timeline) --- */
        const script = [
            {
                // 0: Intro
                duration: 4000,
                action: () => {
                    topLabel.innerText = "Level 1: Simple Sentences";
                    clearStage();
                    const c1 = createClause("I like apples.");
                    scene.appendChild(c1);
                    setTimeout(() => { c1.classList.add('show'); playSound('pop'); }, 500);
                    setSubtitle("Level 1: The Simple Sentence.", "Level 1：简单句。一个完整的主语加谓语。");
                }
            },
            {
                // 1: The Problem (Run-on)
                duration: 5000,
                action: () => {
                    topLabel.innerText = "The Problem";
                    const c1 = scene.querySelector('.clause'); // Keep existing
                    const c2 = createClause("You like bananas.", "second");
                    scene.appendChild(c2);
                    
                    setSubtitle("But what if we want to connect two ideas?", "但如果我们想连接两个想法怎么办？");
                    
                    setTimeout(() => { 
                        c2.classList.add('show'); 
                        playSound('pop');
                        // 碰撞动画
                        setTimeout(() => {
                            c1.style.transform = "translateX(20px)";
                            c2.style.transform = "translateX(-20px)";
                            setTimeout(() => {
                                c1.style.transform = "translateX(0)";
                                c2.style.transform = "translateX(0)";
                            }, 200);
                        }, 1000);
                    }, 1000);
                }
            },
            {
                // 2: Intro Level 2
                duration: 4000,
                action: () => {
                    topLabel.innerText = "Level 2: Compound Sentences";
                    scene.innerHTML = ''; // Clear all
                    fanboysList.style.opacity = 1; // Show FANBOYS list
                    setSubtitle("Welcome to Level 2: Compound Sentences.", "欢迎来到 Level 2：复合句。我们需要胶水。");
                    playSound('magic');
                }
            },
            {
                // 3: FANBOYS Intro
                duration: 4000,
                action: () => {
                    setSubtitle("We use 'FANBOYS' to remember the connectors.", "我们使用 'FANBOYS' 来记住这些连接词。");
                    // 依次高亮
                    const letters = ['f','a','n','b','o','y','s'];
                    letters.forEach((l, i) => {
                        setTimeout(() => {
                            highlightFanboy(l);
                            playSound('pop');
                        }, i * 400);
                    });
                }
            },
            // --- Examples ---
            {
                // 4: For
                duration: 5000,
                action: () => {
                    fanboysList.style.opacity = 0.2; // Dim list
                    highlightFanboy('f');
                    clearStage();
                    
                    const c1 = createClause("I drank water");
                    const c2 = createClause("I was thirsty", "second");
                    const glue = createConnector("for"); // for = because
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    setTimeout(() => { c1.classList.add('show'); playSound('whoosh'); }, 100);
                    setTimeout(() => { glue.classList.add('show'); playSound('snap'); }, 1000);
                    setTimeout(() => { c2.classList.add('show'); playSound('whoosh'); }, 2000);

                    setSubtitle("'For' explains a reason. (Like 'because')", "'For' 解释原因（像 because 一样）。注意前面的逗号！");
                }
            },
            {
                // 5: And
                duration: 4500,
                action: () => {
                    highlightFanboy('a');
                    clearStage();
                    
                    const c1 = createClause("I go left");
                    const c2 = createClause("you go right", "second");
                    const glue = createConnector("and");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    setTimeout(() => { c1.classList.add('show'); playSound('whoosh');}, 100);
                    setTimeout(() => { glue.classList.add('show'); playSound('snap');}, 800);
                    setTimeout(() => { c2.classList.add('show'); playSound('whoosh');}, 1600);

                    setSubtitle("'And' adds one idea to another.", "'And' 将一个想法加到另一个想法上。");
                }
            },
            {
                // 6: Nor
                duration: 5000,
                action: () => {
                    highlightFanboy('n');
                    clearStage();
                    
                    const c1 = createClause("I don't sing");
                    const c2 = createClause("nor do I dance", "second"); // Inversion note visually?
                    const glue = createConnector("nor");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    setTimeout(() => { c1.classList.add('show'); playSound('whoosh');}, 100);
                    setTimeout(() => { glue.classList.add('show'); playSound('snap');}, 800);
                    setTimeout(() => { c2.classList.add('show'); playSound('whoosh');}, 1600);

                    setSubtitle("'Nor' is for negative additions.", "'Nor' 用于否定的补充（我也不会跳舞）。");
                }
            },
            {
                // 7: But
                duration: 4500,
                action: () => {
                    highlightFanboy('b');
                    clearStage();
                    
                    const c1 = createClause("I fell down");
                    const c2 = createClause("I didn't cry", "second");
                    const glue = createConnector("but");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    setTimeout(() => { c1.classList.add('show'); playSound('whoosh');}, 100);
                    setTimeout(() => { glue.classList.add('show'); playSound('snap');}, 800);
                    setTimeout(() => { c2.classList.add('show'); playSound('whoosh');}, 1600);

                    setSubtitle("'But' shows contrast.", "'But' 表示转折或对比。");
                }
            },
            {
                // 8: Or
                duration: 4500,
                action: () => {
                    highlightFanboy('o');
                    clearStage();
                    
                    const c1 = createClause("We can eat pizza");
                    const c2 = createClause("we can eat tacos", "second");
                    const glue = createConnector("or");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    setTimeout(() => { c1.classList.add('show'); playSound('whoosh');}, 100);
                    setTimeout(() => { glue.classList.add('show'); playSound('snap');}, 800);
                    setTimeout(() => { c2.classList.add('show'); playSound('whoosh');}, 1600);

                    setSubtitle("'Or' presents a choice.", "'Or' 提出一种选择。");
                }
            },
            {
                // 9: Yet
                duration: 5000,
                action: () => {
                    highlightFanboy('y');
                    clearStage();
                    
                    const c1 = createClause("It is raining");
                    const c2 = createClause("it is hot", "second");
                    const glue = createConnector("yet");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    setTimeout(() => { c1.classList.add('show'); playSound('whoosh');}, 100);
                    setTimeout(() => { glue.classList.add('show'); playSound('snap');}, 800);
                    setTimeout(() => { c2.classList.add('show'); playSound('whoosh');}, 1600);

                    setSubtitle("'Yet' is like 'but', for unexpected results.", "'Yet' 像 'but'，用于意想不到的转折。");
                }
            },
            {
                // 10: So
                duration: 4500,
                action: () => {
                    highlightFanboy('s');
                    clearStage();
                    
                    const c1 = createClause("I was tired");
                    const c2 = createClause("I went to sleep", "second");
                    const glue = createConnector("so");
                    
                    scene.appendChild(c1);
                    scene.appendChild(glue);
                    scene.appendChild(c2);

                    setTimeout(() => { c1.classList.add('show'); playSound('whoosh');}, 100);
                    setTimeout(() => { glue.classList.add('show'); playSound('snap');}, 800);
                    setTimeout(() => { c2.classList.add('show'); playSound('whoosh');}, 1600);

                    setSubtitle("'So' shows a result.", "'So' 表示结果。");
                }
            },
            // --- Semicolon ---
            {
                // 11: Semicolon Intro
                duration: 5000,
                action: () => {
                    highlightFanboy(null); // Clear highlight
                    fanboysList.style.opacity = 0; // Hide FANBOYS
                    
                    // Keep previous sentence (So) on screen but remove connector
                    const glue = scene.querySelector('.connector-wrapper');
                    if(glue) glue.style.transform = 'scale(0)'; // Shrink glue
                    
                    setTimeout(() => {
                        if(glue) glue.remove();
                        // Add Semicolon
                        const semi = createSemicolon();
                        // Insert between clauses
                        const c2 = scene.querySelector('.clause.second');
                        scene.insertBefore(semi, c2);
                        
                        setTimeout(() => {
                            semi.classList.add('show');
                            playSound('magic');
                        }, 100);
                    }, 500);

                    setSubtitle("Or... use the Semicolon (;). No glue needed!", "或者……使用分号（;）。不需要任何连接词！");
                }
            },
            {
                // 12: Semicolon Example 2
                duration: 5000,
                action: () => {
                    clearStage();
                    const c1 = createClause("I love coding");
                    const semi = createSemicolon();
                    const c2 = createClause("it is fun", "second");
                    
                    scene.appendChild(c1);
                    scene.appendChild(semi);
                    scene.appendChild(c2);

                    setTimeout(() => { c1.classList.add('show'); playSound('pop');}, 100);
                    setTimeout(() => { semi.classList.add('show'); playSound('magic');}, 800);
                    setTimeout(() => { c2.classList.add('show'); playSound('pop');}, 1500);

                    setSubtitle("The semicolon connects two closely related sentences.", "分号连接两个关系非常紧密的句子。");
                }
            },
            // --- Outro ---
            {
                // 13: Summary
                duration: 6000,
                action: () => {
                    clearStage();
                    topLabel.innerText = "Summary";
                    
                    const box = document.createElement('div');
                    box.style.textAlign = 'center';
                    box.innerHTML = `
                        <h2 style="color:var(--text-1); margin-bottom:10px;">Compound Sentence</h2>
                        <div style="font-size:1.5rem; color:#555;">Clause 1 <span style="color:var(--accent-text)">, FANBOYS</span> Clause 2</div>
                        <div style="font-size:1.5rem; color:#555; margin-top:10px;">Clause 1 <span style="color:var(--semi-text)">;</span> Clause 2</div>
                    `;
                    scene.appendChild(box);
                    
                    setSubtitle("Congratulations! You mastered Level 2.", "恭喜！你已经掌握了 Level 2 复合句。");
                    playSound('magic');
                }
            }
        ];

        /* --- 播放引擎 --- */
        let currentStep = 0;
        let totalDuration = script.reduce((acc, cur) => acc + cur.duration, 0);
        let elapsed = 0;

        function playScene() {
            if (currentStep >= script.length) {
                // Loop or Stop? Let's stop at end.
                return;
            }

            const step = script[currentStep];
            step.action();

            // 进度条逻辑
            let stepElapsed = 0;
            const progressInterval = setInterval(() => {
                stepElapsed += 100;
                elapsed += 100;
                const pct = Math.min((elapsed / totalDuration) * 100, 100);
                progressBar.style.width = `${pct}%`;
            }, 100);

            setTimeout(() => {
                clearInterval(progressInterval);
                currentStep++;
                playScene();
            }, step.duration);
        }

        // Start after a short delay to ensure DOM ready
        setTimeout(playScene, 1000);

    </script>
</body>
</html>
