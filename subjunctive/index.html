<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shirley's Subjunctive Mood (Radial Design)</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* é…è‰²æ–¹æ¡ˆï¼šMystic Violet (ç¥ç§˜ç´«) & Royal Gold (çš‡å®¶é‡‘) */
            --bg-deep: #f5f3ff;       /* æ¥µæ·ºç´«èƒŒæ™¯ */
            --primary: #5b21b6;       /* ç´«ç¾…è˜­è‰² */
            --primary-dark: #2e1065;  /* æ·±é‚ƒç´« */
            --accent: #f59e0b;        /* çš‡å®¶é‡‘ */
            
            --card-bg: rgba(255, 255, 255, 0.98);
            --shadow-float: 0 10px 40px -10px rgba(91, 33, 182, 0.2);
            --highlight-bg: #fffbeb;

            /* æ¸¬é©—å°ˆç”¨è‰² */
            --correct-bg: #dcfce7;
            --correct-text: #166534;
            --wrong-bg: #fee2e2;
            --wrong-text: #991b1b;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Lato', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-deep);
            color: #2c3e50;
            overflow: hidden; 
            height: 100vh; width: 100vw;
        }

        /* --- 1. Radial Mind Map (æ”¾å°„ç‹€é¦–é ) --- */
        #mindmap-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            z-index: 1;
        }

        /* ä¸­å¿ƒç¯€é» */
        .central-node {
            width: 200px; height: 200px;
            background: var(--primary);
            border-radius: 50%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            color: white;
            box-shadow: 0 0 50px rgba(91, 33, 182, 0.5);
            z-index: 10;
            position: relative;
            animation: pulse 3s infinite ease-in-out;
            text-align: center;
            border: 5px solid #ddd6fe;
            cursor: default;
        }

        .central-title { font-family: 'Playfair Display', serif; font-size: 1.6rem; font-weight: 700; line-height: 1.2; }
        .central-sub { font-size: 0.9rem; opacity: 0.9; margin-top: 5px; font-weight: 300; letter-spacing: 1px; color: #e9d5ff; }

        /* è¡›æ˜Ÿç¯€é» */
        .satellite {
            position: absolute;
            width: 115px; height: 115px;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 50%;
            color: var(--primary);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 0.85rem; font-weight: 600;
            z-index: 5;
            padding: 5px;
        }
        
        .satellite i { font-size: 1.6rem; margin-bottom: 5px; color: var(--accent); }
        .satellite span { font-size: 0.7rem; opacity: 0.8; display: block; margin-top: 2px; color: #555; }

        .satellite:hover {
            transform: scale(1.15) !important;
            background: var(--primary);
            color: white;
            border-color: var(--accent);
            box-shadow: 0 10px 25px rgba(91, 33, 182, 0.3);
            z-index: 20;
        }
        .satellite:hover i { color: var(--accent); }
        .satellite:hover span { color: rgba(255,255,255,0.9); }

        /* æ¸¬é©—ç¯€é»æ¨£å¼ */
        .satellite.quiz-node { border-color: var(--accent); }
        .satellite.quiz-node i { color: var(--primary); }
        .satellite.quiz-node:hover { background: var(--accent); border-color: var(--primary); }
        .satellite.quiz-node:hover i { color: var(--primary); }

        /* é€£æ¥ç·š */
        .connections { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2; }
        .conn-line { stroke: var(--primary); stroke-width: 1.5; stroke-dasharray: 4,4; opacity: 0.3; }

        /* --- 2. Modal (å…§å®¹å¡ç‰‡) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(46, 16, 101, 0.4);
            backdrop-filter: blur(5px);
            z-index: 100;
            opacity: 0; visibility: hidden;
            transition: all 0.4s ease;
            display: flex; justify-content: center; align-items: center;
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal-card {
            width: 90%; max-width: 1100px; height: 90vh;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow-float);
            display: flex; flex-direction: column;
            overflow: hidden;
            transform: translateY(30px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.active .modal-card { transform: translateY(0) scale(1); }

        .modal-header {
            background: linear-gradient(135deg, var(--primary), #7c3aed);
            color: white;
            padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 4px solid var(--accent);
        }
        
        .modal-title h2 { font-family: 'Playfair Display', serif; font-size: 1.6rem; margin: 0; border: none; padding: 0; color: white; }
        .modal-close { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; transition: 0.3s; }
        .modal-close:hover { transform: rotate(90deg); color: var(--accent); }

        /* åˆ†é å°èˆª */
        .modal-tabs {
            display: flex; background: #f3e8ff; overflow-x: auto;
            border-bottom: 1px solid #d8b4fe; flex-shrink: 0;
        }
        .tab-btn {
            flex: 1; padding: 1rem; border: none; background: none;
            color: #555; font-weight: 600; cursor: pointer;
            transition: 0.3s; min-width: 120px; white-space: nowrap;
            font-family: 'Lato', sans-serif; font-size: 0.95rem;
        }
        .tab-btn:hover { background: #ede9fe; color: var(--primary); }
        .tab-btn.active { background: white; color: var(--primary); border-bottom: 3px solid var(--primary); }

        /* å…§å®¹æ¨£å¼ (ç§»æ¤è‡ªæ‚¨çš„åŸæª”) */
        .modal-body { flex: 1; overflow-y: auto; padding: 2.5rem; scroll-behavior: smooth; line-height: 1.8; }
        
        h2 { font-family: 'Playfair Display', serif; color: var(--primary); font-size: 1.8rem; border-bottom: 1px solid rgba(91, 33, 182, 0.2); padding-bottom: 0.8rem; margin-bottom: 1.5rem; }
        h3 { color: #4c1d95; font-size: 1.3rem; margin: 1.5rem 0 1rem; font-weight: 700; display: flex; align-items: center; }
        h3 i { color: var(--accent); margin-right: 10px; font-size: 1.1rem; }

        /* è¡¨æ ¼ */
        table { width: 100%; border-collapse: collapse; margin: 1.5rem 0; font-size: 0.95rem; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; vertical-align: top; }
        th { background-color: #f3e8ff; color: var(--primary); font-weight: bold; border-bottom: 2px solid var(--primary); }
        tr:nth-child(even) { background-color: #fcfaff; }

        /* è¦å‰‡å€å¡Š */
        .rule-block { margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid #f0f0f0; }
        .rule-block:last-child { border-bottom: none; }
        
        .example-list { list-style: none; margin-top: 10px; }
        .example-item { margin-bottom: 1rem; padding-left: 1rem; position: relative; border-left: 3px solid #e5e7eb; padding: 10px 15px; transition: 0.3s; }
        .example-item:hover { border-left-color: var(--accent); background: #fafafa; }
        
        .en-sentence { font-size: 1.05rem; color: #2c3e50; font-weight: 500; margin-bottom: 4px; }
        .cn-trans { font-size: 0.9rem; color: #7f8c8d; }
        .highlight { color: var(--primary); font-weight: bold; background: rgba(245, 158, 11, 0.15); padding: 0 4px; border-radius: 2px; }

        /* å–®å­—é›² */
        .word-cloud { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 1.5rem; }
        .keyword-tag { background: #f3e8ff; color: var(--primary); padding: 5px 12px; border-radius: 4px; font-size: 0.9rem; font-weight: bold; border: 1px solid rgba(91, 33, 182, 0.2); }

        .note-box { background-color: #fffbeb; border-left: 4px solid var(--accent); padding: 1rem; margin: 1.5rem 0; color: #92400e; border-radius: 4px; }
        .intro-box { background-color: #f3e8ff; border-left: 4px solid var(--primary); padding: 1.5rem; border-radius: 4px; margin-top: 1rem; color: #4c1d95; }

        .audio-btn { background: none; border: none; color: var(--accent); cursor: pointer; margin-left: 8px; font-size: 1.1rem; transition: all 0.2s; vertical-align: middle; }
        .audio-btn:hover { color: var(--primary); transform: scale(1.15); }

        /* Quiz Styles */
        .quiz-container { max-width: 800px; margin: 0 auto; }
        .quiz-progress { margin-bottom: 1.5rem; color: #666; font-weight: 700; text-align: right; }
        .quiz-card-q { background: white; border-radius: 8px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .quiz-question { font-size: 1.2rem; font-weight: 700; color: var(--primary); margin-bottom: 1.5rem; border-left: 4px solid var(--accent); padding-left: 20px; line-height: 1.6; }
        .quiz-options { display: grid; gap: 12px; }
        .quiz-option { padding: 15px 20px; background: white; border: 2px solid #eef2f5; border-radius: 8px; cursor: pointer; transition: 0.2s; font-weight: 600; text-align: left; font-size: 1rem; }
        .quiz-option:hover:not(.disabled) { border-color: var(--primary); background: #f3e8ff; }
        .quiz-option.correct { background-color: var(--correct-bg); border-color: #28a745; color: var(--correct-text); }
        .quiz-option.incorrect { background-color: var(--wrong-bg); border-color: #dc3545; color: var(--wrong-text); opacity: 0.8; }
        .quiz-option.disabled { cursor: default; pointer-events: none; }
        
        .quiz-explanation { margin-top: 20px; padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 8px; border-left: 4px solid var(--accent); display: none; }
        .next-btn { margin-top: 20px; background: var(--primary); color: white; border: none; padding: 10px 25px; border-radius: 30px; cursor: pointer; display: none; font-weight: bold; box-shadow: 0 4px 10px rgba(91, 33, 182, 0.3); }
        
        .score-circle { width: 140px; height: 140px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 2rem; color: white; font-size: 3rem; font-weight: 800; box-shadow: 0 10px 30px rgba(91, 33, 182, 0.3); border: 4px solid var(--accent); }

        @keyframes pulse { 0%, 100% { box-shadow: 0 0 50px rgba(91, 33, 182, 0.4); } 50% { box-shadow: 0 0 70px rgba(91, 33, 182, 0.7); } }
    </style>
</head>
<body>

    <div id="mindmap-container">
        <svg class="connections" id="lines-svg"></svg>
        
        <div class="central-node">
            <div class="central-title">Shirley's Subjunctive</div>
            <div class="central-sub">è™›æ“¬èªæ°£</div>
        </div>

        <div class="satellite" onclick="openModal('intro')">
            <i class="fas fa-book-open"></i>
            <div>æ¦‚è«–<br><span>Introduction</span></div>
        </div>
        <div class="satellite" onclick="openModal('conditional')">
            <i class="fas fa-code-branch"></i>
            <div>æ¢ä»¶å¥<br><span>Conditionals</span></div>
        </div>
        <div class="satellite" onclick="openModal('mandative')">
            <i class="fas fa-gavel"></i>
            <div>æ„å¿—å‹•è©<br><span>Mandative</span></div>
        </div>
        <div class="satellite" onclick="openModal('wish')">
            <i class="fas fa-star"></i>
            <div>é¡˜æœ›èˆ‡ç‰¹æ®Š<br><span>Wish & Special</span></div>
        </div>
        <div class="satellite quiz-node" onclick="openModal('quiz')">
            <i class="fas fa-pencil-alt"></i>
            <div>è‡ªæˆ‘æª¢æ¸¬<br><span>Quiz (20)</span></div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-card">
            <header class="modal-header">
                <div class="modal-title"><h2>Shirley's Subjunctive Mood Platform</h2></div>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </header>
            <nav class="modal-tabs" id="modal-tabs"></nav>
            <div class="modal-body" id="modal-content"></div>
        </div>
    </div>

    <script>
        // --- 1. CONTENT DATA ---
        const contentData = {
            intro: {
                title: "æ¦‚è«– (Introduction)",
                html: `
                <h2>Introduction èªæ°£æ¦‚è«–</h2>
                <div class="rule-block">
                    <h3><i class="fas fa-book-open"></i> ä¸‰ç¨®åŸºæœ¬èªæ°£</h3>
                    <p>èªæ°£ (Mood) ç”¨ä¾†è¡¨ç¤ºèªªè©±è€…çš„æƒ…ç·’æˆ–æ…‹åº¦ï¼Œè‹±æ–‡ä¸­ä¸»è¦æœ‰ä¸‰ç¨®ï¼š</p>
                    <ul class="example-list">
                        <li class="example-item">
                            <strong>1. ç›´è¿° (Indicative)ï¼š</strong>ç”¨æ–¼é™³è¿°äº‹å¯¦ã€è©¢å•ã€‚
                        </li>
                        <li class="example-item">
                            <strong>2. ç¥ˆä½¿ (Imperative)ï¼š</strong>è¡¨é”è«‹æ±‚ã€å‘½ä»¤ã€å»ºè­°ã€‚
                        </li>
                        <li class="example-item">
                            <strong>3. å‡è¨­ (Subjunctive)ï¼š</strong>è¡¨é”å‘½ä»¤ã€å»ºè­°ã€è«‹æ±‚ã€æˆ–èˆ‡äº‹å¯¦ç›¸åçš„å‡è¨­ã€‚
                        </li>
                    </ul>
                </div>

                <div class="intro-box">
                    <strong><i class="fas fa-exclamation-triangle"></i> æ ¸å¿ƒè§€å¿µï¼š</strong>
                    <p>å› ç‚ºæ˜¯ã€Œå‡è¨­ã€èˆ‡ã€Œæƒ³åƒã€ï¼Œä¸¦éã€Œäº‹å¯¦ã€ï¼Œæ‰€ä»¥<strong>å‹•è©ä¸å—æ™‚æ…‹çš„é™åˆ¶</strong>ã€‚é€™æ˜¯è™›æ“¬èªæ°£æœ€ç‰¹åˆ¥ä¹Ÿæœ€å®¹æ˜“æ··æ·†çš„åœ°æ–¹ã€‚</p>
                </div>`
            },
            conditional: {
                title: "æ¢ä»¶å¥ (Conditionals)",
                html: `
                <h2>Conditional Sentences æ¢ä»¶å¥è§£æ</h2>
                
                <div style="overflow-x:auto;">
                    <table>
                        <thead>
                            <tr>
                                <th style="width:20%">é¡å‹</th>
                                <th style="width:30%">çµæ§‹</th>
                                <th style="width:50%">ä¾‹å¥</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Zero Conditional</strong><br>åŸºæœ¬äº‹å¯¦</td>
                                <td>If + Present, Present</td>
                                <td>
                                    <div class="en-sentence">If you heat ice, it melts. <button class="audio-btn" onclick="speak('If you heat ice, it melts.')"><i class="fas fa-volume-up"></i></button></div>
                                    <div class="cn-trans">æŠŠå†°åŠ ç†±ï¼Œå†°å°±æœƒèåŒ–ã€‚</div>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>First Conditional</strong><br>å°‡ä¾†å¯èƒ½ç™¼ç”Ÿ</td>
                                <td>If + Present, Will + V</td>
                                <td>
                                    <div class="en-sentence">You will miss the bus if you don't leave soon. <button class="audio-btn" onclick="speak('You will miss the bus if you do not leave soon.')"><i class="fas fa-volume-up"></i></button></div>
                                    <div class="cn-trans">ä½ å†ä¸èµ°å°±è¶•ä¸ä¸Šå·´å£«äº†ã€‚</div>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Second Conditional</strong><br>èˆ‡ç¾åœ¨/å°‡ä¾†äº‹å¯¦ç›¸å</td>
                                <td>If + Past, Would + V</td>
                                <td>
                                    <div class="en-sentence">If I inherited a billion dollars, I would travel to the moon. <button class="audio-btn" onclick="speak('If I inherited a billion dollars, I would travel to the moon.')"><i class="fas fa-volume-up"></i></button></div>
                                    <div class="cn-trans">å¦‚æœæˆ‘ç¹¼æ‰¿äº†10å„„å…ƒï¼Œæˆ‘å°±æœƒåˆ°æœˆçƒå»æ—…è¡Œã€‚</div>
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Third Conditional</strong><br>èˆ‡éå»äº‹å¯¦ç›¸å</td>
                                <td>If + Past Perfect, Would have + p.p.</td>
                                <td>
                                    <div class="en-sentence">She would have gone to your birthday party if she hadn't been sick. <button class="audio-btn" onclick="speak('She would have gone to your birthday party if she had not been sick.')"><i class="fas fa-volume-up"></i></button></div>
                                    <div class="cn-trans">å¥¹å¦‚æœæ²’æœ‰ç”Ÿç—…ï¼Œå°±å»ä½ çš„ç”Ÿæ—¥æœƒäº†ã€‚</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="rule-block">
                    <h3><i class="fas fa-random"></i> çœç•¥ If çš„å€’è£ (Inversion)</h3>
                    <ul class="example-list">
                        <li class="example-item">
                            <div class="en-sentence">If I were you... â†’ <span class="highlight">Were I you</span>, I wouldn't get involved. <button class="audio-btn" onclick="speak('Were I you, I would not get involved.')"><i class="fas fa-volume-up"></i></button></div>
                        </li>
                        <li class="example-item">
                            <div class="en-sentence">If I had known... â†’ <span class="highlight">Had I known</span>, I would have offered help. <button class="audio-btn" onclick="speak('Had I known, I would have offered help.')"><i class="fas fa-volume-up"></i></button></div>
                        </li>
                        <li class="example-item">
                            <div class="en-sentence">If you should have... â†’ <span class="highlight">Should you have</span> any questions, please email me. <button class="audio-btn" onclick="speak('Should you have any questions, please email me.')"><i class="fas fa-volume-up"></i></button></div>
                        </li>
                    </ul>
                </div>`
            },
            mandative: {
                title: "æ„å¿—å‹•è© (Mandative)",
                html: `
                <h2>Mandative Subjunctive æ„å¿—å‹•è©èˆ‡åè©å­å¥</h2>
                <div class="note-box">
                    <strong>è¦å‰‡ï¼š</strong> è¡¨ç¤ºã€Œè¦æ±‚ã€å‘½ä»¤ã€å»ºè­°ã€å …æŒã€çš„å‹•è©/åè©/å½¢å®¹è©ï¼Œå¾Œæ¥ that å­å¥æ™‚ï¼Œå‹•è©ä¸€å¾‹ä½¿ç”¨ <strong>åŸå½¢å‹•è© (Base Form)</strong>ã€‚(çœç•¥ should)
                </div>

                <div class="rule-block">
                    <h3><i class="fas fa-play-circle"></i> å‹•è© (Verbs)</h3>
                    <div class="word-cloud">
                        <span class="keyword-tag">advise</span> <span class="keyword-tag">demand</span> <span class="keyword-tag">suggest</span>
                        <span class="keyword-tag">recommend</span> <span class="keyword-tag">require</span> <span class="keyword-tag">insist</span>
                        <span class="keyword-tag">order</span> <span class="keyword-tag">urge</span> <span class="keyword-tag">request</span>
                    </div>
                    <ul class="example-list">
                        <li class="example-item">
                            <div class="en-sentence">I suggest that he <span class="highlight">study</span> for the exam. <button class="audio-btn" onclick="speak('I suggest that he study for the exam.')"><i class="fas fa-volume-up"></i></button></div>
                        </li>
                        <li class="example-item">
                            <div class="en-sentence">The citizens require that the bars <span class="highlight">be closed</span> before 1 am. <button class="audio-btn" onclick="speak('The citizens require that the bars be closed before 1 am.')"><i class="fas fa-volume-up"></i></button></div>
                        </li>
                    </ul>
                </div>

                <div class="rule-block">
                    <h3><i class="fas fa-book"></i> åè© (Nouns)</h3>
                    <div class="word-cloud">
                        <span class="keyword-tag">suggestion</span> <span class="keyword-tag">proposal</span> <span class="keyword-tag">demand</span>
                        <span class="keyword-tag">request</span> <span class="keyword-tag">order</span>
                    </div>
                    <ul class="example-list">
                        <li class="example-item">
                            <div class="en-sentence">They made a suggestion that we <span class="highlight">be</span> early. <button class="audio-btn" onclick="speak('They made a suggestion that we be early.')"><i class="fas fa-volume-up"></i></button></div>
                        </li>
                    </ul>
                </div>

                <div class="rule-block">
                    <h3><i class="fas fa-star"></i> å½¢å®¹è© (Adjectives)</h3>
                    <div class="word-cloud">
                        <span class="keyword-tag">important</span> <span class="keyword-tag">essential</span> <span class="keyword-tag">vital</span>
                        <span class="keyword-tag">necessary</span> <span class="keyword-tag">urgent</span> <span class="keyword-tag">advisable</span>
                    </div>
                    <ul class="example-list">
                        <li class="example-item">
                            <div class="en-sentence">It is advisable that she <span class="highlight">take</span> a vacation. <button class="audio-btn" onclick="speak('It is advisable that she take a vacation.')"><i class="fas fa-volume-up"></i></button></div>
                        </li>
                    </ul>
                </div>`
            },
            wish: {
                title: "é¡˜æœ›èˆ‡ç‰¹æ®Š (Wish & Special)",
                html: `
                <h2>Wish & Special Structures</h2>
                
                <div class="rule-block">
                    <h3><i class="fas fa-magic"></i> Wish çš„ç”¨æ³•</h3>
                    <ul class="example-list">
                        <li class="example-item">
                            <strong>èˆ‡ç¾åœ¨ç›¸å (Past Simple)ï¼š</strong>
                            <div class="en-sentence">I wish I <span class="highlight">were</span> home. <button class="audio-btn" onclick="speak('I wish I were home.')"><i class="fas fa-volume-up"></i></button></div>
                            <div class="cn-trans">(be å‹•è©ä¸€å¾‹ç”¨ were)</div>
                        </li>
                        <li class="example-item">
                            <strong>èˆ‡éå»ç›¸å (Past Perfect)ï¼š</strong>
                            <div class="en-sentence">I wish I <span class="highlight">had not left</span> my laptop. <button class="audio-btn" onclick="speak('I wish I had not left my laptop.')"><i class="fas fa-volume-up"></i></button></div>
                        </li>
                        <li class="example-item">
                            <strong>èˆ‡å°‡ä¾†ç›¸å (Would/Could)ï¼š</strong>
                            <div class="en-sentence">I wish it <span class="highlight">would rain</span> tomorrow. <button class="audio-btn" onclick="speak('I wish it would rain tomorrow.')"><i class="fas fa-volume-up"></i></button></div>
                        </li>
                    </ul>
                </div>

                <div class="rule-block">
                    <h3><i class="fas fa-clock"></i> It's time / It's high time</h3>
                    <p>è¡¨é”ã€Œæ—©è©²åšè€Œæœªåšã€çš„æ€¥è¿«æ„Ÿï¼Œå­å¥ç”¨<strong>éå»å¼</strong>ã€‚</p>
                    <ul class="example-list">
                        <li class="example-item"><div class="en-sentence">Itâ€™s time we <span class="highlight">went</span> home. <button class="audio-btn" onclick="speak('It is time we went home.')"><i class="fas fa-volume-up"></i></button></div></li>
                        <li class="example-item"><div class="en-sentence">Itâ€™s high time I <span class="highlight">bought</span> a new computer. <button class="audio-btn" onclick="speak('It is high time I bought a new computer.')"><i class="fas fa-volume-up"></i></button></div></li>
                    </ul>
                </div>

                <div class="rule-block">
                    <h3><i class="fas fa-balance-scale"></i> Would rather</h3>
                    <p>è¡¨é”ã€Œå¯§é¡˜ã€ï¼Œè‹¥ä¸»è©ä¸åŒï¼Œå­å¥ç”¨<strong>éå»å¼</strong>(è¡¨ç¾åœ¨)æˆ–<strong>éå»å®Œæˆå¼</strong>(è¡¨éå»)ã€‚</p>
                    <ul class="example-list">
                        <li class="example-item"><div class="en-sentence">I would rather you <span class="highlight">came</span> another time. <button class="audio-btn" onclick="speak('I would rather you came another time.')"><i class="fas fa-volume-up"></i></button></div></li>
                    </ul>
                </div>`
            },
            quiz: {
                title: "è‡ªæˆ‘æª¢æ¸¬",
                html: `<div id="quiz-interface" class="quiz-container">
                    <div class="quiz-progress">Question <span id="current-question-num">1</span> of 20</div>
                    <div id="quiz-question-container"></div>
                </div>
                <div id="quiz-score" class="quiz-result" style="display: none;">
                    <div class="score-circle" id="score-val">0</div>
                    <h2>Quiz Completed!</h2>
                    <p id="score-msg" style="margin:20px 0; font-size:1.1rem; color:#666;"></p>
                    <button class="next-btn" style="display:inline-block;" onclick="initQuiz()"><i class="fas fa-redo"></i> Restart Quiz</button>
                </div>`
            }
        };

        // --- 2. QUIZ DATA (100% Preserved) ---
        const quizQuestions = [
            { question: "1. If I ______ (be) you, I would accept the offer.", options: ["am", "was", "were", "been"], correct: 2, explanation: "<strong>Explanation:</strong> In the second conditional, 'were' is used for all subjects." },
            { question: "2. I suggest that he ______ (go) to the doctor.", options: ["goes", "go", "went", "going"], correct: 1, explanation: "<strong>Explanation:</strong> Mandative subjunctive: suggest + that + S + (should) V." },
            { question: "3. It is essential that she ______ (be) on time.", options: ["is", "was", "be", "being"], correct: 2, explanation: "<strong>Explanation:</strong> Adjectives of necessity + that + S + (should) V." },
            { question: "4. I wish I ______ (know) the answer now.", options: ["know", "knew", "known", "have known"], correct: 1, explanation: "<strong>Explanation:</strong> Wish + past simple expresses a desire for a different present situation." },
            { question: "5. If it ______ (rain) tomorrow, we will cancel the picnic.", options: ["rains", "rained", "rain", "will rain"], correct: 0, explanation: "<strong>Explanation:</strong> First conditional: If + present simple." },
            { question: "6. Had I known, I ______ (help) you.", options: ["would help", "will help", "would have helped", "helped"], correct: 2, explanation: "<strong>Explanation:</strong> Third conditional inversion: Had I known... would have + p.p." },
            { question: "7. It's high time we ______ (leave).", options: ["leave", "left", "leaving", "have left"], correct: 1, explanation: "<strong>Explanation:</strong> 'It's high time' + past simple." },
            { question: "8. The boss insisted that Mark ______ (finish) the report.", options: ["finished", "finishes", "finish", "has finished"], correct: 2, explanation: "<strong>Explanation:</strong> 'Insist' triggers the subjunctive mood (base form)." },
            { question: "9. ______ (Be) I rich, I would buy a boat.", options: ["Am", "Was", "Were", "If"], correct: 2, explanation: "<strong>Explanation:</strong> Inversion of 'If I were rich' â†’ 'Were I rich'." },
            { question: "10. I would rather you ______ (stay) here tonight.", options: ["stay", "stayed", "staying", "will stay"], correct: 1, explanation: "<strong>Explanation:</strong> 'Would rather' + different subject + past simple." },
            { question: "11. If I ______ (have) enough money, I would buy a car.", options: ["have", "had", "has", "having"], correct: 1, explanation: "<strong>Explanation:</strong> Second conditional: If + past simple." },
            { question: "12. Unless he ______ (hurry), he will be late.", options: ["hurries", "hurried", "hurry", "will hurry"], correct: 0, explanation: "<strong>Explanation:</strong> First conditional: Unless + present simple." },
            { question: "13. ______ (Should) you need help, please call me.", options: ["If", "Should", "Were", "Had"], correct: 1, explanation: "<strong>Explanation:</strong> Inversion of 'If you should need help'." },
            { question: "14. It is important that he ______ (not/be) late.", options: ["is not", "was not", "not be", "not being"], correct: 2, explanation: "<strong>Explanation:</strong> Subjunctive negative form: 'not + base verb'." },
            { question: "15. I demand that the truth ______ (tell).", options: ["be told", "is told", "was told", "told"], correct: 0, explanation: "<strong>Explanation:</strong> Passive subjunctive: 'be + p.p.'." },
            { question: "16. If she ______ (study) harder, she would have passed.", options: ["studies", "studied", "had studied", "has studied"], correct: 2, explanation: "<strong>Explanation:</strong> Third conditional: If + past perfect." },
            { question: "17. I wish I ______ (can) speak French.", options: ["can", "could", "will", "would"], correct: 1, explanation: "<strong>Explanation:</strong> Wish + could expresses ability in the present." },
            { question: "18. The law requires that everyone ______ (wear) a seatbelt.", options: ["wears", "wore", "wear", "wearing"], correct: 2, explanation: "<strong>Explanation:</strong> 'Require' triggers the subjunctive mood." },
            { question: "19. If only I ______ (listen) to your advice!", options: ["listen", "listened", "had listened", "have listened"], correct: 2, explanation: "<strong>Explanation:</strong> 'If only' with past perfect expresses regret about the past." },
            { question: "20. I propose that the meeting ______ (postpone).", options: ["is postponed", "be postponed", "was postponed", "postponed"], correct: 1, explanation: "<strong>Explanation:</strong> Passive subjunctive: 'be + p.p.' after 'propose'." }
        ];

        // --- 3. SYSTEM LOGIC ---
        function layoutSatellites() {
            const satellites = document.querySelectorAll('.satellite');
            const svg = document.getElementById('lines-svg');
            while (svg.firstChild) svg.removeChild(svg.firstChild);

            const radius = 230; 
            const startAngle = -90; 
            const total = satellites.length;
            const cx = window.innerWidth / 2;
            const cy = window.innerHeight / 2;

            satellites.forEach((sat, i) => {
                const angle = startAngle + (i * (360 / total));
                const rad = angle * (Math.PI / 180);
                const x = Math.cos(rad) * radius;
                const y = Math.sin(rad) * radius;

                sat.style.left = `calc(50% + ${x}px - 60px)`; 
                sat.style.top = `calc(50% + ${y}px - 60px)`;

                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", "50%"); line.setAttribute("y1", "50%");
                line.setAttribute("x2", cx + x); line.setAttribute("y2", cy + y);
                line.classList.add("conn-line");
                svg.appendChild(line);
            });
        }
        
        window.addEventListener('resize', layoutSatellites);
        window.addEventListener('load', layoutSatellites);

        const tabKeys = ['intro', 'conditional', 'mandative', 'wish', 'quiz'];

        function openModal(activeKey) {
            const modal = document.getElementById('modal-overlay');
            const tabsContainer = document.getElementById('modal-tabs');
            
            tabsContainer.innerHTML = tabKeys.map(key => {
                const isQuiz = key === 'quiz';
                return `<button class="tab-btn ${key === activeKey ? 'active' : ''}" 
                        onclick="switchTab('${key}', this)">
                        ${isQuiz ? '<i class="fas fa-pencil-alt"></i> ' : ''}${contentData[key].title}
                        </button>`;
            }).join('');

            loadContent(activeKey);
            modal.classList.add('active');
        }

        function closeModal() { document.getElementById('modal-overlay').classList.remove('active'); }

        function switchTab(key, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            loadContent(key);
        }

        function loadContent(key) {
            const contentDiv = document.getElementById('modal-content');
            contentDiv.innerHTML = contentData[key].html;
            if(key === 'quiz') initQuiz();
        }

        function speak(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'en-US'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        }

        // Quiz Logic
        let currentQIndex = 0;
        let score = 0;
        let answered = false;

        function initQuiz() {
            currentQIndex = 0; score = 0;
            document.getElementById('quiz-interface').style.display = 'block';
            document.getElementById('quiz-score').style.display = 'none';
            showQuestion(0);
        }

        function showQuestion(index) {
            answered = false;
            const container = document.getElementById('quiz-question-container');
            const q = quizQuestions[index];
            
            container.innerHTML = `
                <div class="quiz-card-q">
                    <div class="quiz-question">${q.question}</div>
                    <div class="quiz-options">
                        ${q.options.map((opt, i) => `
                            <div class="quiz-option" onclick="handleAnswer(this, ${i})">${opt}</div>
                        `).join('')}
                    </div>
                    <div class="quiz-explanation" id="explanation">${q.explanation}</div>
                    <button class="next-btn" id="next-btn" onclick="nextQ()">Next <i class="fas fa-arrow-right"></i></button>
                </div>
            `;
            document.getElementById('current-question-num').innerText = index + 1;
        }

        function handleAnswer(btn, selectedIndex) {
            if (answered) return;
            answered = true;
            const q = quizQuestions[currentQIndex];
            const allBtns = document.querySelectorAll('.quiz-option');
            
            if (selectedIndex === q.correct) {
                btn.classList.add('correct');
                score++;
            } else {
                btn.classList.add('incorrect');
                allBtns[q.correct].classList.add('correct');
            }
            
            allBtns.forEach(b => b.classList.add('disabled'));
            document.getElementById('explanation').style.display = 'block';
            document.getElementById('next-btn').style.display = 'inline-block';
        }

        function nextQ() {
            currentQIndex++;
            if (currentQIndex < quizQuestions.length) {
                showQuestion(currentQIndex);
            } else {
                showResult();
            }
        }

        function showResult() {
            document.getElementById('quiz-interface').style.display = 'none';
            const resDiv = document.getElementById('quiz-score');
            resDiv.style.display = 'block';
            document.getElementById('score-val').innerText = score;
            const msg = document.getElementById('score-msg');
            
            if (score >= 18) msg.textContent = "Excellent! You are a master of Subjunctive! ğŸ†";
            else if (score >= 12) msg.textContent = "Good job! Keep practicing. ğŸ‘";
            else msg.textContent = "Review the rules and try again! ğŸ’ª";
        }
    </script>
</body>
</html>
