<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shirley's Adjective Clauses (Radial Design)</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* é…è‰²æ–¹æ¡ˆï¼šRoyal Amethyst (çš‡å®¶ç´«æ°´æ™¶) - ä¿ç•™æ‚¨åŸæª”çš„è‰²èª¿ */
            --bg-deep: #faf5ff;       /* æ¥µæ·ºç´«èƒŒæ™¯ */
            --primary: #7e22ce;       /* çš‡å®¶ç´« */
            --primary-dark: #2e1065;  /* æ·±é‚ƒé›ç´« */
            --accent: #f59e0b;        /* ç¥ç€é‡‘ (å¼·èª¿è‰²) */
            
            --card-bg: rgba(255, 255, 255, 0.98);
            --shadow-float: 0 10px 40px -10px rgba(46, 16, 101, 0.2);
            --highlight-bg: #f3e8ff;

            /* æ¸¬é©—å°ˆç”¨è‰² */
            --correct-bg: #dcfce7;
            --correct-text: #166534;
            --wrong-bg: #fee2e2;
            --wrong-text: #991b1b;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-deep);
            color: #3b0764; /* æ·±ç´«é»‘æ–‡å­— */
            overflow: hidden; 
            height: 100vh; width: 100vw;
        }

        /* --- 1. Radial Mind Map (æ”¾å°„ç‹€é¦–é ) --- */
        #mindmap-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
            z-index: 1;
        }

        /* ä¸­å¿ƒç¯€é» */
        .central-node {
            width: 190px; height: 190px;
            background: var(--primary-dark);
            border-radius: 50%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            color: white;
            box-shadow: 0 0 40px rgba(126, 34, 206, 0.5);
            z-index: 10;
            position: relative;
            animation: pulse 3s infinite ease-in-out;
            text-align: center;
            border: 4px solid #e9d5ff;
            cursor: default;
        }

        .central-title { font-family: 'Playfair Display', serif; font-size: 1.5rem; font-weight: 700; line-height: 1.2; }
        .central-sub { font-size: 0.8rem; opacity: 0.8; margin-top: 5px; font-weight: 300; letter-spacing: 1px; }

        /* è¡›æ˜Ÿç¯€é» */
        .satellite {
            position: absolute;
            width: 120px; height: 120px;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 50%;
            color: var(--primary-dark);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 0.9rem; font-weight: 600;
            z-index: 5;
            padding: 5px;
        }
        
        .satellite i { font-size: 1.6rem; margin-bottom: 5px; color: var(--primary); }
        .satellite span { font-size: 0.7rem; opacity: 0.7; display: block; margin-top: 3px; }

        .satellite:hover {
            transform: scale(1.15) !important;
            background: var(--primary);
            color: white;
            border-color: var(--primary-dark);
            box-shadow: 0 10px 25px rgba(126, 34, 206, 0.4);
            z-index: 20;
        }
        .satellite:hover i { color: white; }

        /* æ¸¬é©—ç¯€é»æ¨£å¼ */
        .satellite.quiz-node { border-color: var(--accent); color: #b45309; }
        .satellite.quiz-node i { color: var(--accent); }
        .satellite.quiz-node:hover { background: var(--accent); color: white; border-color: #92400e; }
        .satellite.quiz-node:hover i { color: white; }

        /* é€£æ¥ç·š */
        .connections { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 2; }
        .conn-line { stroke: var(--primary); stroke-width: 1.5; stroke-dasharray: 4,4; opacity: 0.3; }

        /* --- 2. Modal (å…§å®¹å¡ç‰‡) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(46, 16, 101, 0.3);
            backdrop-filter: blur(5px);
            z-index: 100;
            opacity: 0; visibility: hidden;
            transition: all 0.4s ease;
            display: flex; justify-content: center; align-items: center;
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal-card {
            width: 90%; max-width: 1000px; height: 90vh;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow-float);
            display: flex; flex-direction: column;
            overflow: hidden;
            transform: translateY(30px) scale(0.95);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.active .modal-card { transform: translateY(0) scale(1); }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 3px solid var(--accent);
        }
        
        .modal-title h2 { font-family: 'Playfair Display', serif; font-size: 1.6rem; margin: 0; border: none; padding: 0; color: white; }
        .modal-close { background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; transition: 0.3s; }
        .modal-close:hover { transform: rotate(90deg); color: var(--accent); }

        /* åˆ†é å°èˆª */
        .modal-tabs {
            display: flex; background: #f3e8ff; overflow-x: auto;
            border-bottom: 1px solid #d8b4fe; flex-shrink: 0;
        }
        .tab-btn {
            flex: 1; padding: 1rem; border: none; background: none;
            color: var(--primary-dark); font-weight: 600; cursor: pointer;
            transition: 0.3s; min-width: 130px; white-space: nowrap;
            font-family: 'Noto Sans TC', sans-serif;
        }
        .tab-btn:hover { background: #e9d5ff; }
        .tab-btn.active { background: white; color: var(--primary); border-bottom: 3px solid var(--primary); }

        /* å…§å®¹æ¨£å¼ (ç§»æ¤è‡ªæ‚¨çš„åŸæª”ï¼Œä¿æŒä¸€è‡´æ€§) */
        .modal-body { flex: 1; overflow-y: auto; padding: 2.5rem; scroll-behavior: smooth; line-height: 1.8; }
        
        h2 { font-family: 'Playfair Display', serif; color: var(--primary-dark); font-size: 1.8rem; border-bottom: 2px solid var(--accent); padding-bottom: 0.5rem; margin-bottom: 1.5rem; }
        h3 { color: var(--primary); font-size: 1.4rem; margin: 2rem 0 1rem 0; font-weight: 700; display: flex; align-items: center; }
        h3 i { margin-right: 10px; }
        h4 { color: #3b0764; font-size: 1.1rem; margin: 1.5rem 0 0.8rem 0; font-weight: 600; background-color: var(--highlight-bg); padding: 0.6rem 1rem; border-left: 4px solid var(--primary); border-radius: 0 4px 4px 0; }
        
        ul { list-style: none; padding-left: 0.5rem; }
        li { margin-bottom: 0.8rem; position: relative; padding-left: 0.5rem; }
        .structure { font-family: 'Courier New', monospace; background-color: #f3e8ff; padding: 4px 8px; border-radius: 4px; color: #6b21a8; font-weight: 700; font-size: 1.1em; display: inline-block; margin-bottom: 5px; border: 1px solid #d8b4fe; }

        /* ä¾‹å¥æ¨£å¼ */
        .example-box { background-color: #faf5ff; border-left: 3px solid var(--accent); padding: 1rem 1.2rem; margin: 0.8rem 0 1.2rem 0; border-radius: 0 6px 6px 0; position: relative; transition: background-color 0.2s; }
        .example-box:hover { background-color: #f3e8ff; }
        
        .small-example { background-color: #fff; border: 1px solid #e9d5ff; border-left: 3px solid #d8b4fe; padding: 0.8rem; margin-top: 5px; border-radius: 0 4px 4px 0; position: relative; }
        .comparison-box { background-color: #fff; border: 1px solid #e2e8f0; border-left: 4px solid #f97316; padding: 1.2rem; margin: 1rem 0; border-radius: 6px; position: relative; }
        
        .en-sentence { font-weight: 600; color: #1e293b; font-size: 1.05rem; display: block; margin-bottom: 0.4rem; padding-right: 30px; }
        .ch-translation { color: #64748b; font-size: 0.95rem; }
        
        .speaker-btn { position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--primary); cursor: pointer; font-size: 1.1rem; opacity: 0.7; }
        .speaker-btn:hover { opacity: 1; transform: scale(1.1); color: var(--primary-dark); }
        .small-example .speaker-btn { top: 0.8rem; right: 0.5rem; }

        .note-box { background-color: #fffbeb; border: 1px solid #fcd34d; border-radius: 8px; padding: 1.2rem; margin: 1.5rem 0; color: #92400e; }
        .note-title { font-weight: bold; margin-bottom: 0.5rem; display: flex; align-items: center; }
        .kw { color: var(--primary); font-weight: bold; }

        /* Quiz Styles */
        .quiz-container { margin-top: 1rem; }
        .quiz-progress { margin-bottom: 1.5rem; color: #6b21a8; font-weight: 600; text-align: right; }
        .quiz-question { font-size: 1.2rem; font-weight: 600; margin-bottom: 1.5rem; line-height: 1.6; }
        .quiz-options { display: flex; flex-direction: column; gap: 10px; }
        
        .option-btn { padding: 1rem; border: 2px solid #e2e8f0; background: #fff; border-radius: 8px; text-align: left; cursor: pointer; font-size: 1rem; color: #3b0764; transition: 0.2s; font-family: inherit; }
        .option-btn:hover:not(:disabled) { border-color: var(--primary); background-color: #f3e8ff; }
        .option-btn.correct { background-color: var(--correct-bg); border-color: var(--correct-text); color: var(--correct-text); }
        .option-btn.wrong { background-color: var(--wrong-bg); border-color: var(--wrong-text); color: var(--wrong-text); }
        
        .feedback-area { margin-top: 1.5rem; padding: 1rem; border-radius: 8px; background-color: #f8fafc; border-left: 4px solid var(--accent); display: none; }
        .next-btn { margin-top: 1.5rem; background-color: var(--primary); color: white; border: none; padding: 0.8rem 2rem; border-radius: 30px; font-size: 1rem; cursor: pointer; display: none; }
        .score-card { text-align: center; padding: 2rem; display: none; }
        .final-score { font-size: 3rem; color: var(--primary); font-weight: 700; margin: 1rem 0; font-family: 'Playfair Display', serif; }

        @keyframes pulse { 0%, 100% { box-shadow: 0 0 40px rgba(126, 34, 206, 0.5); } 50% { box-shadow: 0 0 60px rgba(126, 34, 206, 0.8); } }
    </style>
</head>
<body>

    <div id="mindmap-container">
        <svg class="connections" id="lines-svg"></svg>
        
        <div class="central-node">
            <div class="central-title">Shirley's Adjective<br>Clauses</div>
            <div class="central-sub">å½¢å®¹è©å­å¥</div>
        </div>

        <div class="satellite" onclick="openModal('intro')">
            <i class="fas fa-shapes"></i>
            <div>æ¦‚è«–èˆ‡ä»£åè©<br><span>Intro</span></div>
        </div>
        <div class="satellite" onclick="openModal('adverbs')">
            <i class="fas fa-map-marker-alt"></i>
            <div>é—œä¿‚å‰¯è©<br><span>Adverbs</span></div>
        </div>
        <div class="satellite" onclick="openModal('commas')">
            <i class="fas fa-quote-left"></i>
            <div>é™å®š vs éé™å®š<br><span>Restrictive</span></div>
        </div>
        <div class="satellite" onclick="openModal('that-only')">
            <i class="fas fa-exclamation-circle"></i>
            <div>åªèƒ½ç”¨ That<br><span>Special Case</span></div>
        </div>
        <div class="satellite" onclick="openModal('reduction')">
            <i class="fas fa-compress-arrows-alt"></i>
            <div>å­å¥ç°¡åŒ–<br><span>Reduction</span></div>
        </div>
        <div class="satellite quiz-node" onclick="openModal('quiz')">
            <i class="fas fa-pencil-alt"></i>
            <div>éš¨å ‚æ¸¬é©—<br><span>Quiz</span></div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-card">
            <header class="modal-header">
                <div class="modal-title"><h2>Shirley's Adjective Clauses</h2></div>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </header>
            <nav class="modal-tabs" id="modal-tabs"></nav>
            <div class="modal-body" id="modal-content"></div>
        </div>
    </div>

    <script>
        // --- 1. CONTENT DATA (100% åŸå…§å®¹ä¿ç•™) ---
        const contentData = {
            intro: {
                title: "æ¦‚è«–èˆ‡ä»£åè©",
                html: `
                <h2>I. æ¦‚è«–èˆ‡é—œä¿‚ä»£åè©</h2>
                <p><strong>å½¢å®¹è©å­å¥</strong>ï¼ˆåˆç¨±é—œä¿‚å­å¥ï¼‰ï¼Œç”±é—œä¿‚ä»£åè© (who, whom, whose, which, that) æˆ–é—œä¿‚å‰¯è© (when, where, why) æ‰€å¼•å°ï¼Œç”¨æ–¼ä¿®é£¾ä¸€å€‹å…ˆå‰å‡ºç¾çš„åè©ï¼Œåˆç¨±<strong>å…ˆè¡Œè©</strong>ã€‚</p>
                
                <h3>ç”±é—œä¿‚ä»£åè©å¼•å°</h3>
                
                <h4>1. who, whom, that (å…ˆè¡Œè©ç‚ºäºº)</h4>
                
                <div class="example-box">
                    <span class="en-sentence">She is a teacher <span class="kw">who</span> teaches English writing.</span>
                    <span class="ch-translation">å¥¹æ˜¯ä¸€ä½æ•™è‹±æ–‡å¯«ä½œçš„è€å¸«ã€‚(who ä½œä¸»è©ï¼Œå¯ç”¨ that ä»£æ›¿ï¼Œä¸å¯çœç•¥)</span>
                    <button class="speaker-btn" onclick="speakText('She is a teacher who teaches English writing')"><i class="fas fa-volume-up"></i></button>
                </div>
                
                <div class="example-box">
                    <span class="en-sentence">She is a teacher <span class="kw">whom</span> many of her students respect.</span>
                    <span class="ch-translation">å¥¹æ˜¯ä¸€ä½è¨±å¤šå­¸ç”Ÿéƒ½å°Šæ•¬çš„è€å¸«ã€‚(whom ä½œå—è©ï¼Œå¯ç”¨ that ä»£æ›¿ï¼Œä¹Ÿå¯çœç•¥)</span>
                    <button class="speaker-btn" onclick="speakText('She is a teacher whom many of her students respect')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div class="example-box">
                    <span class="en-sentence">Young people <span class="kw">who</span> abuse their aged parents should be condemned.</span>
                    <span class="ch-translation">è™å¾…å¹´é‚çˆ¶æ¯çš„å¹´è¼•äººæ‡‰è©²å—åˆ°è­´è²¬ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('Young people who abuse their aged parents should be condemned')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div class="example-box">
                    <span class="en-sentence">A patient to <span class="kw">whom</span> doctors tell white lies may enjoy a longer life.</span>
                    <span class="ch-translation">é†«ç”Ÿå°å…¶èªªå–„æ„è¬Šè¨€çš„ç—…äººå¯èƒ½æœƒæ´»å¾—æ›´ä¹…ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('A patient to whom doctors tell white lies may enjoy a longer life')"><i class="fas fa-volume-up"></i></button>
                </div>

                <h4>2. whose (æ‰€æœ‰æ ¼ï¼š... çš„)</h4>
                
                <div class="example-box">
                    <span class="en-sentence">The students <span class="kw">whose</span> English grammar is weak will find English writing particularly challenging.</span>
                    <span class="ch-translation">è‹±æ–‡æ–‡æ³•è¼ƒå¼±çš„å­¸ç”Ÿæœƒç™¼ç¾è‹±æ–‡å¯«ä½œç‰¹åˆ¥å…·æŒ‘æˆ°æ€§ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('The students whose English grammar is weak will find English writing particularly challenging')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div class="example-box">
                    <span class="en-sentence">Her brother, <span class="kw">whose</span> hair is long, is a professional dancer.</span>
                    <span class="ch-translation">å¥¹çš„å“¥å“¥ï¼ˆç•™è‘—é•·é«®ï¼‰æ˜¯ä¸€ä½è·æ¥­èˆè€…ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('Her brother, whose hair is long, is a professional dancer')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div class="example-box">
                    <span class="en-sentence">The house <span class="kw">whose</span> roof is old belongs to the government.</span>
                    <span class="ch-translation">é‚£é–“å±‹é ‚è€èˆŠçš„æˆ¿å­å±¬æ–¼æ”¿åºœã€‚</span>
                    <button class="speaker-btn" onclick="speakText('The house whose roof is old belongs to the government')"><i class="fas fa-volume-up"></i></button>
                </div>

                <h4>3. which, that (å…ˆè¡Œè©ç‚ºç‰©)</h4>
                
                <div class="example-box">
                    <span class="en-sentence">I like the dress <span class="kw">that/which</span> my brother brought me.</span>
                    <span class="ch-translation">æˆ‘å–œæ­¡æˆ‘å“¥å“¥å¸¶çµ¦æˆ‘çš„é‚£ä»¶æ´‹è£ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('I like the dress that my brother brought me')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div class="example-box">
                    <span class="en-sentence">We live in Taiwan, <span class="kw">which</span> has a variety of delicious foods.</span>
                    <span class="ch-translation">æˆ‘å€‘ä½åœ¨å°ç£ï¼Œé€™è£¡æœ‰å„ç¨®ç¾å‘³çš„é£Ÿç‰©ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('We live in Taiwan, which has a variety of delicious foods')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div class="example-box">
                    <span class="en-sentence">I bought a new computer <span class="kw">that</span> is not very expensive.</span>
                    <span class="ch-translation">æˆ‘è²·äº†ä¸€å°ä¸æ˜¯å¾ˆè²´çš„æ–°é›»è…¦ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('I bought a new computer that is not very expensive')"><i class="fas fa-volume-up"></i></button>
                </div>`
            },
            adverbs: {
                title: "é—œä¿‚å‰¯è©",
                html: `
                <h2>II. ç”±é—œä¿‚å‰¯è©å¼•å°</h2>
                <p>ç”¨æ–¼ä¿®é£¾åœ°é»ã€æ™‚é–“ã€åŸå› ã€‚</p>

                <h4>1. Where (ä¿®é£¾åœ°é»)</h4>
                <div class="example-box">
                    <span class="en-sentence">I come from New Zealand, a country <span class="kw">where</span> there are more sheep than people.</span>
                    <span class="ch-translation">æˆ‘ä¾†è‡ªç´è¥¿è˜­ï¼Œä¸€å€‹ç¾Šæ¯”äººå¤šçš„åœ‹å®¶ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('I come from New Zealand, a country where there are more sheep than people')"><i class="fas fa-volume-up"></i></button>
                </div>
                <div class="example-box">
                    <span class="en-sentence">They had a meal at the bar <span class="kw">where</span> they met each other the first time two years ago.</span>
                    <span class="ch-translation">ä»–å€‘åœ¨å…©å¹´å‰ç¬¬ä¸€æ¬¡ç›¸é‡çš„é‚£å®¶é…’å§åƒäº†é£¯ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('They had a meal at the bar where they met each other the first time two years ago')"><i class="fas fa-volume-up"></i></button>
                </div>

                <h4>2. When (ä¿®é£¾æ™‚é–“)</h4>
                <div class="example-box">
                    <span class="en-sentence">I will never forget the day <span class="kw">when</span> I first arrived in Taipei.</span>
                    <span class="ch-translation">æˆ‘æ°¸é ä¸æœƒå¿˜è¨˜æˆ‘ç¬¬ä¸€æ¬¡åˆ°é”å°åŒ—çš„é‚£ä¸€å¤©ã€‚(when = that / on which)</span>
                    <button class="speaker-btn" onclick="speakText('I will never forget the day when I first arrived in Taipei')"><i class="fas fa-volume-up"></i></button>
                </div>
                <div class="example-box">
                    <span class="en-sentence">We haven't met each other since the year <span class="kw">when</span> we graduated from university.</span>
                    <span class="ch-translation">è‡ªå¾æˆ‘å€‘å¤§å­¸ç•¢æ¥­é‚£å¹´ä»¥å¾Œï¼Œæˆ‘å€‘å°±æ²’è¦‹éé¢äº†ã€‚(when = that / in which)</span>
                    <button class="speaker-btn" onclick="speakText('We haven\'t met each other since the year when we graduated from university')"><i class="fas fa-volume-up"></i></button>
                </div>

                <h4>3. Why (ä¿®é£¾åŸå› )</h4>
                <div class="example-box">
                    <span class="en-sentence">Being afraid of gaining weight is the main reason <span class="kw">why</span> the girl is on a diet.</span>
                    <span class="ch-translation">å®³æ€•é«”é‡å¢åŠ æ˜¯é€™å€‹å¥³å­©ç¯€é£Ÿçš„ä¸»è¦åŸå› ã€‚(why = that / for which)</span>
                    <button class="speaker-btn" onclick="speakText('Being afraid of gaining weight is the main reason why the girl is on a diet')"><i class="fas fa-volume-up"></i></button>
                </div>`
            },
            commas: {
                title: "é™å®š vs éé™å®š",
                html: `
                <h2>III. é™å®š vs éé™å®šç”¨æ³•</h2>
                
                <div class="comparison-box" style="border-left-color: var(--primary);">
                    <h3 style="margin-top:0;">1. é™å®šé—œä¿‚å­å¥ (Restrictive)</h3>
                    <p>ç”¨ä¾†é™å®šæˆ–ä¿®é£¾å…ˆè¡Œè©ï¼Œå‰é¢é€šå¸¸<strong>ä¸åŠ é€—è™Ÿ</strong>ã€‚å«æœ‰å¥å­çš„é‡è¦ä¿¡æ¯ï¼Œæ‹¿æ‰å¾Œå¥å­æ„ç¾©æœƒä¸å®Œæ•´ã€‚</p>
                    
                    <div class="small-example">
                        <span class="en-sentence">I like the photo <span class="kw">that</span> you just posted on your FB.</span>
                        <span class="ch-translation">æˆ‘å–œæ­¡ä½ å‰›å‰›åœ¨ FB ç™¼å¸ƒçš„é‚£å¼µç…§ç‰‡ã€‚</span>
                        <button class="speaker-btn" onclick="speakText('I like the photo that you just posted on your FB')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="small-example">
                        <span class="en-sentence">The student <span class="kw">who</span> sits in the back of the room asks a lot of questions.</span>
                        <span class="ch-translation">ååœ¨æˆ¿é–“å¾Œé¢çš„é‚£å€‹å­¸ç”Ÿå•äº†å¾ˆå¤šå•é¡Œã€‚</span>
                        <button class="speaker-btn" onclick="speakText('The student who sits in the back of the room asks a lot of questions')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="small-example">
                        <span class="en-sentence">Children <span class="kw">who</span> are addicted to computer games will feel isolated from the real world.</span>
                        <span class="ch-translation">æ²‰è¿·æ–¼é›»è…¦éŠæˆ²çš„å­©å­æœƒæ„Ÿåˆ°èˆ‡ç¾å¯¦ä¸–ç•Œéš”çµ•ã€‚</span>
                        <button class="speaker-btn" onclick="speakText('Children who are addicted to computer games will feel isolated from the real world')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="small-example">
                        <span class="en-sentence">People <span class="kw">who</span> like to cooperate with others usually have better interpersonal relationships.</span>
                        <span class="ch-translation">å–œæ­¡èˆ‡ä»–äººåˆä½œçš„äººé€šå¸¸æœ‰æ›´å¥½çš„äººéš›é—œä¿‚ã€‚</span>
                        <button class="speaker-btn" onclick="speakText('People who like to cooperate with others usually have better interpersonal relationships')"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>

                <div class="comparison-box">
                    <h3 style="margin-top:0;">2. éé™å®šé—œä¿‚å­å¥ (Non-restrictive)</h3>
                    <p>ç”¨ä¾†è£œå……æˆ–é™„åŠ èªªæ˜å…ˆè¡Œè©ï¼Œå‰é¢é€šå¸¸<strong>æœ‰é€—è™Ÿ</strong>ã€‚é—œä¿‚ä»£åè©<strong>ä¸èƒ½æ˜¯ that</strong>ã€‚æ‹¿æ‰å¾Œå¥å­æ„ç¾©ä¸æœƒæœ‰é‡å¤§æ”¹è®Šã€‚</p>
                    
                    <div class="small-example">
                        <span class="en-sentence">Their English teacher, <span class="kw">who</span> just came back from the US, is sharing with them his trip to the US.</span>
                        <span class="ch-translation">ä»–å€‘çš„è‹±æ–‡è€å¸«ï¼ˆå‰›å¾ç¾åœ‹å›ä¾†ï¼‰æ­£åœ¨èˆ‡ä»–å€‘åˆ†äº«ä»–çš„ç¾åœ‹ä¹‹æ—…ã€‚</span>
                        <button class="speaker-btn" onclick="speakText('Their English teacher, who just came back from the US, is sharing with them his trip to the US')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="small-example">
                        <span class="en-sentence">Jenny, <span class="kw">whose</span> mother is sick, has to ask for a leave from school.</span>
                        <span class="ch-translation">Jennyï¼ˆå¥¹çš„æ¯è¦ªç”Ÿç—…äº†ï¼‰å¿…é ˆå‘å­¸æ ¡è«‹å‡ã€‚</span>
                        <button class="speaker-btn" onclick="speakText('Jenny, whose mother is sick, has to ask for a leave from school')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="small-example">
                        <span class="en-sentence">Minneapolis, <span class="kw">which</span> has a population of about 400,000, is the largest city in Minnesota.</span>
                        <span class="ch-translation">æ˜å°¼äºæ³¢åˆ©æ–¯ï¼ˆäººå£ç´„ 40 è¬ï¼‰æ˜¯æ˜å°¼è˜‡é”å·æœ€å¤§çš„åŸå¸‚ã€‚</span>
                        <button class="speaker-btn" onclick="speakText('Minneapolis, which has a population of about 400,000, is the largest city in Minnesota')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="small-example">
                        <span class="en-sentence">Andy has two sisters, both of <span class="kw">whom</span> are doctors.</span>
                        <span class="ch-translation">Andy æœ‰å…©å€‹å§Šå§Šï¼Œå¥¹å€‘å…©å€‹éƒ½æ˜¯é†«ç”Ÿã€‚</span>
                        <button class="speaker-btn" onclick="speakText('Andy has two sisters, both of whom are doctors')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="small-example">
                        <span class="en-sentence">The baseball team, many of <span class="kw">whose</span> players come from southern Taiwan, won the championship.</span>
                        <span class="ch-translation">é‚£æ”¯æ£’çƒéšŠï¼ˆè¨±å¤šçƒå“¡ä¾†è‡ªå—å°ç£ï¼‰è´å¾—äº†å† è»ã€‚</span>
                        <button class="speaker-btn" onclick="speakText('The baseball team, many of whose players come from southern Taiwan, won the championship')"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>
                
                <div class="note-box" style="margin-top: 2rem;">
                    <div class="note-title"><i class="fas fa-star"></i> é€²éšé‡é»ï¼šAs vs Which (ä»£è¡¨æ•´å¥)</div>
                    <p><strong>as / which</strong> å¯ä»¥å¼•å°éé™å®šé—œä¿‚å­å¥ï¼Œä»£è¡¨å‰é¢ã€Œæ•´å€‹å¥å­ã€ã€‚</p>
                    <div class="small-example">
                        <span class="en-sentence">He is very honest, <span class="kw">as/which</span> we can tell.</span>
                        <span class="ch-translation">ä»–å¾ˆèª å¯¦ï¼Œé€™é»æˆ‘å€‘çœ‹å¾—å‡ºä¾†ã€‚</span>
                        <button class="speaker-btn" onclick="speakText('He is very honest, as we can tell')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    
                    <ul style="margin-top:10px; margin-left:10px;">
                        <li><strong>As</strong>ï¼šå¸¸æœ‰ã€Œæ­£å¦‚ï¼Œæ­£åƒã€çš„å«ç¾©ã€‚ä½ç½®éˆæ´»ï¼ˆå¥é¦–ã€å¥ä¸­ã€å¥å°¾ï¼‰ã€‚å›ºå®šç”¨æ³•å¦‚ï¼š<em>as we can see, as is well known, as often happens</em>ã€‚</li>
                        <li><strong>Which</strong>ï¼šåªèƒ½æ”¾åœ¨<strong>ä¸»å¥å¾Œ</strong>ã€‚ç•¶ä¸»å¥å’Œå­å¥æœ‰æ˜ç¢ºã€Œå› æœé—œä¿‚ã€æ™‚ï¼Œåªç”¨ whichã€‚</li>
                    </ul>

                    <div class="small-example">
                        <span class="en-sentence"><span class="kw">As</span> is known to many people, the US is a developed country.</span>
                        <span class="ch-translation">æ­£å¦‚è¨±å¤šäººæ‰€çŸ¥ï¼Œç¾åœ‹æ˜¯ä¸€å€‹å·²é–‹ç™¼åœ‹å®¶ã€‚(As åœ¨å¥é¦–)</span>
                        <button class="speaker-btn" onclick="speakText('As is known to many people, the US is a developed country')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="small-example">
                        <span class="en-sentence">The US, <span class="kw">as</span> is known to many people, is a developed country.</span>
                        <span class="ch-translation">(As æ’åœ¨å¥ä¸­)</span>
                    </div>
                    
                    <div class="small-example">
                        <span class="en-sentence">Andy was late for school again and again, <span class="kw">which</span> made his teacher very angry.</span>
                        <span class="ch-translation">Andy ä¸Šå­¸ä¸€å†é²åˆ°ï¼Œé€™ä»¶äº‹è®“ä»–è€å¸«éå¸¸ç”Ÿæ°£ã€‚(å› æœé—œä¿‚ï¼Œç”¨ Which)</span>
                        <button class="speaker-btn" onclick="speakText('Andy was late for school again and again, which made his teacher very angry')"><i class="fas fa-volume-up"></i></button>
                    </div>
                    <div class="small-example">
                        <span class="en-sentence">These desks are made of marble, <span class="kw">which</span> made them very heavy.</span>
                        <span class="ch-translation">é€™äº›æ¡Œå­æ˜¯å¤§ç†çŸ³åšçš„ï¼Œé€™ä½¿å¾—å®ƒå€‘éå¸¸é‡ã€‚</span>
                        <button class="speaker-btn" onclick="speakText('These desks are made of marble, which made them very heavy')"><i class="fas fa-volume-up"></i></button>
                    </div>
                </div>`
            },
            'that-only': {
                title: "åªèƒ½ç”¨ That",
                html: `
                <h2>IV. é—œä¿‚ä»£åè©åªèƒ½ç”¨ That çš„æƒ…æ³</h2>
                <p>åœ¨ä»¥ä¸‹æƒ…æ³ä¸­ï¼Œç‚ºäº†é¿å…æ··æ·†æˆ–æ…£ç”¨æ–‡æ³•ï¼Œæˆ‘å€‘å‚¾å‘åªä½¿ç”¨ <strong>that</strong>ã€‚</p>

                <h4>1. å…ˆè¡Œè©æœ‰æœ€é«˜ç´šä¿®é£¾</h4>
                <div class="example-box">
                    <span class="en-sentence">This is the <span class="kw">most interesting</span> book <span class="kw">that</span> I have ever read.</span>
                    <span class="ch-translation">é€™æ˜¯æˆ‘è®€éæœ€æœ‰è¶£çš„æ›¸ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('This is the most interesting book that I have ever read')"><i class="fas fa-volume-up"></i></button>
                </div>

                <h4>2. å…ˆè¡Œè©åŒæ™‚æœ‰äººå’Œç‰©</h4>
                <div class="example-box">
                    <span class="en-sentence">I saw <span class="kw">Jenny and her dog</span> <span class="kw">that</span> were running in the park.</span>
                    <span class="ch-translation">æˆ‘çœ‹åˆ° Jenny å’Œå¥¹çš„ç‹—åœ¨å…¬åœ’è£¡è·‘ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('I saw Jenny and her dog that were running in the park')"><i class="fas fa-volume-up"></i></button>
                </div>

                <h4>3. å…ˆè¡Œè©å‰æœ‰ç‰¹å®šä¿®é£¾èª</h4>
                <p>å¦‚ï¼šfirst, last, next, only, very, every ç­‰ã€‚</p>
                <div class="example-box">
                    <span class="en-sentence">Auckland is the <span class="kw">first</span> city <span class="kw">that</span> I lived in New Zealand.</span>
                    <span class="ch-translation">å¥§å…‹è˜­æ˜¯æˆ‘åœ¨ç´è¥¿è˜­å±…ä½çš„ç¬¬ä¸€å€‹åŸå¸‚ã€‚</span>
                    <button class="speaker-btn" onclick="speakText('Auckland is the first city that I lived in New Zealand')"><i class="fas fa-volume-up"></i></button>
                </div>

                <h4>4. å…ˆè¡Œè©ç‚ºä¸å®šä»£åè©æ™‚</h4>
                <p>å¦‚ï¼šsomething, anything, all ç­‰ã€‚</p>
                <div class="example-box">
                    <span class="en-sentence">Is there <span class="kw">anything</span> <span class="kw">that</span> you want to say?</span>
                    <span class="ch-translation">ä½ æœ‰ä»€éº¼æƒ³èªªçš„å—ï¼Ÿ</span>
                    <button class="speaker-btn" onclick="speakText('Is there anything that you want to say')"><i class="fas fa-volume-up"></i></button>
                </div>

                <h4>5. é¿å…æ··æ·† (Who/Which é–‹é ­çš„å•å¥)</h4>
                <div class="example-box">
                    <span class="en-sentence"><span class="kw">Who</span> is the woman <span class="kw">that</span> just asked the question?</span>
                    <span class="ch-translation">å‰›å‰›å•å•é¡Œçš„é‚£ä½å¥³å£«æ˜¯èª°ï¼Ÿ(é¿å… Who is the woman who...)</span>
                    <button class="speaker-btn" onclick="speakText('Who is the woman that just asked the question')"><i class="fas fa-volume-up"></i></button>
                </div>
                <div class="example-box">
                    <span class="en-sentence"><span class="kw">Which</span> is the book <span class="kw">that</span> you recommend the most?</span>
                    <span class="ch-translation">å“ªä¸€æœ¬æ˜¯ä½ æœ€æ¨è–¦çš„æ›¸ï¼Ÿ</span>
                    <button class="speaker-btn" onclick="speakText('Which is the book that you recommend the most')"><i class="fas fa-volume-up"></i></button>
                </div>`
            },
            reduction: {
                title: "å­å¥ç°¡åŒ–",
                html: `
                <h2>V. å½¢å®¹è©å­å¥ç°¡åŒ– (Reduction)</h2>
                <p>ä¸€äº›é—œä¿‚å­å¥å¯ä»¥è¢«ç¸®ç•¥ç‚ºéé™å®šå‹•è©ç‰‡èªï¼ˆåˆ†è©ç‰‡èªï¼‰ï¼Œæ„æ€ä¸è®Šã€‚</p>
                
                <h4>1. ä¸»å‹•èªæ…‹ â” ç¾åœ¨åˆ†è© (V-ing)</h4>
                <div class="example-box">
                    <p style="margin-bottom:5px; color:#666;">åŸå¥ï¼š</p>
                    <span class="en-sentence">The boy <span class="kw">who is sitting</span> at the back is my brother.</span>
                    <span class="ch-translation">ååœ¨å¾Œé¢çš„é‚£å€‹ç”·å­©æ˜¯æˆ‘çš„å¼Ÿå¼Ÿã€‚</span>
                </div>
                <div class="example-box" style="background-color:#f0fdf4; border-left-color:#16a34a;">
                    <p style="margin-bottom:5px; color:#166534;"><strong>ç°¡åŒ–å¾Œï¼š</strong></p>
                    <span class="en-sentence">The boy <span class="kw" style="color:#16a34a;">sitting</span> at the back is my brother.</span>
                    <button class="speaker-btn" onclick="speakText('The boy sitting at the back is my brother')"><i class="fas fa-volume-up"></i></button>
                </div>

                <div class="example-box">
                    <p style="margin-bottom:5px; color:#666;">åŸå¥ï¼š</p>
                    <span class="en-sentence">I am a teacher <span class="kw">who teaches</span> English at Chunghsin High School.</span>
                    <span class="ch-translation">æˆ‘æ˜¯ä¸€ä½åœ¨ä¸­èˆˆé«˜ä¸­æ•™è‹±æ–‡çš„è€å¸«ã€‚</span>
                </div>
                <div class="example-box" style="background-color:#f0fdf4; border-left-color:#16a34a;">
                    <p style="margin-bottom:5px; color:#166534;"><strong>ç°¡åŒ–å¾Œï¼š</strong></p>
                    <span class="en-sentence">I am a teacher <span class="kw" style="color:#16a34a;">teaching</span> English at Chunghsin High School.</span>
                    <button class="speaker-btn" onclick="speakText('I am a teacher teaching English at Chunghsin High School')"><i class="fas fa-volume-up"></i></button>
                </div>

                <h4>2. è¢«å‹•èªæ…‹ â” éå»åˆ†è© (V-pp)</h4>
                <div class="example-box">
                    <p style="margin-bottom:5px; color:#666;">åŸå¥ï¼š</p>
                    <span class="en-sentence">All the books <span class="kw">that were written</span> by the author are popular.</span>
                    <span class="ch-translation">é€™ä½ä½œè€…å¯«çš„æ‰€æœ‰æ›¸éƒ½å¾ˆå—æ­¡è¿ã€‚</span>
                </div>
                <div class="example-box" style="background-color:#f0fdf4; border-left-color:#16a34a;">
                    <p style="margin-bottom:5px; color:#166534;"><strong>ç°¡åŒ–å¾Œï¼š</strong></p>
                    <span class="en-sentence">All the books <span class="kw" style="color:#16a34a;">written</span> by the author are popular.</span>
                    <button class="speaker-btn" onclick="speakText('All the books written by the author are popular')"><i class="fas fa-volume-up"></i></button>
                </div>`
            },
            quiz: {
                title: "éš¨å ‚æ¸¬é©—",
                html: `<div id="quiz-interface" class="quiz-container">
                    <div class="quiz-progress">Question <span id="current-question-num">1</span> of 10</div>
                    <div class="quiz-question" id="question-text"></div>
                    <div class="quiz-options" id="options-container"></div>
                    <div class="feedback-area" id="feedback-area">
                        <div class="feedback-title" id="feedback-title"></div>
                        <div id="feedback-text"></div>
                        <div style="margin-top:10px; font-size:0.9rem; color:#666;"><i class="fas fa-lightbulb" style="color:#eab308;"></i> æç¤ºï¼š<span id="feedback-hint"></span></div>
                    </div>
                    <button class="next-btn" id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ (Next)</button>
                </div>
                <div id="quiz-score" class="score-card" style="display: none;">
                    <h3><i class="fas fa-trophy"></i> æ¸¬é©—å®Œæˆï¼</h3>
                    <p>ä½ çš„å¾—åˆ†æ˜¯ï¼š</p>
                    <div class="final-score"><span id="score-val">0</span> / 10</div>
                    <p id="score-msg"></p>
                    <button class="satellite" style="position:static; margin:20px auto; transform:none;" onclick="initQuiz()">å†è©¦ä¸€æ¬¡ (Restart)</button>
                </div>`
            }
        };

        // --- 2. QUIZ DATA (100% åŸå…§å®¹ä¿ç•™) ---
        const quizData = [
            {
                q: "1. She is a teacher ______ teaches English writing.",
                options: ["whom", "who", "whose", "which"],
                correct: 1,
                rationale: "å…ˆè¡Œè©æ˜¯äºº (teacher)ï¼Œä¸”åœ¨å­å¥ä¸­ä½œä¸»è© (teaches)ï¼Œæ•…ç”¨ whoã€‚",
                hint: "é€™è£¡æ˜¯å•ã€Œèª°ã€åœ¨æ•™æ›¸ï¼Œè€Œä¸”ç•¶ä¸»è©ç”¨ã€‚"
            },
            {
                q: "2. The students ______ English grammar is weak will find writing hard.",
                options: ["who", "whom", "whose", "that"],
                correct: 2,
                rationale: "è¡¨ç¤ºã€Œå­¸ç”Ÿçš„ã€æ–‡æ³•ï¼Œå…·æ‰€æœ‰æ ¼é—œä¿‚ï¼Œæ•…ç”¨ whoseã€‚",
                hint: "é€™è£¡éœ€è¦è¡¨é”ã€Œä»–å€‘çš„ã€æ–‡æ³•å¾ˆå¼±ã€‚"
            },
            {
                q: "3. I come from New Zealand, a country ______ there are more sheep than people.",
                options: ["which", "where", "that", "when"],
                correct: 1,
                rationale: "å…ˆè¡Œè©æ˜¯åœ°é» (country)ï¼Œä¸”åœ¨å­å¥ä¸­ä½œåœ°æ–¹å‰¯è©ï¼Œæ•…ç”¨ whereã€‚",
                hint: "åœ¨é‚£è£¡ (In that country) æœ‰å¾ˆå¤šç¾Šã€‚"
            },
            {
                q: "4. This is the ______ interesting book that I have ever read.",
                options: ["more", "very", "most", "such"],
                correct: 2,
                rationale: "å¥å°¾ç”¨äº† thatï¼Œæç¤ºå‰é¢å¯èƒ½æœ‰æœ€é«˜ç´šä¿®é£¾ (the most interesting)ã€‚",
                hint: "æœ€é«˜ç´šä¿®é£¾èªé€šå¸¸å¼·åˆ¶ä½¿ç”¨ that ä½œç‚ºé—œä»£ã€‚"
            },
            {
                q: "5. (éé™å®šç”¨æ³•) The US, ______ is known to many people, is a developed country.",
                options: ["that", "which", "as", "what"],
                correct: 2,
                rationale: "As å¼•å°çš„éé™å®šé—œä¿‚å­å¥å¯ç½®æ–¼å¥ä¸­ï¼Œæ„ç‚ºã€Œæ­£å¦‚ã€ã€‚Which é€šå¸¸ç½®æ–¼å¥å°¾æˆ–ç·Šè·Ÿå…ˆè¡Œè©ã€‚",
                hint: "é€™å€‹å­—æœ‰ã€Œæ­£å¦‚ã€æ­£åƒã€çš„æ„æ€ï¼Œä¸”ä½ç½®å¾ˆéˆæ´»ã€‚"
            },
            {
                q: "6. Andy was late again, ______ made his teacher angry.",
                options: ["that", "as", "which", "who"],
                correct: 2,
                rationale: "é€—è™Ÿå¾Œå¼•å°éé™å®šå­å¥ï¼Œä»£è¡¨å‰é¢æ•´ä»¶äº‹é€ æˆäº†å¾Œæœ (å› æœé—œä¿‚)ï¼Œæ•…ç”¨ whichã€‚",
                hint: "é€™ä»¶äº‹å°è‡´äº†è€å¸«ç”Ÿæ°£ (å› æœé—œä¿‚)ï¼Œä¸”ä¸èƒ½ç”¨ thatã€‚"
            },
            {
                q: "7. Who is the woman ______ just asked the question?",
                options: ["who", "which", "whom", "that"],
                correct: 3,
                rationale: "ç–‘å•è© Who é–‹é ­çš„å•å¥ï¼Œç‚ºäº†é¿å…é‡è¤‡ (Who...who)ï¼Œç¿’æ…£ç”¨ thatã€‚",
                hint: "ç‚ºäº†é¿å…å”¸èµ·ä¾†åƒ 'Who... who...'ï¼Œæˆ‘å€‘æœƒæ”¹ç”¨å“ªå€‹å­—ï¼Ÿ"
            },
            {
                q: "8. (ç°¡åŒ–å­å¥) The boy ______ at the back is my brother.",
                options: ["sit", "sitting", "sat", "is sitting"],
                correct: 1,
                rationale: "åŸå¥ç‚º who is sittingï¼Œä¸»å‹•èªæ…‹ç°¡åŒ–ç‚º V-ing (sitting)ã€‚",
                hint: "é‚£å€‹ç”·å­©æ˜¯ã€Œä¸»å‹•ã€ååœ¨é‚£è£¡ï¼Œç°¡åŒ–è¦ç”¨ ingã€‚"
            },
            {
                q: "9. Being afraid of gaining weight is the main reason ______ she is on a diet.",
                options: ["which", "where", "why", "who"],
                correct: 2,
                rationale: "å…ˆè¡Œè©æ˜¯ reasonï¼Œæ­é…é—œä¿‚å‰¯è© whyã€‚",
                hint: "Reason (ç†ç”±) æ­é…å“ªå€‹ç–‘å•è©ï¼Ÿ"
            },
            {
                q: "10. This is the only student ______ passed the exam.",
                options: ["who", "which", "that", "whom"],
                correct: 2,
                rationale: "å…ˆè¡Œè©å‰æœ‰ the only ä¿®é£¾ï¼Œç¿’æ…£ä¸Šåªç”¨ thatã€‚",
                hint: "çœ‹åˆ° 'the only' ä¿®é£¾æ™‚ï¼Œå„ªå…ˆé¸æ“‡ thatã€‚"
            }
        ];

        // --- 3. SYSTEM LOGIC ---

        // 3.1 æ”¾å°„ç‹€æ’åˆ— (Radial Layout)
        function layoutSatellites() {
            const satellites = document.querySelectorAll('.satellite');
            const svg = document.getElementById('lines-svg');
            while (svg.firstChild) svg.removeChild(svg.firstChild);

            const radius = 230; // åŠå¾‘ç•¥å¤§ä»¥å®¹ç´å…§å®¹
            const startAngle = -90; 
            const total = satellites.length;
            const cx = window.innerWidth / 2;
            const cy = window.innerHeight / 2;

            satellites.forEach((sat, i) => {
                const angle = startAngle + (i * (360 / total));
                const rad = angle * (Math.PI / 180);
                const x = Math.cos(rad) * radius;
                const y = Math.sin(rad) * radius;

                // è¨­å®šè¡›æ˜Ÿä½ç½®
                sat.style.left = `calc(50% + ${x}px - 65px)`; // 65px is half width (120px + border)
                sat.style.top = `calc(50% + ${y}px - 65px)`;

                // ç¹ªè£½é€£æ¥ç·š
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", "50%");
                line.setAttribute("y1", "50%");
                line.setAttribute("x2", cx + x);
                line.setAttribute("y2", cy + y);
                line.classList.add("conn-line");
                svg.appendChild(line);
            });
        }
        
        window.addEventListener('resize', layoutSatellites);
        window.addEventListener('load', layoutSatellites);

        // 3.2 Modal èˆ‡ Tab é‚è¼¯
        const tabKeys = ['intro', 'adverbs', 'commas', 'that-only', 'reduction', 'quiz'];

        function openModal(activeKey) {
            const modal = document.getElementById('modal-overlay');
            const tabsContainer = document.getElementById('modal-tabs');
            
            tabsContainer.innerHTML = tabKeys.map(key => {
                const isQuiz = key === 'quiz';
                return `<button class="tab-btn ${key === activeKey ? 'active' : ''}" 
                        onclick="switchTab('${key}', this)">
                        ${isQuiz ? '<i class="fas fa-pencil-alt"></i> ' : ''}${contentData[key].title}
                        </button>`;
            }).join('');

            loadContent(activeKey);
            modal.classList.add('active');
        }

        function closeModal() { document.getElementById('modal-overlay').classList.remove('active'); }

        function switchTab(key, btn) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            loadContent(key);
        }

        function loadContent(key) {
            const contentDiv = document.getElementById('modal-content');
            contentDiv.innerHTML = contentData[key].html;
            if(key === 'quiz') initQuiz();
        }

        // 3.3 èªéŸ³åˆæˆé‚è¼¯ (Text-to-Speech)
        function speakText(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'en-US'; u.rate = 0.9;
                window.speechSynthesis.speak(u);
            }
        }

        // 3.4 æ¸¬é©—é‚è¼¯
        let currentQIndex = 0;
        let score = 0;
        let answered = false;

        function initQuiz() {
            currentQIndex = 0; score = 0;
            document.getElementById('quiz-interface').style.display = 'block';
            document.getElementById('quiz-score').style.display = 'none';
            loadQuestion();
        }

        function loadQuestion() {
            answered = false;
            const data = quizData[currentQIndex];
            document.getElementById('current-question-num').textContent = currentQIndex + 1;
            document.getElementById('question-text').innerText = data.q;
            
            const optionsDiv = document.getElementById('options-container');
            optionsDiv.innerHTML = '';
            document.getElementById('feedback-area').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';

            data.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(index, btn);
                optionsDiv.appendChild(btn);
            });
        }

        function checkAnswer(selectedIndex, btnElement) {
            if (answered) return;
            answered = true;
            const data = quizData[currentQIndex];
            const isCorrect = selectedIndex === data.correct;
            const options = document.getElementsByClassName('option-btn');
            const fbTitle = document.getElementById('feedback-title');

            if (isCorrect) {
                btnElement.classList.add('correct');
                score++;
                fbTitle.innerHTML = "<i class='fas fa-check'></i> æ­£ç¢º (Correct)!";
                fbTitle.style.color = "var(--correct-text)";
                document.getElementById('feedback-area').style.borderLeftColor = "var(--correct-text)";
            } else {
                btnElement.classList.add('wrong');
                options[data.correct].classList.add('correct');
                fbTitle.innerHTML = "<i class='fas fa-times'></i> éŒ¯èª¤ (Incorrect)";
                fbTitle.style.color = "var(--wrong-text)";
                document.getElementById('feedback-area').style.borderLeftColor = "var(--wrong-text)";
            }
            
            document.getElementById('feedback-text').innerText = data.rationale;
            document.getElementById('feedback-hint').innerText = data.hint;
            document.getElementById('feedback-area').style.display = 'block';

            for(let btn of options) btn.disabled = true;
            document.getElementById('next-btn').style.display = 'inline-block';
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex < quizData.length) {
                loadQuestion();
            } else {
                showFinalScore();
            }
        }

        function showFinalScore() {
            document.getElementById('quiz-interface').style.display = 'none';
            document.getElementById('quiz-score').style.display = 'block';
            document.getElementById('score-val').textContent = score;
            const msg = document.getElementById('score-msg');
            
            if (score === 10) msg.textContent = "å¤ªå®Œç¾äº†ï¼å®Œå…¨æŒæ¡å½¢å®¹è©å­å¥ï¼ğŸ†";
            else if (score >= 8) msg.textContent = "å¾ˆæ£’ï¼è§€å¿µéå¸¸æ¸…æ¥šï¼ğŸ‘";
            else if (score >= 5) msg.textContent = "é‚„ä¸éŒ¯ï¼Œå†è¤‡ç¿’ä¸€ä¸‹éé™å®šç”¨æ³•å’Œç°¡åŒ–æœƒæ›´å¥½ï¼ğŸ“š";
            else msg.textContent = "åˆ¥ç°å¿ƒï¼Œé‡æ–°é–±è®€è¬›ç¾©ï¼Œå†æŒ‘æˆ°ä¸€æ¬¡å§ï¼ğŸ’ª";
        }
    </script>
</body>
</html>
